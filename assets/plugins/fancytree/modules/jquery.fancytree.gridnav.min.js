/*!
 * jquery.fancytree.gridnav.js
 *
 * Support keyboard navigation for trees with embedded input controls.
 * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)
 *
 * Copyright (c) 2008-2019, Martin Wendt (http://wwWendt.de)
 *
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.30.2
 * @date 2019-01-13T08:17:01Z
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery","./jquery.fancytree","./jquery.fancytree.table"],a)}else{if(typeof module==="object"&&module.exports){require("./jquery.fancytree.table");module.exports=a(require("jquery"))}else{a(jQuery)}}})(function(e){var c=e.ui.keyCode,b={text:[c.UP,c.DOWN],checkbox:[c.UP,c.DOWN,c.LEFT,c.RIGHT],link:[c.UP,c.DOWN,c.LEFT,c.RIGHT],radiobutton:[c.UP,c.DOWN,c.LEFT,c.RIGHT],"select-one":[c.LEFT,c.RIGHT],"select-multiple":[c.LEFT,c.RIGHT]};function f(h,i){var k,j=i.get(0),g=0;h.children().each(function(){if(this===j){return false}k=e(this).prop("colspan");g+=k?k:1});return g}function d(i,k){var j,h=null,g=0;i.children().each(function(){if(g>=k){h=e(this);return false}j=e(this).prop("colspan");g+=j?j:1});return h}function a(g,j){var h,l,k=g.closest("td"),i=null;switch(j){case c.LEFT:i=k.prev();break;case c.RIGHT:i=k.next();break;case c.UP:case c.DOWN:h=k.parent();l=f(h,k);while(true){h=j===c.UP?h.prev():h.next();if(!h.length){break}if(h.is(":hidden")){continue}i=d(h,l);if(i&&i.find(":input,a").length){break}}break}return i}e.ui.fancytree.registerExtension({name:"gridnav",version:"2.30.2",options:{autofocusInput:false,handleCursorKeys:true},treeInit:function(g){this._requireExtension("table",true,true);this._superApply(arguments);this.$container.addClass("fancytree-ext-gridnav");this.$container.on("focusin",function(j){var h,i=e.ui.fancytree.getNode(j.target);if(i&&!i.isActive()){h=g.tree._makeHookContext(i,j);g.tree._callHook("nodeSetActive",h,true)}})},nodeSetActive:function(j,i,g){var h,n=j.options.gridnav,m=j.node,l=j.originalEvent||{},k=e(l.target).is(":input");i=i!==false;this._superApply(arguments);if(i){if(j.options.titlesTabbable){if(!k){e(m.span).find("span.fancytree-title").focus();m.setFocus()}j.tree.$container.attr("tabindex","-1")}else{if(n.autofocusInput&&!k){h=e(m.tr||m.span);h.find(":input:enabled:first").focus()}}}},nodeKeydown:function(h){var j,i,m,l=h.options.gridnav,k=h.originalEvent,g=e(k.target);if(g.is(":input:enabled")){j=g.prop("type")}else{if(g.is("a")){j="link"}}if(j&&l.handleCursorKeys){i=b[j];if(i&&e.inArray(k.which,i)>=0){m=a(g,k.which);if(m&&m.length){m.find(":input:enabled,a").focus();return false}}return true}return this._superApply(arguments)}});return e.ui.fancytree});