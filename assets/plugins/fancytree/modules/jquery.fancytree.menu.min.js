/*!
 * jquery.fancytree.menu.js
 *
 * Enable jQuery UI Menu as context menu for tree nodes.
 * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)
 *
 * @see http://api.jqueryui.com/menu/
 *
 * Copyright (c) 2008-2019, Martin Wendt (http://wwWendt.de)
 *
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.30.2
 * @date 2019-01-13T08:17:01Z
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery","./jquery.fancytree"],a)}else{if(typeof module==="object"&&module.exports){require("./jquery.fancytree");module.exports=a(require("jquery"))}else{a(jQuery)}}})(function(a){a.ui.fancytree.registerExtension({name:"menu",version:"2.30.2",options:{enable:true,selector:null,position:{},create:a.noop,beforeOpen:a.noop,open:a.noop,focus:a.noop,select:a.noop,close:a.noop},treeInit:function(c){var d=c.options,b=c.tree;this._superApply(arguments);b.ext.menu.data={tree:b,node:null,$menu:null,menuId:null};b.$container.delegate("span.fancytree-node","contextmenu",function(g){var f=a.ui.fancytree.getNode(g),e={node:f,tree:f.tree,originalEvent:g,options:b.options};b.ext.menu._openMenu(e);return false});a(d.menu.selector).menu({create:function(e,g){b.ext.menu.data.$menu=a(this).menu("widget");var f=a.extend({},b.ext.menu.data);d.menu.create.call(b,e,f)},focus:function(e,g){var f=a.extend({},b.ext.menu.data,{menuItem:g.item,menuId:g.item.find(">a").attr("href")});d.menu.focus.call(b,e,f)},select:function(e,g){var f=a.extend({},b.ext.menu.data,{menuItem:g.item,menuId:g.item.find(">a").attr("href")});if(d.menu.select.call(b,e,f)!==false){b.ext.menu._closeMenu(c)}}}).hide()},treeDestroy:function(b){this._superApply(arguments)},_openMenu:function(c){var f,b=c.tree,e=c.options,d=a(e.menu.selector);b.ext.menu.data.node=c.node;f=a.extend({},b.ext.menu.data);if(e.menu.beforeOpen.call(b,c.originalEvent,f)===false){return}a(document).on("keydown.fancytree",function(g){if(g.which===a.ui.keyCode.ESCAPE){b.ext.menu._closeMenu(c)}}).on("mousedown.fancytree",function(g){if(a(g.target).closest(".ui-menu-item").length===0){b.ext.menu._closeMenu(c)}});d.css("position","absolute").show().position({my:"left top",at:"right top",of:c.originalEvent,collision:"fit"}).focus();e.menu.open.call(b,c.originalEvent,f)},_closeMenu:function(c){var d,b=c.tree,e=c.options,f=a.extend({},b.ext.menu.data);if(e.menu.close.call(b,c.originalEvent,f)===false){return}d=a(e.menu.selector);a(document).off("keydown.fancytree, mousedown.fancytree");d.hide();b.ext.menu.data.node=null}});return a.ui.fancytree});