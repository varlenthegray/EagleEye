/*!
 * jquery.fancytree.filter.js
 *
 * Remove or highlight tree nodes, based on a filter.
 * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)
 *
 * Copyright (c) 2008-2019, Martin Wendt (http://wwWendt.de)
 *
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.30.2
 * @date 2019-01-13T08:17:01Z
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery","./jquery.fancytree"],a)}else{if(typeof module==="object"&&module.exports){require("./jquery.fancytree");module.exports=a(require("jquery"))}else{a(jQuery)}}})(function(d){var e="__not_found__",c=d.ui.fancytree.escapeHtml;function b(f){return(f+"").replace(/([.?*+\^\$\[\]\\(){}|-])/g,"\\$1")}function a(f){if(f.indexOf(">")>=0){return d("<div/>").html(f).text()}return f}d.ui.fancytree._FancytreeClass.prototype._applyFilterImpl=function(h,s,o){var j,m,q,t,p,l=0,k=this.options,i=k.escapeTitles,n=k.autoCollapse,f=d.extend({},k.filter,o),g=f.mode==="hide",r=!!f.leavesOnly&&!s;if(typeof h==="string"){if(h===""){this.warn("Fancytree passing an empty string as a filter is handled as clearFilter().");this.clearFilter();return}if(f.fuzzy){j=h.split("").reduce(function(v,u){return v+"[^"+u+"]*"+u})}else{j=b(h)}q=new RegExp(".*"+j+".*","i");t=new RegExp(b(h),"gi");h=function(v){if(!v.title){return false}var w=i?v.title:a(v.title),u=!!q.test(w);if(u&&f.highlight){if(i){p=w.replace(t,function(x){return"\uFFF7"+x+"\uFFF8"});v.titleWithHighlight=c(p).replace(/\uFFF7/g,"<mark>").replace(/\uFFF8/g,"</mark>")}else{v.titleWithHighlight=w.replace(t,function(x){return"<mark>"+x+"</mark>"})}}return u}}this.enableFilter=true;this.lastFilterArgs=arguments;this.$div.addClass("fancytree-ext-filter");if(g){this.$div.addClass("fancytree-ext-filter-hide")}else{this.$div.addClass("fancytree-ext-filter-dimm")}this.$div.toggleClass("fancytree-ext-filter-hide-expanders",!!f.hideExpanders);this.visit(function(u){delete u.match;delete u.titleWithHighlight;u.subMatchCount=0});m=this.getRootNode()._findDirectChild(e);if(m){m.remove()}k.autoCollapse=false;this.visit(function(w){if(r&&w.children!=null){return}var v=h(w),u=false;if(v==="skip"){w.visit(function(x){x.match=false},true);return"skip"}if(!v&&(s||v==="branch")&&w.parent.match){v=true;u=true}if(v){l++;w.match=true;w.visitParents(function(x){x.subMatchCount+=1;if(f.autoExpand&&!u&&!x.expanded){x.setExpanded(true,{noAnimation:true,noEvents:true,scrollIntoView:false});x._filterAutoExpanded=true}})}});k.autoCollapse=n;if(l===0&&f.nodata&&g){m=f.nodata;if(d.isFunction(m)){m=m()}if(m===true){m={}}else{if(typeof m==="string"){m={title:m}}}m=d.extend({statusNodeType:"nodata",key:e,title:this.options.strings.noData},m);this.getRootNode().addNode(m).match=true}this.render();return l};d.ui.fancytree._FancytreeClass.prototype.filterNodes=function(f,g){if(typeof g==="boolean"){g={leavesOnly:g};this.warn("Fancytree.filterNodes() leavesOnly option is deprecated since 2.9.0 / 2015-04-19. Use opts.leavesOnly instead.")}return this._applyFilterImpl(f,false,g)};d.ui.fancytree._FancytreeClass.prototype.applyFilter=function(f){this.warn("Fancytree.applyFilter() is deprecated since 2.1.0 / 2014-05-29. Use .filterNodes() instead.");return this.filterNodes.apply(this,arguments)};d.ui.fancytree._FancytreeClass.prototype.filterBranches=function(f,g){return this._applyFilterImpl(f,true,g)};d.ui.fancytree._FancytreeClass.prototype.clearFilter=function(){var g,f=this.getRootNode()._findDirectChild(e),h=this.options.escapeTitles,i=this.options.enhanceTitle;if(f){f.remove()}this.visit(function(j){if(j.match&&j.span){g=d(j.span).find(">span.fancytree-title");if(h){g.text(j.title)}else{g.html(j.title)}if(i){i({type:"enhanceTitle"},{node:j,$title:g})}}delete j.match;delete j.subMatchCount;delete j.titleWithHighlight;if(j.$subMatchBadge){j.$subMatchBadge.remove();delete j.$subMatchBadge}if(j._filterAutoExpanded&&j.expanded){j.setExpanded(false,{noAnimation:true,noEvents:true,scrollIntoView:false})}delete j._filterAutoExpanded});this.enableFilter=false;this.lastFilterArgs=null;this.$div.removeClass("fancytree-ext-filter fancytree-ext-filter-dimm fancytree-ext-filter-hide");this.render()};d.ui.fancytree._FancytreeClass.prototype.isFilterActive=function(){return !!this.enableFilter};d.ui.fancytree._FancytreeNodeClass.prototype.isMatched=function(){return !(this.tree.enableFilter&&!this.match)};d.ui.fancytree.registerExtension({name:"filter",version:"2.30.2",options:{autoApply:true,autoExpand:false,counter:true,fuzzy:false,hideExpandedCounter:true,hideExpanders:false,highlight:true,leavesOnly:false,nodata:true,mode:"dimm"},nodeLoadChildren:function(f,g){return this._superApply(arguments).done(function(){if(f.tree.enableFilter&&f.tree.lastFilterArgs&&f.options.filter.autoApply){f.tree._applyFilterImpl.apply(f.tree,f.tree.lastFilterArgs)}})},nodeSetExpanded:function(h,g,f){delete h.node._filterAutoExpanded;if(!g&&h.options.filter.hideExpandedCounter&&h.node.$subMatchBadge){h.node.$subMatchBadge.show()}return this._superApply(arguments)},nodeRenderStatus:function(m){var i,h=m.node,n=m.tree,f=m.options.filter,k=d(h.span).find("span.fancytree-title"),j=d(h[n.statusClassPropName]),l=m.options.enhanceTitle,g=m.options.escapeTitles;i=this._super(m);if(!j.length||!n.enableFilter){return i}j.toggleClass("fancytree-match",!!h.match).toggleClass("fancytree-submatch",!!h.subMatchCount).toggleClass("fancytree-hide",!(h.match||h.subMatchCount));if(f.counter&&h.subMatchCount&&(!h.isExpanded()||!f.hideExpandedCounter)){if(!h.$subMatchBadge){h.$subMatchBadge=d("<span class='fancytree-childcounter'/>");d("span.fancytree-icon, span.fancytree-custom-icon",h.span).append(h.$subMatchBadge)}h.$subMatchBadge.show().text(h.subMatchCount)}else{if(h.$subMatchBadge){h.$subMatchBadge.hide()}}if(h.span&&(!h.isEditing||!h.isEditing.call(h))){if(h.titleWithHighlight){k.html(h.titleWithHighlight)}else{if(g){k.text(h.title)}else{k.html(h.title)}}if(l){l({type:"enhanceTitle"},{node:h,$title:k})}}return i}});return d.ui.fancytree});