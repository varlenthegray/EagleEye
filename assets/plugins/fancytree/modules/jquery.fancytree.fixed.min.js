/*!
 * jquery.fancytree.fixed.js
 *
 * Add fixed colums and headers to ext.table.
 * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)
 *
 * Copyright (c) 2008-2019, Martin Wendt (http://wwWendt.de)
 *
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.30.2
 * @date 2019-01-13T08:17:01Z
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery","./jquery.fancytree","./jquery.fancytree.table"],a)}else{if(typeof module==="object"&&module.exports){require("./jquery.fancytree.table");module.exports=a(require("jquery"))}else{a(jQuery)}}})(function(a){a.ui.fancytree.registerExtension({name:"fixed",version:"0.0.1",options:{fixCol:1,fixColWidths:null,fixRows:true,scrollSpeed:50,resizable:true,classNames:{table:"fancytree-ext-fixed",wrapper:"fancytree-ext-fixed-wrapper",topLeft:"fancytree-ext-fixed-wrapper-tl",topRight:"fancytree-ext-fixed-wrapper-tr",bottomLeft:"fancytree-ext-fixed-wrapper-bl",bottomRight:"fancytree-ext-fixed-wrapper-br",hidden:"fancytree-ext-fixed-hidden",counterpart:"fancytree-ext-fixed-node-counterpart",scrollBorderBottom:"fancytree-ext-fixed-scroll-border-bottom",scrollBorderRight:"fancytree-ext-fixed-scroll-border-right",hover:"fancytree-ext-fixed-hover"}},treeInit:function(q){this._requireExtension("table",true,true);var w=this._superApply(arguments),m=q.tree,e=this.options.fixed,s=this.options.fixed.classNames,j=m.widget.element,c=e.fixCols,l=e.fixRows,g=j.parent(),f=a("<div>").addClass(s.topLeft),t=a("<div>").addClass(s.topRight),i=a("<div>").addClass(s.bottomLeft),b=a("<div>").addClass(s.bottomRight),v=j.attr("style"),r=j.attr("class"),d=a("<table>").attr("style",v).attr("class",r),h=a("<table>").attr("style",v).attr("class",r),p=j,u=a("<table>").attr("style",v).attr("class",r),k=j.find("thead"),o=j.find("colgroup"),n=k.find("tr").length;this.$fixedWrapper=g;j.addClass(s.table);g.addClass(s.wrapper);u.append(a("<tbody>"));if(o.length){o.remove()}if(typeof l==="boolean"){l=l?n:0}else{l=Math.max(0,Math.min(l,n))}if(l){d.append(k.clone(true));h.append(k.clone(true));k.remove()}d.find("tr").each(function(x){a(this).find("th").slice(c).remove()});h.find("tr").each(function(x){a(this).find("th").slice(0,c).remove()});this.$fixedWrapper=g;g.append(f.append(d),t.append(h),i.append(p),b.append(u));u.on("keydown",function(y){var A=m.focusNode,x=m._makeHookContext(A||m,y),z=m._callHook("nodeKeydown",x);return z});u.on("click dblclick","tr",function(y){var C=a(this),A=C.data(s.counterpart),B=a.ui.fancytree.getNode(A),x=m._makeHookContext(B,y),D=a.ui.fancytree.getEventTarget(y),z=m.phase;try{m.phase="userEvent";switch(y.type){case"click":x.targetType=D.type;if(B.isPagingNode()){return(m._triggerNodeEvent("clickPaging",x,y)===true)}return m._triggerNodeEvent("click",x,y)===false?false:m._callHook("nodeClick",x);case"dblclick":x.targetType=D.type;return m._triggerNodeEvent("dblclick",x,y)===false?false:m._callHook("nodeDblclick",x)}}finally{m.phase=z}});g.on("mouseenter","."+s.bottomRight+" table tr, ."+s.bottomLeft+" table tr",function(x){var y=a(this),z=y.data(s.counterpart);y.addClass(s.hover);z.addClass(s.hover)}).on("mouseleave","."+s.bottomRight+" table tr, ."+s.bottomLeft+" table tr",function(x){var y=a(this),z=y.data(s.counterpart);y.removeClass(s.hover);z.removeClass(s.hover)});i.on("mousewheel DOMMouseScroll",function(z){var A=a(this),x=A.scrollTop(),y=z.originalEvent.wheelDelta>0||z.originalEvent.detail<0;x+=y?-e.scrollSpeed:e.scrollSpeed;A.scrollTop(x);b.scrollTop(x);z.preventDefault()});b.scroll(function(){var y=a(this),z=y.scrollLeft(),x=y.scrollTop();f.toggleClass(s.scrollBorderBottom,x>0).toggleClass(s.scrollBorderRight,z>0);t.toggleClass(s.scrollBorderBottom,x>0).scrollLeft(z);i.toggleClass(s.scrollBorderRight,z>0).scrollTop(x)});a.ui.fancytree.overrideMethod(a.ui.fancytree._FancytreeNodeClass.prototype,"scrollIntoView",function(z,y){var x=m.$container;m.$container=b;return this._super.apply(this,arguments).always(function(){m.$container=x})});return w},treeLoad:function(b){var d=this,c=this._superApply(arguments);c.done(function(){d.ext.fixed._adjustLayout.call(d);if(d.options.fixed.resizable){d.ext.fixed._makeTableResizable()}});return c},_makeTableResizable:function(){var f=this.$fixedWrapper,g=this.options.fixed.classNames,b=f.find("div."+g.topLeft),e=f.find("div."+g.topRight),h=f.find("div."+g.bottomLeft),d=f.find("div."+g.bottomRight);function c(i){i.resizable({handles:"e",resize:function(j,l){var k=Math.max(i.width(),l.size.width);h.css("width",k);b.css("width",k);d.css("left",k);e.css("left",k)},stop:function(){i.css("width","100%")}})}c(b.find("table"));c(h.find("table"))},nodeLoadChildren:function(b,c){return this._superApply(arguments)},nodeRemoveChildMarkup:function(b){var c=b.node;function d(g){var f=g.children;if(f){for(var e=0;e<f.length;e++){var h=f[e];if(h.trRight){a(h.trRight).remove()}d(h)}}}d(c);return this._superApply(arguments)},nodeRemoveMarkup:function(b){var c=b.node;if(c.trRight){a(c.trRight).remove()}return this._superApply(arguments)},nodeSetActive:function(d,c,b){var e=d.node,f=this.options._classNames;if(e.trRight){a(e.trRight).toggleClass(f.active,c).toggleClass(f.focused,c)}return this._superApply(arguments)},nodeKeydown:function(b){return this._superApply(arguments)},nodeSetFocus:function(c,b){var d=c.node,e=this.options._classNames;if(d.trRight){a(d.trRight).toggleClass(e.focused,b)}return this._superApply(arguments)},nodeRender:function(m,c,n,g,f){var s=this._superApply(arguments),l=m.node,k=!l.parent;if(!k){var e=a(l.tr),o=this.options.fixed.classNames,d=e.data(o.counterpart);if(!d&&e.length){var h=e.index(),b=this.options.fixed.fixCols,q=a("div."+o.bottomLeft+" table tbody"),p=a("div."+o.bottomRight+" table tbody"),r=q.find("tr:eq("+Math.max(h+1,0)+")"),i=r.data(o.counterpart);d=e.clone(true);var j=d.get(0);if(i){a(i).before(d)}else{p.append(d)}d.show();j.ftnode=l;l.trRight=j;e.find("td").slice(b).remove();d.find("td").slice(0,b).remove();e.data(o.counterpart,d);d.data(o.counterpart,e)}}return s},nodeRenderTitle:function(b,c){return this._superApply(arguments)},nodeRenderStatus:function(c){var e=this._superApply(arguments),g=c.node;if(g.trRight){var d=a(g.trRight),f=a(g.tr),i=this.options.fixed.classNames,h=d.hasClass(i.hover),b=f.attr("class");d.attr("class",b);if(h){d.addClass(i.hover);f.addClass(i.hover)}}return e},nodeSetExpanded:function(k,g,i){var f,e=this,b=k.node,c=a(b.tr),j=this.options.fixed.classNames,h=this.options._classNames,d=c.data(j.counterpart);g=typeof g==="undefined"?true:g;if(!d){return this._superApply(arguments)}d.toggleClass(h.expanded,!!g);if(g&&!b.isExpanded()){f=this._superApply(arguments);f.done(function(){b.visit(function(n){var m=a(n.tr),l=m.data(j.counterpart);e.ext.fixed._adjustRowHeight(m,l);if(!n.expanded){return"skip"}});e.ext.fixed._adjustColWidths();e.ext.fixed._adjustWrapperLayout()})}else{if(!g&&b.isExpanded()){b.visit(function(n){var m=a(n.tr),l=m.data(j.counterpart);if(l){if(!n.expanded){return"skip"}}});e.ext.fixed._adjustColWidths();e.ext.fixed._adjustWrapperLayout();f=this._superApply(arguments)}else{f=this._superApply(arguments)}}return f},nodeSetStatus:function(c,b,e,d){return this._superApply(arguments)},treeClear:function(c){var b=c.tree,d=b.widget.element,e=this.$fixedWrapper,f=this.options.fixed.classNames;d.find("tr, td, th, thead").removeClass(f.hidden).css({"min-width":"auto",height:"auto"});e.empty().append(d);return this._superApply(arguments)},treeRegisterNode:function(b,d,c){return this._superApply(arguments)},treeDestroy:function(c){var b=c.tree,d=b.widget.element,e=this.$fixedWrapper,f=this.options.fixed.classNames;d.find("tr, td, th, thead").removeClass(f.hidden).css({"min-width":"auto",height:"auto"});e.empty().append(d);return this._superApply(arguments)},_adjustColWidths:function(){if(this.options.fixed.adjustColWidths){this.options.fixed.adjustColWidths.call(this);return}var g=this.$fixedWrapper,h=this.options.fixed.classNames,e=g.find("div."+h.topLeft),f=g.find("div."+h.bottomLeft),c=g.find("div."+h.topRight),d=g.find("div."+h.bottomRight);function b(k,l){var j=k.find("thead tr").first(),i=l.find("tbody tr").first();j.find("th").each(function(n){var m=a(this),r=i.find("td").eq(n);var s=m.width(),t=m.outerWidth(),o=r.width(),p=r.outerWidth(),q=Math.max(t,p);m.css("min-width",q-(t-s));r.css("min-width",q-(p-o))})}b(e,f);b(c,d)},_adjustRowHeight:function(e,c){var g=this.options.fixed.classNames;if(!c){c=e.data(g.counterpart)}e.css("height","auto");c.css("height","auto");var f=e.outerHeight(),d=c.outerHeight(),b=Math.max(f,d);e.css("height",b+1);c.css("height",b+1)},_adjustWrapperLayout:function(){var h=this.$fixedWrapper,j=this.options.fixed.classNames,e=h.find("div."+j.topLeft),k=h.find("div."+j.topRight),i=h.find("div."+j.bottomLeft),l=h.find("div."+j.bottomRight),m=e.find("table"),f=k.find("table"),d=h.width(),c=h.height(),b=Math.min(d,m.width()),g=Math.min(c,Math.max(m.height(),f.height()));e.css({width:b,height:g});k.css({width:"calc(100% - "+(b+17)+"px)",height:g,left:b});i.css({width:b,height:"calc(100% - "+(g+17)+"px)",top:g});l.css({width:"calc(100% - "+b+"px)",height:"calc(100% - "+g+"px)",top:g,left:b})},_adjustLayout:function(){var g=this,d=this.$fixedWrapper,e=this.options.fixed.classNames,b=d.find("div."+e.topLeft),c=d.find("div."+e.topRight),f=d.find("div."+e.bottomLeft);b.find("table tr").each(function(h){var i=c.find("tr:eq("+h+")");g.ext.fixed._adjustRowHeight(a(this),i)});f.find("table tbody").find("tr").each(function(h){g.ext.fixed._adjustRowHeight(a(this))});g.ext.fixed._adjustColWidths.call(this);g.ext.fixed._adjustWrapperLayout.call(this)}});return a.ui.fancytree});