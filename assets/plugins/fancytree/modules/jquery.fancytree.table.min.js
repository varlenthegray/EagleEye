/*!
 * jquery.fancytree.table.js
 *
 * Render tree as table (aka 'tree grid', 'table tree').
 * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)
 *
 * Copyright (c) 2008-2019, Martin Wendt (http://wwWendt.de)
 *
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.30.2
 * @date 2019-01-13T08:17:01Z
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery","./jquery.fancytree"],a)}else{if(typeof module==="object"&&module.exports){require("./jquery.fancytree");module.exports=a(require("jquery"))}else{a(jQuery)}}})(function(f){function c(g,h){h=h||"";if(!g){f.error("Assertion failed "+h)}}function b(g,h){g.insertBefore(h,g.firstChild)}function e(g,h){g.parentNode.insertBefore(h,g.nextSibling)}function a(h,g){h.visit(function(i){var j=i.tr;if(j){j.style.display=i.hide||!g?"none":""}if(!i.expanded){return"skip"}})}function d(l){var g,k,j,h=l.parent,m=h?h.children:null;if(m&&m.length>1&&m[0]!==l){g=f.inArray(l,m);j=m[g-1];c(j.tr);while(j.children&&j.children.length){k=j.children[j.children.length-1];if(!k.tr){break}j=k}}else{j=h}return j}f.ui.fancytree.registerExtension({name:"table",version:"2.30.2",options:{checkboxColumnIdx:null,mergeStatusColumns:true,indentation:16,nodeColumnIdx:0},treeInit:function(p){var k,h,l,j,q=p.tree,g=p.options,m=g.table,o=q.widget.element;if(m.customStatus!=null){if(g.renderStatusColumns!=null){f.error("The 'customStatus' option is deprecated since v2.15.0. Use 'renderStatusColumns' only instead.")}else{q.warn("The 'customStatus' option is deprecated since v2.15.0. Use 'renderStatusColumns' instead.");g.renderStatusColumns=m.customStatus}}if(g.renderStatusColumns){if(g.renderStatusColumns===true){g.renderStatusColumns=g.renderColumns}}o.addClass("fancytree-container fancytree-ext-table");j=o.find(">tbody");if(!j.length){if(o.find(">tr").length){f.error("Expected table > tbody > tr. If you see this please open an issue.")}j=f("<tbody>").appendTo(o)}q.tbody=j[0];q.columnCount=f("thead >tr:last >th",o).length;l=j.children("tr:first");if(l.length){h=l.children("td").length;if(q.columnCount&&h!==q.columnCount){q.warn("Column count mismatch between thead ("+q.columnCount+") and tbody ("+h+"): using tbody.");q.columnCount=h}l=l.clone()}else{c(q.columnCount>=1,"Need either <thead> or <tbody> with <td> elements to determine column count.");l=f("<tr />");for(k=0;k<q.columnCount;k++){l.append("<td />")}}l.find(">td").eq(m.nodeColumnIdx).html("<span class='fancytree-node' />");if(g.aria){l.attr("role","row");l.find("td").attr("role","gridcell")}q.rowFragment=document.createDocumentFragment();q.rowFragment.appendChild(l.get(0));j.empty();q.statusClassPropName="tr";q.ariaPropName="tr";this.nodeContainerAttrName="tr";q.$container=o;this._superApply(arguments);f(q.rootNode.ul).remove();q.rootNode.ul=null;this.$container.attr("tabindex",g.tabindex);if(g.aria){q.$container.attr("role","treegrid").attr("aria-readonly",true)}},nodeRemoveChildMarkup:function(g){var h=g.node;h.visit(function(i){if(i.tr){f(i.tr).remove();i.tr=null}})},nodeRemoveMarkup:function(g){var h=g.node;if(h.tr){f(h.tr).remove();h.tr=null}this.nodeRemoveChildMarkup(g)},nodeRender:function(x,j,u,p,m){var k,t,q,o,w,h,s,r,y=x.tree,n=x.node,g=x.options,v=!n.parent;if(y._enableUpdate===false){return}if(!m){x.hasCollapsedParents=n.parent&&!n.parent.expanded}if(!v){if(n.tr&&j){this.nodeRemoveMarkup(x)}if(!n.tr){if(x.hasCollapsedParents&&!u){return}w=y.rowFragment.firstChild.cloneNode(true);h=d(n);c(h);if(p===true&&m){w.style.display="none"}else{if(u&&x.hasCollapsedParents){w.style.display="none"}}if(!h.tr){c(!h.parent,"prev. row must have a tr, or be system root");b(y.tbody,w)}else{e(h.tr,w)}n.tr=w;if(n.key&&g.generateIds){n.tr.id=g.idPrefix+n.key}n.tr.ftnode=n;n.span=f("span.fancytree-node",n.tr).get(0);this.nodeRenderTitle(x);if(g.createNode){g.createNode.call(y,{type:"createNode"},x)}}else{if(j){this.nodeRenderTitle(x)}else{this.nodeRenderStatus(x)}}}if(g.renderNode){g.renderNode.call(y,{type:"renderNode"},x)}k=n.children;if(k&&(v||u||n.expanded)){for(q=0,o=k.length;q<o;q++){r=f.extend({},x,{node:k[q]});r.hasCollapsedParents=r.hasCollapsedParents||!n.expanded;this.nodeRender(r,j,u,p,true)}}if(k&&!m){s=n.tr||null;t=y.tbody.firstChild;n.visit(function(l){if(l.tr){if(!l.parent.expanded&&l.tr.style.display!=="none"){l.tr.style.display="none";a(l,false)}if(l.tr.previousSibling!==s){n.debug("_fixOrder: mismatch at node: "+l);var i=s?s.nextSibling:t;y.tbody.insertBefore(l.tr,i)}s=l.tr}})}},nodeRenderTitle:function(n,m){var h,l,o=n.tree,i=n.node,g=n.options,j=i.isStatusNode();l=this._super(n,m);if(i.isRootNode()){return l}if(g.checkbox&&!j&&g.table.checkboxColumnIdx!=null){h=f("span.fancytree-checkbox",i.span);f(i.tr).find("td").eq(+g.table.checkboxColumnIdx).html(h)}this.nodeRenderStatus(n);if(j){if(g.renderStatusColumns){g.renderStatusColumns.call(n.tree,{type:"renderStatusColumns"},n)}else{if(g.table.mergeStatusColumns&&i.isTopLevel()){var k=f(i.tr).find(">td");k.eq(0).prop("colspan",o.columnCount).text(i.title).addClass("fancytree-status-merged").nextAll().remove()}}}else{if(g.renderColumns){g.renderColumns.call(n.tree,{type:"renderColumns"},n)}}return l},nodeRenderStatus:function(h){var g,j=h.node,i=h.options;this._super(h);f(j.tr).removeClass("fancytree-node");g=(j.getLevel()-1)*i.table.indentation;if(i.rtl){f(j.span).css({paddingRight:g+"px"})}else{f(j.span).css({paddingLeft:g+"px"})}},nodeSetExpanded:function(j,i,h){i=i!==false;if((j.node.expanded&&i)||(!j.node.expanded&&!i)){return this._superApply(arguments)}var g=new f.Deferred(),l=f.extend({},h,{noEvents:true,noAnimation:true});h=h||{};function k(m){a(j.node,i);if(m){if(i&&j.options.autoScroll&&!h.noAnimation&&j.node.hasChildren()){j.node.getLastChild().scrollIntoView(true,{topNode:j.node}).always(function(){if(!h.noEvents){j.tree._triggerNodeEvent(i?"expand":"collapse",j)}g.resolveWith(j.node)})}else{if(!h.noEvents){j.tree._triggerNodeEvent(i?"expand":"collapse",j)}g.resolveWith(j.node)}}else{if(!h.noEvents){j.tree._triggerNodeEvent(i?"expand":"collapse",j)}g.rejectWith(j.node)}}this._super(j,i,l).done(function(){k(true)}).fail(function(){k(false)});return g.promise()},nodeSetStatus:function(h,g,k,i){if(g==="ok"){var j=h.node,l=j.children?j.children[0]:null;if(l&&l.isStatusNode()){f(l.tr).remove()}}return this._superApply(arguments)},treeClear:function(g){this.nodeRemoveChildMarkup(this._makeHookContext(this.rootNode));return this._superApply(arguments)},treeDestroy:function(g){this.$container.find("tbody").empty();this.$source&&this.$source.removeClass("fancytree-helper-hidden");return this._superApply(arguments)}});return f.ui.fancytree});