jQuery.expr.filters.offscreen=function(a){var b=a.getBoundingClientRect();return((b.x+b.width)<0||(b.y+b.height)<0||(b.x>window.innerWidth||b.y>window.innerHeight))};var total=0;function delNoData(){let getNegNode=cabinetList.fancytree("getTree").getNodeByKey("-1");if(getNegNode!==null){cabinetList.fancytree("getTree").getNodeByKey("-1").remove()}}function recalcTotal(){let totalTree=cabinetList.fancytree("getTree");let newTotal=0;totalTree.visit(function(a){let qty=parseInt(a.data.qty);let price=parseFloat(a.data.price);let lineTotal=qty*price;newTotal+=parseFloat(lineTotal);let node=cabinetList.fancytree("getTree").getNodeByKey(a.key),$tdList=$(node.tr).find(">td");console.log("Updated "+node.key+" with total: "+newTotal);node.data.total=newTotal.formatMoney();$tdList.eq(11).text(newTotal.formatMoney())})}var mouseX,mouseY;$(document).mousemove(function(a){mouseX=a.pageX;mouseY=a.pageY});var CLIPBOARD=null;var cabinetList=$("#cabinet_list");var catalog=$("#catalog_categories");var itemModifications=$("#item_modifications");$("body").on("keyup","#treeFilter",function(){catalog.fancytree("getTree").filterNodes($(this).val())}).on("keyup","#modificationsFilter",function(){itemModifications.fancytree("getTree").filterNodes($(this).val())}).on("click","#catalog_add_custom",function(){delNoData();var a=cabinetList.fancytree("getRootNode");var b=a.addChildren({title:"Nomenclature...",tooltip:"Type your nomenclature here.",name:'<input type="text" class="form-control qty_input" value="1" placeholder="Qty" />'})}).on("click","#catalog_remove_checked",function(){var a=cabinetList.fancytree("getTree"),b=a.getSelectedNodes();b.forEach(function(c){c.remove()});cabinetList.fancytree("getRootNode").render(true,true);$(this).hide();recalcTotal()}).on("click","#cabinet_list_save",function(){var b=JSON.stringify(getMiniTree(cabinetList));var e=$("#catalog").find(":selected").attr("id");$.post("/html/pricing/ajax/item_actions.php?action=saveCatalog&room_id="+roomID,{cabinet_list:b,catalog_id:e},function(g){$("body").append(g)});var a=this;var d={};var c=$("#pricing_global_attributes").serialize();$("input[type='hidden']").each(function(){var h=$(this);var i=$(this).attr("id");var g=["X","Xxx","AX","DX","TX","Xx","WX","1cXXXX","3gXXXX","HW","KW"];if($.inArray(h.val(),g)>=0){d[i]={};h.parent().find(".selected").find("input").each(function(){d[i][$(this).attr("name")]=$(this).val()})}});var f=JSON.stringify(d);$.post("/ondemand/room_actions.php?action=update_room",{customVals:f,editInfo:c,roomid:roomID},function(g){$("body").append(g)}).done(function(){$(a).addClass("edit_room_save");$("#room_notes").val("")});unsaved=false}).on("focus",".qty_input",function(){$(this).select()}).on("keyup",".qty_input",function(){let id=$(this).attr("id");cabinetList.fancytree("getTree").getNodeByKey(id).data.qty=$(this).val()}).on("change",".qty_input",function(){recalcTotal()}).on("click",".add_item_cabinet_list",function(){delNoData();var a=cabinetList.fancytree("getRootNode");let $tdList=$(a.tr).find(">td");$.post("/html/pricing/ajax/item_actions.php?action=getItemInfo",{id:$(this).attr("data-id"),room_id:roomID},function(b){let itemInfo=JSON.parse(b);let fixedPrice=parseFloat(itemInfo.price).toFixed(2);a.addChildren({qty:1,title:itemInfo.sku,width:itemInfo.width,height:itemInfo.height,depth:itemInfo.depth,itemID:itemInfo.id,price:fixedPrice,key:new Date().getTime()*Math.random(999),icon:itemInfo.icon,name:itemInfo.title});recalcTotal()})}).on("change","#catalog",function(){let id=$(this).find(":selected").attr("id");let catalogData={url:"/html/pricing/ajax/nav_menu.php",type:"POST",data:{catalog:id},dataType:"json"};$(this).hide()}).on("click","#cabinet_list_save",function(){let cab_list=JSON.stringify(cabinetList.fancytree("getTree").toDict(true));let cat_id=$("#catalog").find(":selected").attr("id");$.post("/html/pricing/ajax/item_actions.php?action=saveCatalog&room_id="+roomID,{cabinet_list:cab_list,catalog_id:cat_id},function(a){$("body").append(a)})}).on("focus",".qty_input",function(){$(this).select()}).on("keyup",".qty_input",function(){let id=$(this).attr("id");cabinetList.fancytree("getTree").getNodeByKey(id).data.qty=$(this).val()}).on("mouseenter",".view_item_info",function(){let info="";let thisEle=$(this);let infoPopup=$(".info-popup");$.post("/html/pricing/ajax/item_actions.php?action=getItemInfo",{id:thisEle.data("id"),room_id:roomID},function(a){let result=JSON.parse(a);if(result.image!==null){info+="<div class='image'><img src='/html/pricing/images/"+result.image+"' /></div>"}info+="<div class='right_content'><div class='header'><h4>"+result.title+"</h4></div>";info+="<div class='description'>"+result.description+"</div></div>"}).done(function(){let infoHeight=infoPopup.height();let infoTop=mouseY-91;let windowOverflow=$(window).scrollTop()+$(window).height();if((infoHeight+infoTop+100)>windowOverflow){infoPopup.css({bottom:0,top:"inherit",left:mouseX})}else{infoPopup.css({top:infoTop,bottom:"inherit",left:mouseX})}infoPopup.fadeIn(250).html(info)})}).on("mouseleave",".view_item_info",function(){$(".info-popup").fadeOut(250)}).on("change","#catalog",function(){let id=$(this).find(":selected").attr("id");let catalogData={url:"/html/pricing/ajax/nav_menu.php",type:"POST",data:{catalog:id},dataType:"json"};catalog.fancytree("getTree").reload(catalogData)}).on("click",".wrapper",function(){if($(".info-popup").is(":visible")){$(".info-popup").fadeOut()}}).on("change",".item_hinge",function(){let node=cabinetList.fancytree("getActiveNode");node.data.hinge=$(this).find(":selected").val()}).on("change",".item_finish",function(){let node=cabinetList.fancytree("getActiveNode");node.data.finish=$(this).find(":selected").val()}).on("click","#modificationAddSelected",function(){let modifications=itemModifications.fancytree("getTree").getSelectedNodes();cabinetList.fancytree("getTree").getActiveNode().addChildren(modifications);$("#modalAddModification").modal("hide")}).on("change","#ext_carcass_same",function(){if($(this).is(":checked")){$(".ext_finish_block").hide()}else{$(".ext_finish_block").show()}}).on("change","#int_carcass_same",function(){if($(this).is(":checked")){$(".int_finish_block").hide()}else{$(".int_finish_block").show()}}).on("click","#submit_for_quote",function(){let button=$(this);let cab_list=JSON.stringify(cabinetList.fancytree("getTree").toDict(true));$.confirm({title:"Are you sure you want to submit the quote?",content:"You are about to submit this quote. Once submitted you will be <strong>unable</strong> to modify the line items. Are you sure you would like to submit?",type:"red",buttons:{yes:function(){$.post("/html/pricing/ajax/item_actions.php?action=submitQuote&room_id="+roomID,{cabinet_list:cab_list},function(a){$("body").append(a)}).done(function(){button.val("Submitted").prop("disabled",true)})},no:function(){}}})}).on("click","#save_globals",function(){console.log("Saving globals.");let thisClick=this;let val_array={};$(thisClick).removeClass("edit_room_save");let edit_info=$("#pricing_global_attributes").serialize();$("input[type='hidden']").each(function(){let ele=$(this);let field=$(this).attr("id");let custom_fields=["X","Xxx","AX","DX","TX","Xx","WX","1cXXXX","3gXXXX"];if($.inArray(ele.val(),custom_fields)>=0){val_array[field]={};ele.parent().find(".selected").find("input").each(function(){val_array[field][$(this).attr("name")]=$(this).val()})}});let customVals=JSON.stringify(val_array);console.log(edit_info);unsaved=false}).on("click","#category_collapse",function(){catalog.fancytree("getTree").visit(function(a){a.setExpanded(false)})}).on("click","#global_info",function(){$.post("/html/pricing/ajax/global_actions.php?action=modalGlobals&roomID="+roomID,function(a){$("#modalGeneral").html(a).modal("show")})}).on("click","#modalGlobalsUpdate",function(){let globalInfo=$("#modalGlobalData").serialize();$.post("/html/pricing/ajax/global_actions.php?action=updateGlobals&roomID="+roomID,{globalInfo:globalInfo},function(a){$("body").append(a);$("#modalGeneral").html("").modal("hide")})}).on("click","#appliance_ws",function(){$.post("/html/pricing/ajax/global_actions.php?action=modalApplianceWS&roomID="+roomID,function(a){$("#modalGeneral").html(a).modal("show")})}).on("click","#modalAppWSSave",function(){var a=$("#appliance_info").serialize();$.post("/ondemand/room_actions.php?action=save_app_worksheet&room="+roomID+"&"+a,function(b){if(b!=="false"){$(".print_app_ws").attr("id",b);displayToast("success","Successfully saved worksheet information.","Worksheet Saved")}else{displayToast("error","Unable to save worksheet. Please refresh your page.","Unable to Save")}});$("#modalGeneral").html("").modal("hide");unsaved=false}).on("click","#bracket_management",function(){$.post("/html/pricing/ajax/global_actions.php?action=modalBracketMgmt&roomID="+roomID,function(a){$("#modalGeneral").html(a).modal("show")})});$("#modalAddModification").on("show.bs.modal",function(){$("#modificationsFilter").val("");itemModifications.fancytree("getTree").clearFilter();let modificationTree={url:"/html/pricing/ajax/modifications.php?itemID="+cabinetList.fancytree("getTree").getActiveNode().data.itemID,type:"POST",dataType:"json"};itemModifications.fancytree("getTree").reload(modificationTree)});$(function(){cabinetList.fancytree({select:function(b,d){var a=d.tree.getSelectedNodes();var c=$.map(a,function(e){return"["+e.key+"]: '"+e.title+"'"});if(c.length>0){$("#catalog_remove_checked").show()}else{$("#catalog_remove_checked").hide()}},imagePath:"/assets/images/cabinet_icons/",cookieId:"fancytree-cabList",idPrefix:"fancytree-cabList-",checkbox:true,titlesTabbable:true,quicksearch:true,source:{url:"/html/pricing/ajax/item_actions.php?action=getCabinetList&room_id="+roomID},extensions:["edit","dnd","table","gridnav","persist"],debugLevel:0,dnd:{preventVoidMoves:true,preventRecursiveMoves:true,autoExpandMS:400,dragStart:function(a,b){return true},dragEnter:function(a,b){return true},dragDrop:function(a,b){b.otherNode.moveTo(a,b.hitMode)}},edit:{triggerStart:["clickActive","f2","shift+click","mac+enter"],close:function(a,b){if(b.save&&b.isNew){cabinetList.trigger("nodeCommand",{cmd:"addSibling"})}}},table:{indentation:20,nodeColumnIdx:3,checkboxColumnIdx:0},gridnav:{autofocusInput:false,handleCursorKeys:true},renderColumns:function(b,c){var a=c.node,d=$(a.tr).find(">td");let qty=parseInt(a.data.qty);let price=parseFloat(a.data.price);let line_total=qty*price;d.eq(1).text(a.getIndexHier());d.eq(2).find("input").attr("id",a.key).val(a.data.qty);d.eq(4).text(a.data.name);d.eq(5).text(a.data.width);d.eq(6).text(a.data.height);d.eq(7).text(a.data.depth);if(a.data.hinge!==undefined){d.eq(8).find(".item_hinge").val(a.data.hinge)}if(a.data.finish!==undefined){d.eq(9).find(".item_finish").val(a.data.finish)}if(!isNaN(price)){d.eq(10).text(price.formatMoney()).removeAttr("style title");$(".no_global_info").css("display","none");if(!already_submitted){$("#submit_for_quote").attr("disabled",false).attr("title","")}}else{d.eq(10).css("background-color","#FF0000").attr("title","Unknown global attributes, unable to find price.");d.eq(11).css("background-color","#FF0000").attr("title","Unknown global attributes, unable to properly calculate total.");$("#submit_for_quote").attr("disabled",true).attr("title","Unknown global attributes, unable to submit.");$(".no_global_info").css("display","block")}d.eq(11).text(a.data.total)},modifyChild:function(a,b){recalcTotal()}}).on("nodeCommand",function(d,e){var b,f,a=$(this).fancytree("getTree"),c=a.getActiveNode();switch(e.cmd){case"moveUp":b=c.getPrevSibling();if(b){c.moveTo(b,"before");c.setActive()}break;case"moveDown":b=c.getNextSibling();if(b){c.moveTo(b,"after");c.setActive()}break;case"indent":b=c.getPrevSibling();if(b){c.moveTo(b,"child");b.setExpanded();c.setActive()}break;case"outdent":if(!c.isTopLevel()){c.moveTo(c.getParent(),"after");c.setActive()}break;case"rename":c.editStart();break;case"remove":b=c.getNextSibling()||c.getPrevSibling()||c.getParent();c.remove();if(b){b.setActive()}break;case"addModifications":$("#modalAddModification").modal("show");break;case"cut":CLIPBOARD={mode:e.cmd,data:c};break;case"copy":CLIPBOARD={mode:e.cmd,data:c.toDict(function(g){delete g.key})};break;case"clear":CLIPBOARD=null;break;case"paste":if(CLIPBOARD.mode==="cut"){CLIPBOARD.data.moveTo(c,"child");CLIPBOARD.data.setActive()}else{if(CLIPBOARD.mode==="copy"){c.addChildren(CLIPBOARD.data).setActive()}}break;default:alert("Unhandled command: "+e.cmd);return}}).on("keydown",function(b){var a=null;switch($.ui.fancytree.eventToString(b)){case"ctrl+shift+n":case"meta+shift+n":a="addChild";break;case"ctrl+c":case"meta+c":a="copy";break;case"ctrl+v":case"meta+v":a="paste";break;case"ctrl+x":case"meta+x":a="cut";break;case"ctrl+n":case"meta+n":a="addSibling";break;case"del":case"meta+backspace":a="remove";break;case"ctrl+up":a="moveUp";break;case"ctrl+down":a="moveDown";break;case"ctrl+right":case"ctrl+shift+right":a="indent";break;case"ctrl+left":case"ctrl+shift+left":a="outdent"}if(a){$(this).trigger("nodeCommand",{cmd:a});return false}});cabinetList.contextmenu({delegate:"span.fancytree-node",menu:[{title:"Delete <kbd>[Del]</kbd>",cmd:"remove",uiIcon:"ui-icon-trash"},{title:"----"},{title:"Add Modifications <kbd>[Ctrl+M]</kbd>",cmd:"addModifications",uiIcon:"ui-icon-plus"},{title:"----"},{title:"Cut <kbd>Ctrl+X</kbd>",cmd:"cut",uiIcon:"ui-icon-scissors"},{title:"Copy <kbd>Ctrl-C</kbd>",cmd:"copy",uiIcon:"ui-icon-copy"},{title:"Paste<kbd>Ctrl+V</kbd>",cmd:"paste",uiIcon:"ui-icon-clipboard",disabled:true}],beforeOpen:function(b,c){var a=$.ui.fancytree.getNode(c.target);cabinetList.contextmenu("enableEntry","paste",!!CLIPBOARD);a.setActive()},select:function(b,c){var a=this;setTimeout(function(){$(a).trigger("nodeCommand",{cmd:c.cmd})},100)}});catalog.fancytree({source:{url:"/html/pricing/ajax/nav_menu.php"},extensions:["filter"],debugLevel:0,filter:{autoApply:true,autoExpand:true,counter:true,fuzzy:true,hideExpandedCounter:true,hideExpanders:false,highlight:true,leavesOnly:false,nodata:false,mode:"hide"}});itemModifications.fancytree({source:{url:"/html/pricing/ajax/modifications.php"},extensions:["filter"],debugLevel:0,filter:{autoApply:true,autoExpand:true,counter:true,fuzzy:true,hideExpandedCounter:true,hideExpanders:false,highlight:true,leavesOnly:false,nodata:true,mode:"hide"}});if($("#ext_carcass_same").is(":checked")){$(".ext_finish_block").hide()}else{$(".ext_finish_block").show()}if($("#int_carcass_same").is(":checked")){$(".int_finish_block").hide()}else{$(".int_finish_block").show()}if($("#submit_for_quote").prop("disabled")){$.confirm({title:"Item List Submitted.",content:"You are unable to save this form. It has already been submitted. Please check with your representative if you require any modifications.",type:"red",buttons:{ok:function(){}}})}});