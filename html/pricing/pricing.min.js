jQuery.expr.filters.offscreen=function(a){var b=a.getBoundingClientRect();return((b.x+b.width)<0||(b.y+b.height)<0||(b.x>window.innerWidth||b.y>window.innerHeight))};function delNoData(){let getNegNode=cabinetList.fancytree("getTree").getNodeByKey("-1");if(getNegNode!==null){cabinetList.fancytree("getTree").getNodeByKey("-1").remove()}}function recalcSummary(){let global_room_charges=0;let global_cab_charges=0;let line_total=0;let cabinet_only_total=0;let cabinet_only_skus="";let non_cabinet_total=0;let non_cabinet_skus="";let shipVia=$("#ship_via").val();cabinetList.fancytree("getTree").visit(function(a){let qty=parseInt(a.data.qty);let price=parseFloat(a.data.price);let $tdList=$(a.tr).find(">td");if(a.data.addlMarkup!==undefined&&a.data.addlMarkup!==""&&a.data.addlMarkup!==null){let addlMarkup=JSON.parse(a.data.addlMarkup);$.each(addlMarkup,function(c,b){let curVal=$("#"+c).val();$.each(b,function(d,e){if(d===curVal){price=parseFloat(e)*price}})})}let lineTotal=qty*price;$tdList.eq(9).text(lineTotal.formatMoney());if(a.data.cabinet==="1"){cabinet_only_total+=parseFloat(lineTotal);cabinet_only_skus+=a.title+", "}else{non_cabinet_total+=parseFloat(lineTotal);non_cabinet_skus+=a.title+", "}line_total+=parseFloat(lineTotal)});cabinet_only_skus=cabinet_only_skus.slice(0,-2);non_cabinet_skus=non_cabinet_skus.slice(0,-2);$("#itemListTotal").text(line_total.formatMoney());let gt_pct=$("#gt_pct");let gt_amt=$("#gt_amt");let gt_markup=0;switch($("#glaze_technique").val()){case"G2":gt_markup=0.1;break;case"G0":gt_amt.text("");break;default:gt_amt.text("ERR");break}let gt_cost=line_total*gt_markup;gt_amt.text(gt_cost.formatMoney());gt_pct.text((gt_markup*100).toFixed(2)+"%");global_cab_charges+=gt_cost;let shipPrice=0;if(shipVia!=="4"){shipPrice=$("#shipping_cost").attr("data-cost");global_room_charges+=parseFloat(shipPrice);console.log("ShipVia is not customer pickup.")}$("#itemListGlobalCabDetails").text(global_cab_charges.formatMoney());let subtotal1=global_cab_charges+line_total;$("#itemListSubTotal1").text(subtotal1.formatMoney());let multiplier=parseFloat($("#itemListMultiplier").text());let netPrice=(line_total+global_cab_charges)*multiplier;$("#itemListNET").text(netPrice.formatMoney());let productTypeOpt=$("#product_type").val();let productTypeMarkup=0;if(productTypeOpt==="B"){productTypeMarkup=0.1}let productTypeCost=cabinet_only_total*productTypeMarkup;$("#product_type_cost").text(productTypeCost.formatMoney());global_room_charges+=productTypeCost;$("#itemListGlobalRoomDetails").text(global_room_charges.formatMoney());let subtotal=netPrice+global_room_charges;$("#finalSubTotal").text(subtotal.formatMoney());$("#finalTotal").text(subtotal.formatMoney());let deposit=subtotal*0.5;$("#finalDeposit").text(deposit.formatMoney());$("#calcProductType").text("Cabinet Only Total ("+cabinet_only_total+") * Product Type Markup ("+productTypeMarkup+")");$("#calcProductTypeTotal").text((cabinet_only_total*productTypeMarkup).formatMoney());$("#calcLeadTime").text("Lead Time (Green) * Total [Hardcoded]");$("#calcLeadTimeTotal").text("$0.00 [Hardcoded]");$("#calcShipVIA").text("Cycle Truck [Hardcoded]");$("#calcShipVIATotal").text("$0.00 [Hardcoded]");let shipMileInfo=JSON.parse(calcShipInfo);if(shipVia!=="4"){$("#calcShipZone").html("Mileage ("+shipMileInfo.miles+") - "+shipMileInfo.zone+"<br /><br />Calculated based on Shipping Zip entered into Ship To, if that is empty, use Dealer Zip.<br /><br />0-100 Ship Zone A, $0.00<br />100-200 Ship Zone B, $150.00<br />200-300 Ship Zone C, $300.00<br />300-400 Ship Zone D, $450.00<br />400-500 Ship Zone E, $600.00");$("#calcShipZoneTotal").text(shipMileInfo.cost.formatMoney())}else{$("#calcShipZone").html("Customer Pickup");$("#calcShipZoneTotal").text("$0.00")}$("#calcGlazeTech").html("Total ("+line_total.toFixed(2)+") * Glaze Markup ("+gt_markup+")");$("#calcGlazeTechTotal").html(gt_cost.formatMoney());$("#calcCabinetLines").html("Cabinets: "+cabinet_only_skus);$("#calcCabinetLinesTotal").html(cabinet_only_total.formatMoney());$("#calcNonCabLines").html("Non-Cabinets: "+non_cabinet_skus);$("#calcNonCabLinesTotal").html(non_cabinet_total.formatMoney())}function footCalc(a){let $tdList=$(a.tr).find(">td");let outprice=0;if(parseInt(a.data.sqft)===1){let line_sqft=(parseFloat(a.data.width)*parseFloat(a.data.depth))/144;let line_total=line_sqft*a.data.singlePrice;$tdList.eq(8).text(line_total.formatMoney());outprice=line_total}else{if(parseInt(a.data.linft)===1){let line_linft=(parseFloat(a.data.width)/12)*a.data.singlePrice;$tdList.eq(8).text(line_linft.formatMoney());outprice=line_linft}else{outprice=a.data.price}}return outprice}function fullRecalc(){cabinetList.fancytree("getTree").visit(function(b){let itemID=b.data.itemID;let key=b.key;var a=cabinetList.fancytree("getTree");$.post("/html/pricing/ajax/item_actions.php?action=getItemInfo",{id:itemID,room_id:active_room_id},function(c){let itemInfo=JSON.parse(c);let fixedPrice=parseFloat(itemInfo.price).toFixed(2);let node=a.getNodeByKey(key);node.title=itemInfo.sku;node.data.price=fixedPrice;node.icon=itemInfo.icon;node.data.name=itemInfo.title;node.data.sqft=itemInfo.sqft;node.data.singlePrice=fixedPrice;node.data.cabinet=itemInfo.cabinet;node.data.addlMarkup=itemInfo.addl_markup})})}function fetchDebug(){cabinetList.fancytree("getTree").visit(function(a){console.log(a)})}function genKey(){return new Date().getTime()*Math.random(999)}var mouseX,mouseY;$(document).mousemove(function(a){mouseX=a.pageX;mouseY=a.pageY});var CLIPBOARD=null;var cabinetList=$("#cabinet_list");var catalog=$("#catalog_categories");var itemModifications=$("#item_modifications");$("body").on("keyup","#treeFilter",function(){catalog.fancytree("getTree").filterNodes($(this).val())}).on("keyup","#modificationsFilter",function(){itemModifications.fancytree("getTree").filterNodes($(this).val())}).on("click","#item_custom_line",function(){var a=cabinetList.fancytree("getRootNode");var b=a.addChildren({qty:1,title:"NOTE",price:0,key:genKey(),icon:"fa fa-commenting-o",name:"Error",sqft:0,singlePrice:0,cabinet:0});let $tdList=$(b.tr).find(">td");$tdList.eq(4).html('<input type="text" class="form-control custom-line-item" placeholder="Custom Description..." data-id="'+b.key+'" >')}).on("click",".delete_item",function(){var a=cabinetList.fancytree("getTree");a.getFocusNode().remove();cabinetList.fancytree("getRootNode").render(true,true);recalcSummary()}).on("click","#save",function(){var d={};var c=$("#cabinet_specifications").serialize();var e=null;var a=$("#accounting_notes").serialize();var b=JSON.stringify(getMiniTree(cabinetList));$("input[type='hidden']").each(function(){var g=$(this);var h=$(this).attr("id");var f=["X","Xxx","AX","DX","TX","Xx","WX","1cXXXX","3gXXXX","HW","KW"];if($.inArray(g.val(),f)>=0){d[h]={};g.parent().find(".selected").find("input").each(function(){d[h][$(this).attr("name")]=$(this).val()})}});e=JSON.stringify(d);$.post("/html/pricing/ajax/global_actions.php?action=roomSave&room_id="+active_room_id,{cabinet_list:b,customVals:e,cabinet_specifications:c,accounting_notes:a},function(f){$("body").append(f)});unsaved=false}).on("focus",".qty_input",function(){$(this).select()}).on("keyup",".qty_input",function(){let id=$(this).attr("data-id");cabinetList.fancytree("getTree").getNodeByKey(id).data.qty=$(this).val()}).on("change",".qty_input",function(){recalcSummary()}).on("click",".add_item_cabinet_list",function(){delNoData();var a=cabinetList.fancytree("getRootNode");let $tdList=$(a.tr).find(">td");$.post("/html/pricing/ajax/item_actions.php?action=getItemInfo",{id:$(this).attr("data-id"),room_id:active_room_id},function(b){let itemInfo=JSON.parse(b);let fixedPrice=parseFloat(itemInfo.price).toFixed(2);a.addChildren({qty:1,title:itemInfo.sku,width:itemInfo.width,height:itemInfo.height,depth:itemInfo.depth,itemID:itemInfo.id,price:fixedPrice,key:genKey(),icon:itemInfo.icon,name:itemInfo.title,sqft:itemInfo.sqft,singlePrice:fixedPrice,cabinet:itemInfo.cabinet,addlMarkup:itemInfo.addlMarkup});recalcSummary()})}).on("change","#catalog",function(){let id=$(this).find(":selected").attr("id");let catalogData={url:"/html/pricing/ajax/nav_menu.php",type:"POST",data:{catalog:id},dataType:"json"};$(this).hide()}).on("click","#cabinet_list_save",function(){let cab_list=JSON.stringify(cabinetList.fancytree("getTree").toDict(true));let cat_id=$("#catalog").find(":selected").attr("id");$.post("/html/pricing/ajax/item_actions.php?action=saveCatalog&room_id="+active_room_id,{cabinet_list:cab_list,catalog_id:cat_id},function(a){$("body").append(a)})}).on("mouseenter",".view_item_info",function(){let info="";let thisEle=$(this);let infoPopup=$(".info-popup");$.post("/html/pricing/ajax/item_actions.php?action=getItemInfo",{id:thisEle.data("id"),room_id:active_room_id},function(a){let result=JSON.parse(a);if(result.image!==null){info+="<div class='image'><img src='/html/pricing/images/"+result.image+"' /></div>"}info+="<div class='right_content'><div class='header'><h4>"+result.title+"</h4></div>";info+="<div class='description'>"+result.description+"</div></div>"}).done(function(){let infoHeight=infoPopup.height();let infoTop=mouseY-91;let windowOverflow=$(window).scrollTop()+$(window).height();if((infoHeight+infoTop+100)>windowOverflow){infoPopup.css({bottom:0,top:"inherit",left:mouseX})}else{infoPopup.css({top:infoTop,bottom:"inherit",left:mouseX})}infoPopup.fadeIn(250).html(info)})}).on("mouseleave",".view_item_info",function(){$(".info-popup").fadeOut(250)}).on("change","#catalog",function(){let id=$(this).find(":selected").attr("id");let catalogData={url:"/html/pricing/ajax/nav_menu.php",type:"POST",data:{catalog:id},dataType:"json"};catalog.fancytree("getTree").reload(catalogData)}).on("click",".wrapper",function(){if($(".info-popup").is(":visible")){$(".info-popup").fadeOut()}}).on("change",".item_hinge",function(){let node=cabinetList.fancytree("getActiveNode");node.data.hinge=$(this).find(":selected").val()}).on("change",".item_finish",function(){let node=cabinetList.fancytree("getActiveNode");node.data.finish=$(this).find(":selected").val()}).on("click","#modificationAddSelected",function(){let modifications=itemModifications.fancytree("getTree").getSelectedNodes();let cablist=cabinetList.fancytree("getTree").getActiveNode();$.each(modifications,function(b,a){let addlInfo="";if(a.data.addlInfo!==undefined){addlInfo=" "+a.data.addlInfo}let fixedPrice=parseFloat(a.data.price).toFixed(2);cablist.addChildren({qty:1,title:a.title,itemID:a.itemID,price:fixedPrice,key:genKey(),icon:a.icon,name:a.data.description+addlInfo,sqft:a.sqft,linft:a.data.linft,singlePrice:fixedPrice,cabinet:a.data.cabinet,addlMarkup:a.data.addlMarkup,subLine:true})});cablist.setExpanded();$("#modalAddModification").modal("hide")}).on("change","#ext_carcass_same",function(){if($(this).is(":checked")){$(".ext_finish_block").hide()}else{$(".ext_finish_block").show()}}).on("change","#int_carcass_same",function(){if($(this).is(":checked")){$(".int_finish_block").hide()}else{$(".int_finish_block").show()}}).on("click","#submit_for_quote",function(){let button=$(this);let cab_list=JSON.stringify(cabinetList.fancytree("getTree").toDict(true));$.confirm({title:"Are you sure you want to submit the quote?",content:"You are about to submit this quote. Once submitted you will be <strong>unable</strong> to modify the line items. Are you sure you would like to submit?",type:"red",buttons:{yes:function(){$.post("/html/pricing/ajax/item_actions.php?action=submitQuote&room_id="+active_room_id,{cabinet_list:cab_list},function(a){$("body").append(a)}).done(function(){button.val("Submitted").prop("disabled",true)})},no:function(){}}})}).on("click","#category_collapse",function(){catalog.fancytree("getTree").visit(function(a){a.setExpanded(false)})}).on("click","#global_info",function(){$.post("/html/pricing/ajax/global_actions.php?action=modalGlobals&roomID="+active_room_id,function(a){$("#modalGeneral").html(a).modal("show")})}).on("click","#modalGlobalsUpdate",function(){let globalInfo=$("#modalGlobalData").serialize();$.post("/html/pricing/ajax/global_actions.php?action=updateGlobals&roomID="+active_room_id,{globalInfo:globalInfo},function(a){$("body").append(a);$("#modalGeneral").html("").modal("hide")})}).on("click","#appliance_ws",function(){$.post("/html/pricing/ajax/global_actions.php?action=modalApplianceWS&roomID="+active_room_id,function(a){$("#modalGeneral").html(a).modal("show")})}).on("click","#modalAppWSSave",function(){var a=$("#appliance_info").serialize();$.post("/ondemand/room_actions.php?action=save_app_worksheet&room="+active_room_id+"&"+a,function(b){if(b!=="false"){$(".print_app_ws").attr("id",b);displayToast("success","Successfully saved worksheet information.","Worksheet Saved")}else{displayToast("error","Unable to save worksheet. Please refresh your page.","Unable to Save")}});$("#modalGeneral").html("").modal("hide");unsaved=false}).on("click","#bracket_management",function(){$.post("/html/pricing/ajax/global_actions.php?action=modalBracketMgmt&roomID="+active_room_id,function(a){$("#modalGeneral").html(a).modal("show")})}).on("click","#modalBracketSave",function(){var b=$(".active_ops_"+active_room_id).map(function(){return $(this).data("opid")}).get();var a=$("#bracketAdjustments").serialize();b=JSON.stringify(b);$.post("/html/pricing/ajax/global_actions.php?action=updateBracket&roomID="+active_room_id,{active_ops:b,bracket_status:a},function(c){$("body").append(c)});$("#modalGeneral").html("").modal("hide")}).on("click",".option",function(){let dropdown_list=$(this).parent().parent();if(dropdown_list.attr("data-for")==="ship_via"){let ship_info=$("input[name='ship_to_name']").parent().parent();if($(this).attr("data-value")==="4"){ship_info.hide();ship_info.next("tr").hide();ship_info.next("tr").next("tr").hide()}else{ship_info.show();ship_info.next("tr").show();ship_info.next("tr").next("tr").show()}}else{if(dropdown_list.attr("data-for")==="product_type"){let species_grade=$("#species_grade");let door_design=$("#door_design");let construction_method=$("#construction_method");if($(this).attr("data-value")==="L"){if(species_grade.val()===""){species_grade.attr("value","Me").parent().find(".selected").html("Melamine")}if(door_design.val()===""){door_design.attr("value","ME0").parent().find(".selected").html("Melamine")}if(construction_method.val()===""){construction_method.attr("value","C").parent().find(".selected").html("Closet - Cam")}}}}}).on("click","#ship_date_recalc",function(){let dts=$("#days_to_ship").val();$.post("/html/pricing/ajax/global_actions.php?action=calcShipDate",{days_to_ship:dts,room_id:active_room_id},function(a){let result=JSON.parse(a);$("#calcd_ship_date").html(result.ship_date);$("#calcd_del_date").html(result.del_date)})}).on("click","#terms_confirm",function(){let signature=$(".esig").val();let ip=$(".esig_id").html();let button=$("#terms_confirm");if($.trim(signature)!==""){$.confirm({title:"Sign & Agree to Quote",content:signature+", you agree to the following:<br /><br />Once submitted, the deposit of 50% will be drafted from your account within 24 hours.<br />Once the deposit has been processed a shipping/delivery date will be provided.<br />Final payment is due prior to delivery.<br />You have the authorization to legally sign this document.<br /><br />"+ip,type:"red",buttons:{"I Agree":function(){$.post("/html/pricing/ajax/global_actions.php?action=termsSign&room_id="+active_room_id,{sig:signature},function(a){$("body").append(a)}).done(function(){button.hide()})},"I Disagree":function(){}}})}}).on("keyup",".esig",function(){if($.trim($(this).val())!==""){$("#terms_confirm").prop("disabled",false)}else{$("#terms_confirm").prop("disabled",true)}}).on("keyup",".modAddlInfo",function(){let id=$(this).attr("id");itemModifications.fancytree("getTree").getNodeByKey(id).data.addlInfo=$(this).val()}).on("keyup",".itm_width",function(){let id=$(this).attr("data-id");let node=cabinetList.fancytree("getTree").getNodeByKey(id);node.data.width=$(this).val();node.data.price=footCalc(node);recalcSummary()}).on("keyup",".itm_height",function(){let id=$(this).attr("data-id");let node=cabinetList.fancytree("getTree").getNodeByKey(id);node.data.height=$(this).val();node.data.price=footCalc(node);recalcSummary()}).on("keyup",".itm_depth",function(){let id=$(this).attr("data-id");let node=cabinetList.fancytree("getTree").getNodeByKey(id);node.data.depth=$(this).val();node.data.price=footCalc(node);recalcSummary()}).on("click","#pricingSpeciesGrade, #pricingDoorDesign",function(){let speciesGrade=$("#species_grade").val();let doorDesign=$("#door_design").val();$.post("/html/pricing/ajax/global_actions.php?action=getPriceGroup&speciesGrade="+speciesGrade+"&doorDesign="+doorDesign,function(a){$("#cab_spec_pg").text(a);priceGroup=a});recalcSummary()}).on("keyup",".custom-line-item",function(){let id=$(this).attr("data-id");let node=cabinetList.fancytree("getTree").getNodeByKey(id);node.data.name=$(this).val()}).on("click",".add_item_mod",function(){$("#modalAddModification").modal("show")}).on("click",".item_copy",function(){let activeNode=cabinetList.fancytree("getTree").getActiveNode();cabinetList.fancytree("getRootNode").addChildren(activeNode)}).on("click","#detailed_item_summary",function(){$("#modalDetailedItemList").modal("show")});