jQuery.expr.filters.offscreen=function(a){var b=a.getBoundingClientRect();return((b.x+b.width)<0||(b.y+b.height)<0||(b.x>window.innerWidth||b.y>window.innerHeight))};var pricingVars={nameOfUser:null,roomQry:null,vinInfo:null,shipCost:null};var pricingFunction={productTypeSwitch:function(){function a(b){let gPct=2;let yPct=2;let nPct=2;let rPct=2;if(b.green.unavailable!==true){$(".dts_pct_g").html("["+b.green.ship_days+" Days] ("+(b.green.pct*100)+"%)");gPct=b.green.pct}else{$(".dts_pct_g").html("[Not Available]")}if(b.yellow.unavailable!==true){$(".dts_pct_y").html("["+b.yellow.ship_days+" Days] ("+(b.yellow.pct*100)+"%)");yPct=b.yellow.pct}else{$(".dts_pct_y").html("[Not Available]")}if(b.orange.unavailable!==true){$(".dts_pct_n").html("["+b.orange.ship_days+" Days] ("+(b.orange.pct*100)+"%)");nPct=b.orange.pct}else{$(".dts_pct_n").html("[Not Available]")}if(b.red.unavailable!==true){$(".dts_pct_r").html("["+b.red.ship_days+" Days] ("+(b.red.pct*100)+"%)");rPct=b.red.pct}else{$(".dts_pct_r").html("[Not Available]")}let dts_id=$("#days_to_ship");switch($("#product_type").val()){case"G":dts_id.attr("data-pct",gPct);break;case"N":dts_id.attr("data-pct",nPct);break;case"Y":dts_id.attr("data-pct",yPct);break;case"R":dts_id.attr("data-pct",rPct);break}}switch($("#product_type").val()){case"C":a({green:{ship_days:26,pct:0},yellow:{ship_days:19,pct:0.25},orange:{ship_days:13,pct:0.5},red:{unavailable:true}});break;case"L":a({green:{ship_days:26,pct:0},yellow:{ship_days:19,pct:0.25},orange:{ship_days:13,pct:0.5},red:{ship_days:6,pct:0.5}});break;case"P":a({green:{ship_days:26,pct:0},yellow:{ship_days:19,pct:0.25},orange:{ship_days:13,pct:0.5},red:{ship_days:6,pct:0.5}});break;case"S":a({green:{unavailable:true},yellow:{unavailable:true},orange:{ship_days:13,pct:0},red:{ship_days:6,pct:0}});break;case"D":a({green:{ship_days:26,pct:0},yellow:{unavailable:true},orange:{unavailable:true},red:{unavailable:true}});break;case"A":a({green:{unavailable:true},yellow:{ship_days:19,pct:0},orange:{ship_days:13,pct:0.25},red:{ship_days:6,pct:0.25}});break;case"W":a({green:{unavailable:true},yellow:{ship_days:19,pct:0},orange:{ship_days:13,pct:0},red:{ship_days:6,pct:0}});break;case"H":a({green:{unavailable:true},yellow:{unavailable:true},orange:{ship_days:13,pct:0},red:{unavailable:true}});break;case"N":a({green:{unavailable:true},yellow:{unavailable:true},orange:{ship_days:13,pct:0},red:{unavailable:true}});break;case"R":a({green:{unavailable:true},yellow:{unavailable:true},orange:{unavailable:true},red:{unavailable:true}});break}},delNoData:function(){let getNegNode=cabinetList.fancytree("getTree").getNodeByKey("-1");if(getNegNode!==null){cabinetList.fancytree("getTree").getNodeByKey("-1").remove()}},recalcSummary:function(){let global_room_charges=0,global_cab_charges=0,line_total=0,cabinet_only_total=0,cabinet_only_skus="",non_cabinet_total=0,non_cabinet_skus="",shipVia=pricingVars.roomQry.ship_via;cabinetList.fancytree("getTree").visit(function(a){let qty=parseInt(a.data.qty),price=parseFloat(a.data.price),$tdList=$(a.tr).find(">td");if(a.data.addlMarkup!==undefined&&a.data.addlMarkup!==""&&a.data.addlMarkup!==null){let addlMarkup=JSON.parse(a.data.addlMarkup);$.each(addlMarkup,function(c,b){let curVal=pricingVars.roomQry[c];$.each(b,function(e,f){if(e===curVal){price=parseFloat(f)*price}})})}let lineTotal=0;if(pricingVars.roomQry.product_type==="W"){$tdList.eq(9).text("$0.00")}else{if(a.data.customPrice===1){let cPrice=parseFloat(price.toString().replace("$",""));lineTotal=cPrice;$tdList.eq(9).find("input").val(cPrice.formatMoney())}else{lineTotal=qty*price;$tdList.eq(9).text(lineTotal.formatMoney())}}if(a.data.cabinet==="1"){cabinet_only_total+=parseFloat(lineTotal);cabinet_only_skus+=a.title+", "}else{non_cabinet_total+=parseFloat(lineTotal);non_cabinet_skus+=a.title+", "}line_total+=parseFloat(lineTotal)});cabinet_only_skus=cabinet_only_skus.slice(0,-2);non_cabinet_skus=non_cabinet_skus.slice(0,-2);$("#itemListTotal").text(line_total.formatMoney());let gt_pct=$("#gt_pct"),gt_amt=$("#gt_amt");let ggard_pct=$("#ggard_pct"),ggard_amt=$("#ggard_amt");let fcode_pct=$("#fc_pct"),fcode_amt=$("#fc_amt");let sheen_pct=$("#sheen_pct"),sheen_amt=$("#sheen_amt");let gt_markup=pricingVars.vinInfo.glaze_technique[pricingVars.roomQry.glaze_technique].markup;let ggard_markup=pricingVars.vinInfo.green_gard[pricingVars.roomQry.green_gard].markup;let fcode_markup=pricingVars.vinInfo.finish_code[pricingVars.roomQry.finish_code].markup;let sheen_markup=pricingVars.vinInfo.sheen[pricingVars.roomQry.sheen].markup;let gt_cost=line_total*gt_markup;let ggard_cost=line_total*ggard_markup;let fcode_cost=line_total*fcode_markup;let sheen_cost=line_total*sheen_markup;gt_amt.text(gt_cost.formatMoney());gt_pct.text((gt_markup*100).toFixed(2)+"%");ggard_amt.text(ggard_cost.formatMoney());ggard_pct.text((ggard_markup*100).toFixed(2)+"%");fcode_amt.text(fcode_cost.formatMoney());fcode_pct.text((fcode_markup*100).toFixed(2)+"%");sheen_amt.text(sheen_cost.formatMoney());sheen_pct.text((sheen_markup*100).toFixed(2)+"%");global_cab_charges+=gt_cost;global_cab_charges+=ggard_cost;global_cab_charges+=fcode_cost;global_cab_charges+=sheen_cost;if(shipVia!=="4"){global_room_charges+=parseFloat(pricingVars.shipCost)}$("#itemListGlobalCabDetails").text(global_cab_charges.formatMoney());let subtotal1=global_cab_charges+line_total;$("#itemListSubTotal1").text(subtotal1.formatMoney());let multiplier=parseFloat($("#itemListMultiplier").text());let netPrice=(line_total+global_cab_charges)*multiplier;$("#itemListNET").text(netPrice.formatMoney());let productTypeOpt=$("#product_type").val();let productTypeMarkup=0;if(productTypeOpt==="B"){productTypeMarkup=0.1}let productTypeCost=cabinet_only_total*productTypeMarkup;$("#product_type_cost").text(productTypeCost.formatMoney());global_room_charges+=productTypeCost;$("#itemListGlobalRoomDetails").text(global_room_charges.formatMoney());let subtotal=netPrice+global_room_charges;$("#finalSubTotal").text(subtotal.formatMoney());$("#finalTotal").text(subtotal.formatMoney());let deposit=subtotal*0.5;$("#finalDeposit").text(deposit.formatMoney());$("#calcProductType").text("Cabinet Only Total ("+cabinet_only_total+") * Product Type Markup ("+productTypeMarkup+")");$("#calcProductTypeTotal").text((cabinet_only_total*productTypeMarkup).formatMoney());$("#calcLeadTime").text("Lead Time (Green) * Total [Hardcoded]");$("#calcLeadTimeTotal").text("$0.00 [Hardcoded]");$("#calcShipVIA").text("Cycle Truck [Hardcoded]");$("#calcShipVIATotal").text("$0.00 [Hardcoded]");let shipMileInfo=JSON.parse(calcShipInfo);if(shipVia!=="4"){$("#calcShipZone").html("Mileage ("+shipMileInfo.miles+") - "+shipMileInfo.zone+"<br /><br />Calculated based on Shipping Zip entered into Ship To, if that is empty, use Dealer Zip.<br /><br />0-100 Ship Zone A, $0.00<br />100-200 Ship Zone B, $150.00<br />200-300 Ship Zone C, $300.00<br />300-400 Ship Zone D, $450.00<br />400-500 Ship Zone E, $600.00");$("#calcShipZoneTotal").text(shipMileInfo.cost.formatMoney())}else{$("#calcShipZone").html("Customer Pickup");$("#calcShipZoneTotal").text("$0.00")}$("#calcGlazeTech").html("Total ("+line_total.toFixed(2)+") * Glaze Markup ("+gt_markup+")");$("#calcGlazeTechTotal").html(gt_cost.formatMoney());$("#calcGreenGard").html("Total ("+line_total.toFixed(2)+") * Green Gard Markup ("+ggard_markup+")");$("#calcGreenGardTotal").html(ggard_cost.formatMoney());$("#calcSheen").html("Total ("+line_total.toFixed(2)+") * Sheen Markup ("+sheen_markup+")");$("#calcSheenTotal").html(sheen_cost.formatMoney());$("#calcFinishCode").html("Total ("+line_total.toFixed(2)+") * Finish Markup ("+fcode_markup+")");$("#calcFinishCodeTotal").html(fcode_cost.formatMoney());$("#calcCabinetLines").html("Cabinets: "+cabinet_only_skus);$("#calcCabinetLinesTotal").html(cabinet_only_total.formatMoney());$("#calcNonCabLines").html("Non-Cabinets: "+non_cabinet_skus);$("#calcNonCabLinesTotal").html(non_cabinet_total.formatMoney())},footCalc:function(a){let $tdList=$(a.tr).find(">td");let outprice=a.data.price;if(a.data.width>0&&a.data.height>0){if(parseInt(a.data.sqft)===1){let line_sqft=(parseFloat(a.data.width)*parseFloat(a.data.height))/144;let line_total=line_sqft*a.data.singlePrice;$tdList.eq(8).text(line_total.formatMoney());outprice=line_total}else{if(parseInt(a.data.linft)===1){let line_linft=(parseFloat(a.data.width)/12)*a.data.singlePrice;$tdList.eq(8).text(line_linft.formatMoney());outprice=line_linft}}}return outprice},fullRecalc:function(){cabinetList.fancytree("getTree").visit(function(b){let itemID=b.data.itemID;let key=b.key;var a=cabinetList.fancytree("getTree");$.post("/html/pricing/ajax/item_actions.php?action=getItemInfo",{id:itemID,room_id:active_room_id},function(c){if(c!==""&&b.data.customPrice!==1){let itemInfo=JSON.parse(c);let fixedPrice=parseFloat(itemInfo.price).toFixed(2);let node=a.getNodeByKey(key);if(node.data.cabinet===1){node.setTitle(itemInfo.sku)}node.data.price=fixedPrice;node.icon=itemInfo.icon;node.data.name=itemInfo.title;node.data.sqft=itemInfo.sqft;node.data.singlePrice=fixedPrice;node.data.cabinet=itemInfo.cabinet;node.data.addlMarkup=itemInfo.addl_markup}}).done(function(){pricingFunction.recalcSummary()})});displayToast("success","Successfully recalculated the pricing.","Pricing Recalculated")},fetchDebug:function(){cabinetList.fancytree("getTree").visit(function(a){console.log(a)})},genKey:function(){return new Date().getTime()*Math.random(999)},updateShipDate:function(){let dts=$("#days_to_ship").val();$.post("/html/pricing/ajax/global_actions.php?action=calcShipDate",{days_to_ship:dts,room_id:active_room_id},function(a){let result=JSON.parse(a);$("#calcd_ship_date").html(result.ship_date);$("#calcd_del_date").html(result.del_date)})},checkNote:function(b,c,e,a){let note=$(c).val();if(note!==""){let d=new Date();let month=d.getMonth()+1;let date=month+"/"+d.getDate()+"/"+d.getFullYear();let hours=d.getHours();let mins=d.getMinutes();let secs=d.getSeconds();let am_pm=null;if(hours<12){am_pm="AM"}else{am_pm="PM"}if(hours===0){hours=12}if(hours>12){hours=hours-12}mins=mins+"";if(mins.length===1){mins="0"+mins}secs=secs+"";if(secs.length===1){secs="0"+secs}let time=hours+":"+mins+":"+secs+" "+am_pm;let followup_on=$(e).val();let followup_by=$(a).find(":selected").text();let followup="";if(followup_on!==""){followup="(Followup by "+followup_by+" on "+followup_on+")"}let output="<tr><td>"+note+" -- <small><em>"+pricingVars.nameOfUser+" on "+date+" "+time+" "+followup+' </em></small></td></tr><tr style="height:2px;"><td colspan="2" style="background-color:#000;"></td></tr><tr style="height:5px;"><td colspan="2"></td></tr>';let row=3;if(b===".so_note_box"){row=2}$(b).find("table tr:eq("+row+")").before(output);$(c).val("");$(e).val("");$(a).val("null")}},catalogCanEdit:function(a){if(a.hasClass("fa-unlock")){return true}else{return false}},disabledSerialize:function(a){let disabled=a.find(":input:disabled").removeAttr("disabled");let info=a.serialize();disabled.attr("disabled","disabled");return info},disableInput:function(){let productionLock=$("#production_lock");if(productionLock.attr("data-clicked")!=="true"){$("#crmBatch").find("input, select").prop("disabled",true);productionLock.show()}}};var mouseX,mouseY;$(document).mousemove(function(a){mouseX=a.pageX;mouseY=a.pageY});$("body").on("keyup","#treeFilter",function(){catalog.fancytree("getTree").filterNodes($(this).val())}).on("keyup","#addItemFilter",function(){$("#add_item_categories").fancytree("getTree").filterNodes($(this).val())}).on("change","select",function(){globalFunctions.checkDropdown()}).on("click","#save",function(){let curTab=$("#roomTabView .nav-item .active").attr("id");let formData=null;let val_array={};let customVals=null;let inputSelect=$("select");switch(curTab){case"room-notes-tab":formData=$("#batch_notes").serialize();$.post("/html/pricing/ajax/global_actions.php?action=saveBatchNotes",{room_id:active_room_id,notes:formData},function(g,f){if(f==="success"){$("body").append(g);pricingFunction.checkNote(".so_note_box","#project_note_input","#project_followup_date","#project_followup_requested_of");pricingFunction.checkNote(".room_note_box","#batch_note_input","#batch_inquiry_followup_date","#batch_inquiry_requested_of")}else{displayToast("error","Something went wrong with notes. Please try again.","Note Error")}});break;case"room-details-tab":formData=pricingFunction.disabledSerialize($("#batch_details"));$.post("/html/pricing/ajax/global_actions.php?action=saveBatchDetails",{room_id:active_room_id,formData:formData},function(g,f){if(f==="success"){$("body").append(g)}else{displayToast("error","Something went wrong saving Batch Details. Please try again.","Batch Details Error")}});break;case"room-cabinet-details-tab":val_array={};formData=pricingFunction.disabledSerialize($("#cabinet_details"));inputSelect.each(function(){var g=$(this);var h=$(this).attr("id");var f=["X","Xxx","AX","DX","TX","Xx","WX","1cXXXX","3gXXXX","HW","KW"];if($.inArray(g.val(),f)>=0){val_array[h]={};g.parent().find("input").each(function(){val_array[h][$(this).attr("name")]=$(this).val()})}});customVals=JSON.stringify(val_array);$.post("/html/pricing/ajax/global_actions.php?action=saveCabinetDetails",{room_id:active_room_id,formData:formData,customVals:customVals},function(g,f){if(f==="success"){$("body").append(g)}else{displayToast("error","Something went wrong saving Batch Details. Please try again.","Batch Details Error")}});break;default:var b=JSON.stringify(getMiniTree(cabinetList));var e=$("#roomTabViewContent .tab-pane.active").attr("id");var c=pricingFunction.disabledSerialize($("#cabinet_specifications"));var a=pricingFunction.disabledSerialize($("#accounting_notes"));inputSelect.each(function(){var g=$(this);var h=$(this).attr("id");var f=["X","Xxx","AX","DX","TX","Xx","WX","1cXXXX","3gXXXX","HW","KW"];if($.inArray(g.val(),f)>=0){val_array[h]={};g.parent().find("input").each(function(){val_array[h][$(this).attr("name")]=$(this).val()})}});customVals=JSON.stringify(val_array);$.post("/html/pricing/ajax/global_actions.php?action=roomSave&room_id="+active_room_id,{cabinet_list:b,customVals:customVals,cabinet_specifications:c,accounting_notes:a,tab:e},function(f){$("body").append(f)});pricingFunction.checkNote(".room_note_box","#room_notes","#room_inquiry_followup_date","#room_inquiry_requested_of");pricingFunction.checkNote(".so_note_box","#so #inquiry","#so #inquiry_followup_date","#so #inquiry_requested_of");break}unsaved=false}).on("click","#cabinet_list_save",function(){let cab_list=JSON.stringify(cabinetList.fancytree("getTree").toDict(true));let cat_id=$("#catalog").find(":selected").attr("id");$.post("/html/pricing/ajax/item_actions.php?action=saveCatalog&room_id="+active_room_id,{cabinet_list:cab_list,catalog_id:cat_id},function(a){$("body").append(a)})}).on("click","#terms_confirm",function(){let signature=$(".esig").val();let ip=$(".esig_id").html();let button=$("#terms_confirm");if($.trim(signature)!==""){$.confirm({title:"Sign & Agree to Quote",content:signature+", you agree to the following:<br /><br />Once submitted, the deposit of 50% will be drafted from your account within 24 hours.<br />Once the deposit has been processed a shipping/delivery date will be provided.<br />Final payment is due prior to delivery.<br />You have the authorization to legally sign this document.<br /><br />"+ip,type:"red",buttons:{"I Agree":function(){$.post("/html/pricing/ajax/global_actions.php?action=termsSign&room_id="+active_room_id,{sig:signature},function(a){$("body").append(a)}).done(function(){button.hide()})},"I Disagree":function(){}}})}}).on("click","#modalBracketSave",function(){var b=$(".active_ops_"+active_room_id).map(function(){return $(this).data("opid")}).get();var a=$("#bracketAdjustments").serialize();b=JSON.stringify(b);$.post("/html/pricing/ajax/global_actions.php?action=updateBracket&roomID="+active_room_id,{active_ops:b,bracket_status:a},function(c){$("body").append(c)});$("#modalGlobal").modal("hide");unsaved=false}).on("click","#submit_for_quote",function(){let button=$(this);let cab_list=JSON.stringify(cabinetList.fancytree("getTree").toDict(true));$.confirm({title:"Are you sure you want to submit the quote?",content:"You are about to submit this quote. Once submitted you will be <strong>unable</strong> to modify the line items. Are you sure you would like to submit?",type:"red",buttons:{yes:function(){$.post("/html/pricing/ajax/item_actions.php?action=submitQuote&room_id="+active_room_id,{cabinet_list:cab_list},function(a){$("body").append(a)}).done(function(){button.val("Submitted").prop("disabled",true)})},no:function(){}}})}).on("click","#dl_ord_file",function(){$("#dlORDfile").attr("src","/html/pricing/ajax/make_ord.php?roomID="+active_room_id)}).on("click","#copy_room",function(){$.post("/html/pricing/ajax/global_actions.php?action=modalCopyRoom&roomID="+active_room_id,function(a){$("#modalGlobal").html(a).modal("show")})}).on("click","#bracket_management",function(){$.post("/html/pricing/ajax/global_actions.php?action=modalBracketMgmt&roomID="+active_room_id,function(a){$("#modalGlobal").html(a).modal("show")})}).on("click","#appliance_ws",function(){$.post("/html/pricing/ajax/global_actions.php?action=modalApplianceWS&roomID="+active_room_id,function(a){$("#modalGlobal").html(a).modal("show")})}).on("click","#modalCopyRoom",function(){let replaceRoom=$("#modalCopyRoomData select[name='new_room'] :selected").text();$.confirm({title:"Are you sure you want to overwrite this rooms information?",content:"You are about to completely overwrite room information for "+replaceRoom+". Are you sure?",type:"red",buttons:{yes:function(){let info=$("#modalCopyRoomData").serialize();$.post("/html/pricing/ajax/global_actions.php?action=copyRoomInfo",{formInfo:info},function(a){$("body").append(a)})},no:function(){}}})}).on("click","#catalog_recalculate",function(){pricingFunction.fullRecalc()}).on("click","#production_lock",function(){$("#crmBatch").find("input, select").prop("disabled",false);$(this).attr("data-clicked","true").hide();$.get("/html/pricing/ajax/global_actions.php?action=overrideProductionLock&roomID="+active_room_id)}).on("change","#sheet_type",function(){$.post("/html/search/appliance_ws_info.php?room_id="+active_room_id+"&id="+$(this).val(),function(a){$(".sheet_data").html(a);$(":input","#appliance_info").not(":button, :submit, :reset, :hidden, select").val("")})}).on("click","#modalAppWSSave",function(){var a=$("#appliance_info").serialize();$.post("/ondemand/room_actions.php?action=save_app_worksheet&room="+active_room_id+"&"+a,function(b){if(b!=="false"){$(".print_app_ws").attr("id",b);displayToast("success","Successfully saved worksheet information.","Worksheet Saved")}else{displayToast("error","Unable to save worksheet. Please refresh your page.","Unable to Save")}});$("#modalGlobal").modal("hide");unsaved=false}).on("click",".load_app_worksheet",function(a){a.stopPropagation();var b=$(this).attr("id");$.post("/ondemand/room_actions.php?action=load_app_worksheet&id="+b,function(f){var c=JSON.parse(f);var e=JSON.parse(c.values);$("#sheet_type").val(c.spec).trigger("change");$(".print_app_ws").attr("id",c.id);setTimeout(function(){$.each(e,function(g,h){$("#"+g).val(h)});$("#notes").val(c.notes)},150)})}).on("click",".wrapper",function(){if($(".info-popup").is(":visible")){$(".info-popup").fadeOut()}}).on("keyup",".esig",function(){if($.trim($(this).val())!==""){$("#terms_confirm").prop("disabled",false)}else{$("#terms_confirm").prop("disabled",true)}}).on("click","#item_note",function(){pricingFunction.delNoData();var a=cabinetList.fancytree("getRootNode");var b=a.addChildren({qty:1,title:"NOTE",price:0,key:pricingFunction.genKey(),icon:"fa fa-commenting-o",name:"Error",sqft:0,singlePrice:0,cabinet:0,customNote:1});let $tdList=$(b.tr).find(">td");$tdList.eq(4).html('<input type="text" class="form-control custom-line-item" placeholder="Custom Description..." data-id="'+b.key+'" >')}).on("click","#item_custom_line",function(){pricingFunction.delNoData();var a=cabinetList.fancytree("getRootNode");var b=a.addChildren({qty:1,title:" ",price:0,key:pricingFunction.genKey(),icon:"fa fa-hand-o-right",name:"Error",sqft:0,singlePrice:0,cabinet:1,customPrice:1,itemID:1321,customNote:1});console.log(b);let $tdList=$(b.tr).find(">td");$tdList.eq(4).html('<input type="text" class="form-control custom-line-item" placeholder="Custom Description..." data-id="'+b.key+'" >');$tdList.eq(9).html('<input type="text" class="form-control custom_price" placeholder="Price" data-id="'+b.key+'" >')}).on("click",".delete_item",function(){var a=cabinetList.fancytree("getTree");a.getFocusNode().remove();cabinetList.fancytree("getRootNode").render(true,true);pricingFunction.recalcSummary()}).on("mouseenter",".view_item_info",function(){let info="";let thisEle=$(this);let infoPopup=$(".info-popup");$.post("/html/pricing/ajax/item_actions.php?action=getItemInfo",{id:thisEle.data("id"),room_id:active_room_id},function(a){if(a!==""){let result=JSON.parse(a);if(result.image!==null){info+="<div class='image'><img src='/html/pricing/images/"+result.image+"' /></div>"}info+="<div class='right_content'><div class='header'><h4>"+result.title+"</h4></div>";info+="<div class='description'>"+result.description+"</div></div>"}}).done(function(){if(info!==""){let infoHeight=infoPopup.height();let infoTop=mouseY-190;let windowOverflow=$(window).scrollTop()+$(window).height();if((infoHeight+infoTop+100)>windowOverflow){infoPopup.css({bottom:0,top:"inherit",left:(mouseX-20)})}else{infoPopup.css({top:infoTop,bottom:"inherit",left:mouseX})}infoPopup.fadeIn(250).html(info)}})}).on("mouseleave",".view_item_info",function(){$(".info-popup").fadeOut(250)}).on("click",".add_item_mod",function(){$.post("/html/modals/item_list_add_modification.php",function(a){$("#modalGlobal").html(a).modal("show")})}).on("click",".item_copy",function(){let activeNode=cabinetList.fancytree("getTree").getActiveNode().toDict(true);activeNode.key=pricingFunction.genKey();if(activeNode.children!==null){$.each(activeNode.children,function(a){activeNode.children[a].key=pricingFunction.genKey()})}cabinetList.fancytree("getRootNode").addChildren(activeNode)}).on("focus",".qty_input",function(){$(this).select()}).on("keyup",".qty_input",function(){let id=$(this).attr("data-id");cabinetList.fancytree("getTree").getNodeByKey(id).data.qty=$(this).val()}).on("change",".qty_input",function(){pricingFunction.recalcSummary()}).on("click",".add_item_cabinet_list",function(){pricingFunction.delNoData();var a=cabinetList.fancytree("getRootNode");$.post("/html/pricing/ajax/item_actions.php?action=getItemInfo",{id:$(this).attr("data-id"),room_id:active_room_id},function(b){let itemInfo=JSON.parse(b);let fixedPrice=parseFloat(itemInfo.price).toFixed(2);a.addChildren({qty:1,title:itemInfo.sku,width:itemInfo.width,height:itemInfo.height,depth:itemInfo.depth,itemID:itemInfo.id,price:fixedPrice,key:pricingFunction.genKey(),icon:itemInfo.icon,name:itemInfo.title,sqft:itemInfo.sqft,singlePrice:fixedPrice,cabinet:itemInfo.cabinet,addlMarkup:itemInfo.addlMarkup});pricingFunction.recalcSummary()})}).on("click","#editCatalogLock",function(){if($(this).hasClass("fa-lock")){$(this).removeClass("fa-lock").addClass("fa-unlock")}else{$(this).removeClass("fa-unlock").addClass("fa-lock")}}).on("click","#catalog_add_item",function(){$.get("/html/pricing/ajax/modify_item.php",function(a){$("#modalGlobal").html(a).modal("show")})}).on("change","#catalog",function(){let id=$(this).find(":selected").attr("id");let catalogData={url:"/html/pricing/ajax/nav_menu.php",type:"POST",data:{catalog:id},dataType:"json"};catalog.fancytree("getTree").reload(catalogData)}).on("change",".item_hinge",function(){let node=cabinetList.fancytree("getActiveNode");node.data.hinge=$(this).find(":selected").val()}).on("keyup",".itm_width",function(){let id=$(this).attr("data-id");let node=cabinetList.fancytree("getTree").getNodeByKey(id);node.data.width=$(this).val();node.data.price=pricingFunction.footCalc(node);pricingFunction.recalcSummary()}).on("keyup",".itm_height",function(){let id=$(this).attr("data-id");let node=cabinetList.fancytree("getTree").getNodeByKey(id);node.data.height=$(this).val();node.data.price=pricingFunction.footCalc(node);pricingFunction.recalcSummary()}).on("keyup",".itm_depth",function(){let id=$(this).attr("data-id");let node=cabinetList.fancytree("getTree").getNodeByKey(id);node.data.depth=$(this).val();node.data.price=pricingFunction.footCalc(node);pricingFunction.recalcSummary()}).on("keyup","#modificationsFilter",function(){itemModifications.fancytree("getTree").filterNodes($(this).val())}).on("click","#modificationAddSelected",function(){let modifications=itemModifications.fancytree("getTree").getSelectedNodes();let cablist=cabinetList.fancytree("getTree").getActiveNode();let outputPrice=0;$.each(modifications,function(b,a){let addlInfo="";if(a.data.addlInfo!==undefined){addlInfo=" "+a.data.addlInfo}if(a.data.percentMarkup===1){outputPrice=parseFloat(cablist.data.price*(a.data.price/100)).toFixed(2)}else{outputPrice=parseFloat(a.data.price).toFixed(2)}let width=null;let height=null;if(a.data.sqft===1){width=parseFloat(cablist.data.width);height=parseFloat(cablist.data.height);outputPrice=((width*height)/144)*outputPrice}var c=$(cablist.tr).find(">td");switch(parseInt(a.key)){case 90048:case 90051:c.eq(5).find("input").val(addlInfo.trim());cablist.data.width=addlInfo.trim();break;case 90049:case 90052:c.eq(6).find("input").val(addlInfo.trim());cablist.data.height=addlInfo.trim();break;case 90050:case 90053:c.eq(7).find("input").val(addlInfo.trim());cablist.data.depth=addlInfo.trim();break}cablist.addChildren({qty:1,title:a.title,itemID:a.data.itemID,price:outputPrice,key:pricingFunction.genKey(),width:width,height:height,icon:a.icon,name:a.data.description+addlInfo,sqft:a.data.sqft,linft:a.data.linft,singlePrice:outputPrice,cabinet:a.data.cabinet,addlMarkup:a.data.addlMarkup,subLine:true,pctMarkup:a.data.percentMarkup})});cablist.setExpanded();$("#modalGlobal").modal("hide")}).on("keyup",".modAddlInfo",function(){let id=$(this).attr("id");itemModifications.fancytree("getTree").getNodeByKey(id).data.addlInfo=$(this).val()}).on("click","#category_collapse",function(){catalog.fancytree("getTree").visit(function(a){a.setExpanded(false)})}).on("click","#overrideShipDate",function(){$.post("/html/pricing/ajax/global_actions.php?action=modalOverrideShipping&roomID="+active_room_id,function(a){$("#modalGlobal").html(a).modal("show")})}).on("click","#modalShippingUpdate",function(){let shippingInfo=$("#modalShippingOverrideData").serialize();$.post("/html/pricing/ajax/global_actions.php?action=overrideShipping&roomID="+active_room_id,{info:shippingInfo},function(a){let ship_results=JSON.parse(a);$("#calcd_ship_date").text(ship_results.ship_date);$("#calcd_del_date").text(ship_results.del_date);displayToast("success","Successfully updated ship and delivery date.","Ship/Delivery Updated");$("#modalGlobal").modal("hide")});unsaved=false}).on("blur",".custom_price",function(){let id=$(this).attr("data-id");let node=cabinetList.fancytree("getTree").getNodeByKey(id);node.data.price=parseFloat($(this).val().replace(/[^0-9-.]/g,""));pricingFunction.recalcSummary()}).on("focus mouseup",".custom_price",function(){$(this).select()}).on("keyup",".custom-line-item",function(){let id=$(this).attr("data-id");let node=cabinetList.fancytree("getTree").getNodeByKey(id);node.data.name=$(this).val()}).on("click","#detailed_item_summary",function(){$.post("/html/modals/detailed_report_item_list.php",{room_id:active_room_id},function(a){$("#modalGlobal").html(a)}).done(function(){pricingFunction.recalcSummary();$("#modalGlobal").modal("show")})}).on("click","#pricingSpeciesGrade, #pricingDoorDesign",function(){let speciesGrade=$("#species_grade").val();let doorDesign=$("#door_design").val();$.post("/html/pricing/ajax/global_actions.php?action=getPriceGroup&speciesGrade="+speciesGrade+"&doorDesign="+doorDesign,function(a){$("#cab_spec_pg").text(a);priceGroup=a});pricingFunction.recalcSummary()}).on("click","#modalSaveCatItemSubmit",function(){let node=catalog.fancytree("getTree").getActiveNode();let fields=$("#catalogAddEditItem").serialize();let sku=$("#catalogAddEditItem input[name='title']").val();$.post("/html/pricing/ajax/item_actions.php?action=updateItem",{key:node.key,folder:node.folder,update:fields},function(b,a){$("body").append(b);if(a==="success"){let title=sku+'<span class="actions"><div class="info_container"><i class="fa fa-info-circle primary-color view_item_info" data-id="'+node.key+'"></i></div><i class="fa fa-plus-circle success-color add_item_cabinet_list" data-id="'+node.key+'" title="Add To Cabinet List"></i></span>';node.setTitle(title);$("#modalGlobal").html(b).modal("hide")}});unsaved=false}).on("click","#modalAddCatItemSubmit",function(){let node=catalog.fancytree("getTree").getActiveNode();let fields=$("#catalogAddEditItem").serialize();let catID=node.key;let createFolder=false;let folderType=null;let sku=$("#catalogAddEditItem input[name='title']").val();if($(this).attr("data-type")==="newSameFolder"){createFolder=true;folderType="alongside"}else{if($(this).attr("data-type")==="newSubFolder"){createFolder=true;folderType="child"}}if(!node.isFolder()){catID=node.parent.key}$.post("/html/pricing/ajax/item_actions.php?action=createItem",{key:catID,folder:createFolder,folderType:folderType,update:fields},function(b,a){if(a==="success"){let insertID=b;if(createFolder){if(folderType==="alongside"){catalog.fancytree("getTree").getNodeByKey(catID).parent.addChildren({key:insertID,title:sku,folder:true})}else{catalog.fancytree("getTree").getNodeByKey(catID).addChildren({key:insertID,title:sku,folder:true})}displayToast("success","Successfully created category","Category Created");$("#modalGlobal").html(b).modal("hide")}else{let title=sku+'<span class="actions"><div class="info_container"><i class="fa fa-info-circle primary-color view_item_info" data-id="'+insertID+'"></i></div><i class="fa fa-plus-circle success-color add_item_cabinet_list" data-id="'+insertID+'" title="Add To Cabinet List"></i></span>';catalog.fancytree("getTree").getNodeByKey(catID).addChildren({key:insertID,icon:"fa fa-magic",title:title,is_item:true,qty:1});displayToast("success","Successfully created item.","Item Created");$("#modalGlobal").html(b).modal("hide")}}else{displayToast("error","Unable to create the requested item/category.","Error")}});unsaved=false}).on("change","#left_menu_options",function(){let result=$(this).val();let asearch=$(".action_search");let newSourceOption=null;switch(result){case"catalog":asearch.show();newSourceOption={url:"/html/pricing/ajax/nav_menu.php",type:"POST",dataType:"json"};catalog.fancytree("getTree").reload(newSourceOption);break;case"samples":asearch.hide();newSourceOption={url:"/html/pricing/ajax/samples_menu.php",type:"POST",dataType:"json"};catalog.fancytree("getTree").reload(newSourceOption);break}}).on("change",".sample_checkbox",function(){$(".sample_checkbox").not(this).prop("checked",false)}).on("click","#ship_date_recalc",function(){if($("#order_status").val()==="#"){pricingFunction.updateShipDate()}else{displayToast("error","Unable to recalculate ship date, this room is not in quote anymore.","Unable to Recalculate.")}}).on("click","#overrideShipCost",function(){$.post("/html/pricing/ajax/global_actions.php?action=modalOverrideShipCost&roomID="+active_room_id,function(a){$("#modalGlobal").html(a).modal("show")})}).on("click","#modalShippingCostOverride",function(){let shippingInfo=$("#modalShippingOverrideCost").serialize();$.post("/html/pricing/ajax/global_actions.php?action=shipCostOverride&roomID="+active_room_id,{info:shippingInfo},function(b,a){if(a==="success"){$("#shipping_cost").attr("data-cost",b).text("$"+b);displayToast("success","Successfully overrode ship cost.","Ship Cost Overriden");$("#modalGlobal").modal("hide");pricingFunction.recalcSummary()}else{displayToast("error","Unable to update ship cost. Please contact IT.","Ship Cost Override Error")}});unsaved=false});