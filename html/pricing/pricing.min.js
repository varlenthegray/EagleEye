jQuery.expr.filters.offscreen=function(a){var b=a.getBoundingClientRect();return((b.x+b.width)<0||(b.y+b.height)<0||(b.x>window.innerWidth||b.y>window.innerHeight))};var total=0;function delNoData(){let getNegNode=cabinetList.fancytree("getTree").getNodeByKey("-1");if(getNegNode!==null){cabinetList.fancytree("getTree").getNodeByKey("-1").remove()}}function recalcTotal(){let totalTree=cabinetList.fancytree("getTree");let newTotal=0;totalTree.visit(function(a){let qty=parseInt(a.data.qty);let price=parseFloat(a.data.price);let lineTotal=qty*price;newTotal+=parseFloat(lineTotal);let node=cabinetList.fancytree("getTree").getNodeByKey(a.key),$tdList=$(node.tr).find(">td");console.log("Updated "+node.key+" with total: "+newTotal);node.data.total=newTotal.formatMoney();$tdList.eq(11).text(newTotal.formatMoney())})}var mouseX,mouseY;$(document).mousemove(function(a){mouseX=a.pageX;mouseY=a.pageY});var CLIPBOARD=null;var cabinetList=$("#cabinet_list");var catalog=$("#catalog_categories");var itemModifications=$("#item_modifications");$("body").on("keyup","#treeFilter",function(){catalog.fancytree("getTree").filterNodes($(this).val())}).on("keyup","#modificationsFilter",function(){itemModifications.fancytree("getTree").filterNodes($(this).val())}).on("click","#catalog_add_custom",function(){delNoData();var a=cabinetList.fancytree("getRootNode");var b=a.addChildren({title:"Nomenclature...",tooltip:"Type your nomenclature here.",name:'<input type="text" class="form-control qty_input" value="1" placeholder="Qty" />'})}).on("click","#catalog_remove_checked",function(){var a=cabinetList.fancytree("getTree"),b=a.getSelectedNodes();b.forEach(function(c){c.remove()});cabinetList.fancytree("getRootNode").render(true,true);$(this).hide();recalcTotal()}).on("click","#save",function(){var d={};var c=$("#cabinet_specifications").serialize();var e=null;var a=$("#accounting_notes").serialize();var b=JSON.stringify(getMiniTree(cabinetList));$("input[type='hidden']").each(function(){var g=$(this);var h=$(this).attr("id");var f=["X","Xxx","AX","DX","TX","Xx","WX","1cXXXX","3gXXXX","HW","KW"];if($.inArray(g.val(),f)>=0){d[h]={};g.parent().find(".selected").find("input").each(function(){d[h][$(this).attr("name")]=$(this).val()})}});e=JSON.stringify(d);console.log("Custom Vals:"+e);$.post("/html/pricing/ajax/global_actions.php?action=roomSave&room_id="+active_room_id,{cabinet_list:b,customVals:e,cabinet_specifications:c,accounting_notes:a},function(f){$("body").append(f)});unsaved=false}).on("focus",".qty_input",function(){$(this).select()}).on("keyup",".qty_input",function(){let id=$(this).attr("id");cabinetList.fancytree("getTree").getNodeByKey(id).data.qty=$(this).val()}).on("change",".qty_input",function(){recalcTotal()}).on("click",".add_item_cabinet_list",function(){delNoData();var a=cabinetList.fancytree("getRootNode");let $tdList=$(a.tr).find(">td");$.post("/html/pricing/ajax/item_actions.php?action=getItemInfo",{id:$(this).attr("data-id"),room_id:active_room_id},function(b){let itemInfo=JSON.parse(b);let fixedPrice=parseFloat(itemInfo.price).toFixed(2);a.addChildren({qty:1,title:itemInfo.sku,width:itemInfo.width,height:itemInfo.height,depth:itemInfo.depth,itemID:itemInfo.id,price:fixedPrice,key:new Date().getTime()*Math.random(999),icon:itemInfo.icon,name:itemInfo.title});recalcTotal()})}).on("change","#catalog",function(){let id=$(this).find(":selected").attr("id");let catalogData={url:"/html/pricing/ajax/nav_menu.php",type:"POST",data:{catalog:id},dataType:"json"};$(this).hide()}).on("click","#cabinet_list_save",function(){let cab_list=JSON.stringify(cabinetList.fancytree("getTree").toDict(true));let cat_id=$("#catalog").find(":selected").attr("id");$.post("/html/pricing/ajax/item_actions.php?action=saveCatalog&room_id="+active_room_id,{cabinet_list:cab_list,catalog_id:cat_id},function(a){$("body").append(a)})}).on("focus",".qty_input",function(){$(this).select()}).on("keyup",".qty_input",function(){let id=$(this).attr("id");cabinetList.fancytree("getTree").getNodeByKey(id).data.qty=$(this).val()}).on("mouseenter",".view_item_info",function(){let info="";let thisEle=$(this);let infoPopup=$(".info-popup");$.post("/html/pricing/ajax/item_actions.php?action=getItemInfo",{id:thisEle.data("id"),room_id:active_room_id},function(a){let result=JSON.parse(a);if(result.image!==null){info+="<div class='image'><img src='/html/pricing/images/"+result.image+"' /></div>"}info+="<div class='right_content'><div class='header'><h4>"+result.title+"</h4></div>";info+="<div class='description'>"+result.description+"</div></div>"}).done(function(){let infoHeight=infoPopup.height();let infoTop=mouseY-91;let windowOverflow=$(window).scrollTop()+$(window).height();if((infoHeight+infoTop+100)>windowOverflow){infoPopup.css({bottom:0,top:"inherit",left:mouseX})}else{infoPopup.css({top:infoTop,bottom:"inherit",left:mouseX})}infoPopup.fadeIn(250).html(info)})}).on("mouseleave",".view_item_info",function(){$(".info-popup").fadeOut(250)}).on("change","#catalog",function(){let id=$(this).find(":selected").attr("id");let catalogData={url:"/html/pricing/ajax/nav_menu.php",type:"POST",data:{catalog:id},dataType:"json"};catalog.fancytree("getTree").reload(catalogData)}).on("click",".wrapper",function(){if($(".info-popup").is(":visible")){$(".info-popup").fadeOut()}}).on("change",".item_hinge",function(){let node=cabinetList.fancytree("getActiveNode");node.data.hinge=$(this).find(":selected").val()}).on("change",".item_finish",function(){let node=cabinetList.fancytree("getActiveNode");node.data.finish=$(this).find(":selected").val()}).on("click","#modificationAddSelected",function(){let modifications=itemModifications.fancytree("getTree").getSelectedNodes();cabinetList.fancytree("getTree").getActiveNode().addChildren(modifications);$("#modalAddModification").modal("hide")}).on("change","#ext_carcass_same",function(){if($(this).is(":checked")){$(".ext_finish_block").hide()}else{$(".ext_finish_block").show()}}).on("change","#int_carcass_same",function(){if($(this).is(":checked")){$(".int_finish_block").hide()}else{$(".int_finish_block").show()}}).on("click","#submit_for_quote",function(){let button=$(this);let cab_list=JSON.stringify(cabinetList.fancytree("getTree").toDict(true));$.confirm({title:"Are you sure you want to submit the quote?",content:"You are about to submit this quote. Once submitted you will be <strong>unable</strong> to modify the line items. Are you sure you would like to submit?",type:"red",buttons:{yes:function(){$.post("/html/pricing/ajax/item_actions.php?action=submitQuote&room_id="+active_room_id,{cabinet_list:cab_list},function(a){$("body").append(a)}).done(function(){button.val("Submitted").prop("disabled",true)})},no:function(){}}})}).on("click","#category_collapse",function(){catalog.fancytree("getTree").visit(function(a){a.setExpanded(false)})}).on("click","#global_info",function(){$.post("/html/pricing/ajax/global_actions.php?action=modalGlobals&roomID="+active_room_id,function(a){$("#modalGeneral").html(a).modal("show")})}).on("click","#modalGlobalsUpdate",function(){let globalInfo=$("#modalGlobalData").serialize();$.post("/html/pricing/ajax/global_actions.php?action=updateGlobals&roomID="+active_room_id,{globalInfo:globalInfo},function(a){$("body").append(a);$("#modalGeneral").html("").modal("hide")})}).on("click","#appliance_ws",function(){$.post("/html/pricing/ajax/global_actions.php?action=modalApplianceWS&roomID="+active_room_id,function(a){$("#modalGeneral").html(a).modal("show")})}).on("click","#modalAppWSSave",function(){var a=$("#appliance_info").serialize();$.post("/ondemand/room_actions.php?action=save_app_worksheet&room="+active_room_id+"&"+a,function(b){if(b!=="false"){$(".print_app_ws").attr("id",b);displayToast("success","Successfully saved worksheet information.","Worksheet Saved")}else{displayToast("error","Unable to save worksheet. Please refresh your page.","Unable to Save")}});$("#modalGeneral").html("").modal("hide");unsaved=false}).on("click","#bracket_management",function(){$.post("/html/pricing/ajax/global_actions.php?action=modalBracketMgmt&roomID="+active_room_id,function(a){$("#modalGeneral").html(a).modal("show")})}).on("click","#modalBracketSave",function(){var b=$(".active_ops_"+active_room_id).map(function(){return $(this).data("opid")}).get();var a=$("#bracketAdjustments").serialize();b=JSON.stringify(b);$.post("/html/pricing/ajax/global_actions.php?action=updateBracket&roomID="+active_room_id,{active_ops:b,bracket_status:a},function(c){$("body").append(c)});$("#modalGeneral").html("").modal("hide")}).on("click",".option",function(){if($(this).parent().parent().attr("data-for")==="ship_via"){let ship_info=$("input[name='ship_to_1']").parent().parent();if($(this).attr("data-value")==="4"){ship_info.hide();ship_info.next("tr").hide();ship_info.next("tr").next("tr").hide()}else{ship_info.show();ship_info.next("tr").show();ship_info.next("tr").next("tr").show()}}});