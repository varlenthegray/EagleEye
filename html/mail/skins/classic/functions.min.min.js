function rcube_init_settings_tabs(){var g;var e=$("#tabsbar");var j=$("span:last",e),k="#settingstabpreferences",h=window.rcmail&&rcmail.env.action?rcmail.env.action:null;j&&"settingstababout"!=j.attr("id")&&(g=$("#settingstababout"))&&(e=g.clone(!0),g.remove(),j.after(e));h&&(k="#settingstab"+(0<h.indexOf("identity")?"identities":h.replace(/\./g,"")));$(k).addClass("tablink-selected");$("a",k).removeAttr("onclick").click(function(){return !1})}function rcube_init_tabs(g,e){var j=$("#"+g),k=j.children("fieldset");if(k.length){e=e?e:0;k.each(function(b){b!=e&&$(this).hide()});var h=$("<div>").addClass("tabsbar").appendTo(j);k.each(function(m){var n=$(this),f=n.children("legend");var a=$("<a>").text(f.text()).attr("href","#");var b=$("<span>").attr({id:"tab"+m,"class":"tablink"}).click(function(){rcube_show_tab(g,m);return !1});f.remove();n.addClass("tabbed");m==e&&b.addClass("tablink-selected");b.append(a).appendTo(h)})}}function rcube_show_tab(d,c){$("#"+d).children("fieldset").each(function(b){$(this)[c==b?"show":"hide"]();$("#tab"+b).toggleClass("tablink-selected",b==c)})}function rcube_mail_ui(){this.popups={markmenu:{id:"markmessagemenu"},replyallmenu:{id:"replyallmenu"},forwardmenu:{id:"forwardmenu",editable:1},searchmenu:{id:"searchmenu",editable:1},messagemenu:{id:"messagemenu"},attachmentmenu:{id:"attachmentmenu"},dragmenu:{id:"dragmenu",sticky:1},groupmenu:{id:"groupoptionsmenu",above:1},mailboxmenu:{id:"mailboxoptionsmenu",above:1},composemenu:{id:"composeoptionsmenu",editable:1,overlap:1},spellmenu:{id:"spellmenu"},responsesmenu:{id:"responsesmenu"},uploadmenu:{id:"attachment-form",editable:1,above:1,toggle:!bw.ie&&!bw.linux},uploadform:{id:"upload-form",editable:1,toggle:!bw.ie&&!bw.linux}};var d;for(d in this.popups){var c=$("#"+this.popups[d].id);c.length?this.popups[d].obj=c:delete this.popups[d]}}rcube_mail_ui.prototype={show_popup:function(f,e,g){var h;!this.popups[f]&&(h=$("#"+f))&&h.length&&(this.popups[f]=$.extend(g,{id:f,obj:h}));return"function"==typeof this[f]?this[f](e):this.show_popupmenu(f,e)},show_popupmenu:function(h,g){var l=this.popups[h].obj,m=this.popups[h].above,j=$(this.popups[h].link?this.popups[h].link:rcube_find_object(h+"link"));"undefined"==typeof g?g=l.is(":visible")?!1:!0:this.popups[h].toggle&&g&&this.popups[h].obj.is(":visible")&&(g=!1);if(g&&j.length){var k=j.parent();h=$(window);k=k.hasClass("dropbutton")?k.offset():j.offset();!m&&k.top+j.height()+l.height()>h.height()&&(m=!0);k.left+l.width()>h.width()&&(k.left=h.width()-l.width()-30);l.css({left:k.left,top:k.top+(m?-l.height():j.height())})}l[g?"show":"hide"]()},dragmenu:function(b){this.popups.dragmenu.obj[b?"show":"hide"]()},forwardmenu:function(b){$("input[name='forwardtype'][value="+(rcmail.env.forward_attachment?1:0)+"]",this.popups.forwardmenu.obj).prop("checked",!0);this.show_popupmenu("forwardmenu",b)},uploadmenu:function(d){"object"==typeof d&&(d=!1);if(!d){try{$("#attachment-form form")[0].reset()}catch(c){}}rcmail.mailvelope_editor||(this.show_popupmenu("uploadmenu",d),!document.all&&this.popups.uploadmenu.obj.is(":visible")&&$("#attachment-form input[type=file]").click())},searchmenu:function(j){var h=this.popups.searchmenu.obj,p=rcube_find_object("searchmenulink");"undefined"==typeof j&&(j=h.is(":visible")?!1:!0);if(j&&p){var q=$(p).offset();h.css({left:q.left,top:q.top+p.offsetHeight+2});if(rcmail.env.search_mods){var n;p=$('input:checkbox[name="s_mods[]"]',h);q=rcmail.env.mailbox;var o=rcmail.env.search_mods,m=rcmail.env.search_scope||"base";if("mail"==rcmail.env.task){o=o[q]?o[q]:o["*"];var l="text";$('input:radio[name="s_scope"]').prop("checked",!1).filter("#s_scope_"+m).prop("checked",!0)}else{l="*"}if(o[l]){p.map(function(){this.checked=!0;this.disabled=this.value!=l})}else{for(n in p.prop("disabled",!1).prop("checked",!1),o){$("#s_mod_"+n).prop("checked",!0)}}}}h[j?"show":"hide"]()},set_searchmod:function(g){var e=rcmail.env.task;var j=rcmail.env.search_mods,k=rcmail.env.mailbox;"all"==$('input[name="s_scope"]:checked').val()&&(k="*");j||(j={});if("mail"==e){j[k]||(j[k]=rcube_clone_object(j["*"]));var h=j[k];e="text"}else{h=j,e="*"}g.checked?h[g.value]=1:delete h[g.value];g.value==e&&$('input:checkbox[name="s_mods[]"]').map(function(){this!=g&&(this.checked=!0,g.checked?(this.disabled=!0,delete h[this.value]):(this.disabled=!1,h[this.value]=1))});rcmail.set_searchmods(h)},show_listmenu:function(f){var e=this,g={},h=$("#listmenu");h.is(":visible")?h.dialog("close",f.originalEvent):($('input[name="sort_col"][value="'+rcmail.env.sort_col+'"]').prop("checked",!0),$('input[name="sort_ord"][value="DESC"]').prop("checked","DESC"==rcmail.env.sort_order),$('input[name="sort_ord"][value="ASC"]').prop("checked","DESC"!=rcmail.env.sort_order),$('input[name="view"][value="thread"]').prop("checked",rcmail.env.threading?!0:!1),$('input[name="view"][value="list"]').prop("checked",rcmail.env.threading?!1:!0),$('input[name="list_col[]"]').each(function(){$(this).prop("checked",-1!=$.inArray(this.value,rcmail.env.listcols))}),$.each(["widescreen","desktop","list"],function(){$('input[name="layout"][value="'+this+'"]').prop("checked",rcmail.env.layout==this)}),$("#listoptions-columns",h)["widescreen"==rcmail.env.layout?"hide":"show"](),g[rcmail.gettext("save")]=function(b){h.dialog("close",b);e.save_listmenu()},h.dialog({modal:!0,resizable:!1,closeOnEscape:!0,title:null,open:function(d){var c=0;$("#listmenu fieldset").each(function(){var b=$(this).height();b>c&&(c=b)}).css("min-height",c+"px").height(c);setTimeout(function(){h.find("a, input:not(:disabled)").not("[aria-disabled=true]").first().focus()},100)},close:function(b){h.dialog("destroy").hide();b.originalEvent&&rcube_event.is_keyboard(b.originalEvent)&&$("#listmenulink").focus()},buttons:g,minWidth:500,width:h.width()+20}).show())},save_listmenu:function(){var g=$('input[name="sort_col"]:checked').val(),e=$('input[name="sort_ord"]:checked').val(),j=$('input[name="view"]:checked').val(),k=$('input[name="layout"]:checked').val(),h=$('input[name="list_col[]"]:checked').map(function(){return this.value}).get();rcmail.set_list_options(h,g,e,"thread"==j?1:0,k)},spellmenu:function(h){var g=rcmail.spellcheck_lang(),l=this.popups.spellmenu.obj,m=$("ul",l);if(!m.length){m=$("<ul>");for(i in rcmail.env.spell_langs){var j=$("<li>");var k=$('<a href="#"></a>').text(rcmail.env.spell_langs[i]).addClass("active").data("lang",i).click(function(){rcmail.spellcheck_lang_set($(this).data("lang"))});k.appendTo(j);j.appendTo(m)}m.appendTo(l)}$("li",m).each(function(){var b=$("a",this);b.data("lang")==g?b.addClass("selected"):b.hasClass("selected")&&b.removeClass("selected")});this.show_popupmenu("spellmenu",h)},show_attachmentmenu:function(e,c){var f=e.parentNode.id.replace(/^attach/,"");$.each(["open","download","rename"],function(){var b=this;$("#attachmenu"+b).off("click").attr("onclick","").click(function(a){return rcmail.command(b+"-attachment",f,this)})});this.popups.attachmentmenu.link=e;rcmail.command("menu-open",{menu:"attachmentmenu",id:f},e,c)},menu_open:function(b){b&&"messagelistmenu"==b.name&&this.show_listmenu()},body_mouseup:function(d){var c=d.target;ref=this;$.each(this.popups,function(a,b){!b.obj.is(":visible")||c==rcube_find_object(a+"link")||b.toggle||c==b.obj.get(0)||b.editable&&ref.target_overlaps(c,b.id)||b.sticky&&rcube_mouse_is_over(d,rcube_find_object(b.id))||$(c).is(".folder-selector-link")||$(c).children(".folder-selector-link").length||window.setTimeout('rcmail_ui.show_popup("'+a+'",false);',50)})},target_overlaps:function(d,c){for(c=rcube_find_object(c);d.parentNode;){if(d.parentNode==c){return !0}d=d.parentNode}return !1},body_keydown:function(d){if(27==d.keyCode){for(var c in this.popups){this.popups[c].obj.is(":visible")&&this.show_popup(c,!1)}}},set_layout:function(f){var e=f?f.new_layout:rcmail.env.layout,g=$("#mailcontframe"),h=$("#mailpreviewframe");f&&$("#mailrightcontainer").removeClass().addClass(e);this.mailviewsplitv||(this.mailviewsplitv=new rcube_splitter({id:"mailviewsplitterv",p1:"mailleftcontainer",p2:"mailrightcontainer",orientation:"v",relative:!0,start:165,callback:rcube_render_mailboxlist}),this.mailviewsplitv.init());$("#mailviewsplitter")["desktop"==e?"show":"hide"]();$("#mailviewsplitter2")["widescreen"==e?"show":"hide"]();$("#mailpreviewframe")["list"!=e?"show":"hide"]();rcmail.env.contentframe="list"==e?null:"messagecontframe";"widescreen"==e?($("#countcontrols").detach().appendTo($("#messagelistheader")),g.css({height:"auto",width:400}),h.css({top:0,left:410,height:"auto"}).show(),this.mailviewsplit2?this.mailviewsplit2.resize():(this.mailviewsplit2=new rcube_splitter({id:"mailviewsplitter2",p1:"mailcontframe",p2:"mailpreviewframe",orientation:"v",relative:!0,start:405}),this.mailviewsplit2.init())):"desktop"==e?(g.css({height:200,width:"100%"}),h.css({left:0,top:210,height:"auto"}).show(),this.mailviewsplit?this.mailviewsplit.resize():(this.mailviewsplit=new rcube_splitter({id:"mailviewsplitter",p1:"mailcontframe",p2:"mailpreviewframe",orientation:"h",relative:!0,start:205}),this.mailviewsplit.init())):(g.css({height:"auto",width:"100%"}),h.hide());f&&"widescreen"==f.old_layout&&$("#countcontrols").detach().appendTo($("#messagelistfooter"))},init_compose_form:function(){var h,g=["cc","bcc","replyto","followupto"],l=document.getElementById("compose-div"),m=document.getElementById("compose-headers-div");for(h=0;h<g.length;h++){var j=g[h];var k=$("#_"+j);k.length&&(k.on("change",{v:j},function(b){this.value&&rcmail_ui.show_header_form(b.data.v)}),""!=k.val()&&rcmail_ui.show_header_form(j))}bw.ie&&(rcube_find_object("form").onkeydown=function(b){27==rcube_event.get_keycode(b)&&rcube_event.cancel(b)});$(window).resize(function(){rcmail_ui.resize_compose_body()});$("#compose-container").resize(function(){rcmail_ui.resize_compose_body()});l.style.top=parseInt(m.offsetHeight,10)+3+"px";$(window).resize();$("#contacts-table").css("top",$("#directorylist").height()+24+"px");$("#quicksearchbox").keydown(function(b){13==rcube_event.get_keycode(b)&&rcmail.command("search")})},resize_compose_body:function(){var e=$("#compose-div .boxlistcontent"),c=e.width()-6;e=e.height()-2;var f=bw.ie||bw.opera?4:0;$("#compose-body_ifr").width(c+6).height(e-1-$("div.mce-toolbar").height());$("#compose-body").width(c-f).height(e);$("#googie_edit_layer").width(c).height(e)},resize_compose_body_ev:function(){window.setTimeout(function(){rcmail_ui.resize_compose_body()},100)},show_header_form:function(e){var c,f=document.getElementById(e+"-link");if(c=this.next_sibling(f)){c.style.display="none"}else{if(c=this.prev_sibling(f)){c.style.display="none"}}f.style.display="none";if(e=document.getElementById("compose-"+e)){c=document.getElementById("compose-div"),f=document.getElementById("compose-headers-div"),$(e).show(),c.style.top=parseInt(f.offsetHeight,10)+3+"px",this.resize_compose_body()}return !1},hide_header_form:function(g){var e,j=document.getElementById(g+"-link"),k=j.parentNode.getElementsByTagName("a");j.style.display="";for(j=0;j<k.length;j++){if("none"!=k[j].style.display){for(var h=j+1;h<k.length;h++){if("none"!=k[h].style.display&&(e=this.next_sibling(k[j]))){e.style.display="";break}}}}document.getElementById("_"+g).value="";if(g=document.getElementById("compose-"+g)){e=document.getElementById("compose-div"),k=document.getElementById("compose-headers-div"),g.style.display="none",e.style.top=parseInt(k.offsetHeight,10)+1+"px",this.resize_compose_body()}return !1},next_sibling:function(b){for(b=b.nextSibling;b&&3==b.nodeType;){b=b.nextSibling}return b},prev_sibling:function(b){for(b=b.previousSibling;b&&3==b.nodeType;){b=b.previousSibling}return b},enable_command:function(b){"reply-list"==b.command&&1==rcmail.env.reply_all_mode?(b=rcmail.gettext(b.status?"replylist":"replyall"),$("a.button.replyAll").attr("title",b)):"compose-encrypted"==b.command&&$("#messagetoolbar > a.encrypt").show()},folder_search_init:function(b){$(".boxtitle a.search",b).click(function(a){var j=$(".boxtitle",b),k=$(".listsearchbox",b),g=k.is(":visible")?-1:1,h=24+($("select",k).length?24:0);k.slideToggle({duration:160,progress:function(d,e){0>g&&(e=1-e);$(".boxlistcontent",b).css("top",j.outerHeight()+h*e+"px")},complete:function(){k.toggleClass("expanded");k.is(":visible")?k.find("input[type=text]").focus():$("a.reset",k).click()}});return !1})}};function rcube_layer(d,c){this.name=d;this.create=function(m){var f=m.x?m.x:0,r=m.y?m.y:0,q=m.width,p=m.height,n=m.zindex,j=m.vis;m=m.parent;var o=document.createElement("DIV");o.id=this.name;o.style.position="absolute";o.style.visibility=j?2==j?"inherit":"visible":"hidden";o.style.left=f+"px";o.style.top=r+"px";q&&(o.style.width=q.toString().match(/%$/)?q:q+"px");p&&(o.style.height=p.toString().match(/%$/)?p:p+"px");n&&(o.style.zIndex=n);m?m.appendChild(o):document.body.appendChild(o);this.elm=o};null!=c?(this.create(c),this.name=this.elm.id):this.elm=document.getElementById(d);if(!this.elm){return !1}this.css=this.elm.style;this.event=this.elm;this.width=this.elm.offsetWidth;this.height=this.elm.offsetHeight;this.x=parseInt(this.elm.offsetLeft);this.y=parseInt(this.elm.offsetTop);this.visible="visible"==this.css.visibility||"show"==this.css.visibility||"inherit"==this.css.visibility?!0:!1;this.move=function(f,e){this.x=f;this.y=e;this.css.left=Math.round(this.x)+"px";this.css.top=Math.round(this.y)+"px"};this.resize=function(f,e){this.css.width=f+"px";this.css.height=e+"px";this.width=f;this.height=e};this.show=function(b){1==b?(this.css.visibility="visible",this.visible=!0):2==b?(this.css.visibility="inherit",this.visible=!0):(this.css.visibility="hidden",this.visible=!1)};this.write=function(b){this.elm.innerHTML=b}}function rcmail_scroller(f,e,g){var h=this;this.list=$(f);this.top=$(e);this.bottom=$(g);this.step_size=6;this.step_time=20;this.delay=500;this.top.mouseenter(function(){h.ts=window.setTimeout(function(){h.scroll("down")},h.delay)}).mouseout(function(){h.ts&&window.clearTimeout(h.ts)});this.bottom.mouseenter(function(){h.ts=window.setTimeout(function(){h.scroll("up")},h.delay)}).mouseout(function(){h.ts&&window.clearTimeout(h.ts)});this.scroll=function(j){var d=this,k=this.step_size;rcmail.drag_active&&("down"==j&&(k*=-1),this.list.get(0).scrollTop+=k,this.ts=window.setTimeout(function(){d.scroll(j)},this.step_time))}}function rcube_render_mailboxlist(){var b=$("#mailboxlist > li > a, #mailboxlist ul:visible > li > a");100<b.length||b.each(function(){var e=$(this),f=e.data("text");f||(f=e.text().replace(/\s+\([0-9]+\)$/,""),e.data("text",f));if(!(6>f.length)){var g=fit_string_to_size(f,e,e.width()-e.children("span.unreadcount").width()-16);g!=f&&e.attr("title",f);e.contents().filter(function(){return 3==this.nodeType}).get(0).data=g}})}function fit_string_to_size(j,h,n){var o=j;rcmail.env.tmp_span?h=rcmail.env.tmp_span:(h=$("<b>").css({visibility:"hidden",padding:"0px","font-family":h.css("font-family"),"font-size":h.css("font-size")}).appendTo($("body",document)).get(0),rcmail.env.tmp_span=h);var l=$(h);l.text(o);var m=h.offsetWidth;if(m>n){n=Math.max(1,Math.floor((m-n)/m*j.length/2));o=Math.floor(j.length/2);for(var k;;){m=o-n;k=o+n;l.text(j.substring(0,m)+"..."+j.substring(k));if(3>m||h.offsetWidth){break}n++}o=j.substring(0,m)+"..."+j.substring(k)}return o}function update_quota(d){percent_indicator(rcmail.gui_objects.quotadisplay,d);if(d.table){var c=$("#quotamenu");c.length||(c=$('<div id="quotamenu" class="popupmenu">').appendTo($("body")));c.html(d.table);$("#quotaimg").css("cursor","pointer").off("click").on("click",function(b){return rcmail.command("menu-open","quotamenu",b.target,b)})}}function percent_indicator(s,r){if(!r||!s){return !1}var p=r.width?r.width:rcmail.env.indicator_width?rcmail.env.indicator_width:100,q=r.height?r.height:rcmail.env.indicator_height?rcmail.env.indicator_height:14,n=r.percent?Math.abs(parseInt(r.percent)):0,o=parseInt(n/100*p),m=$(s).position();m.top=Math.max(0,m.top);m.left=Math.max(0,m.left);rcmail.env.indicator_width=p;rcmail.env.indicator_height=q;o>p&&(o=p,n=100);r.title&&(r.title=rcmail.get_label("quota")+": "+r.title);var j=$("<div>");j.css({position:"absolute",top:m.top,left:m.left,width:p+"px",height:q+"px",zIndex:100,lineHeight:q+"px"}).attr("title",r.title).addClass("quota_text").html(n+"%");var h=$("<div>");h.css({position:"absolute",top:m.top+1,left:m.left+1,width:o+"px",height:q+"px",zIndex:99});o=$("<div>");o.css({position:"absolute",top:m.top+1,left:m.left+1,width:p+"px",height:q+"px",zIndex:98}).addClass("quota_bg");80<=n?(j.addClass(" quota_text_high"),h.addClass("quota_high")):55<=n?(j.addClass(" quota_text_mid"),h.addClass("quota_mid")):(j.addClass(" quota_text_low"),h.addClass("quota_low"));$(s).html("").append(h).append(o).append(j);$("#quotaimg").attr("title",r.title)}function attachment_menu_append(b){$(b).append($('<a class="drop"></a>').on("click keypress",function(c){if("keypress"!=c.type||13==c.which){return rcmail_ui.show_attachmentmenu(this,c),!1}}))}var rcmail_editor_settings={},rcmail_ui;function rcube_init_mail_ui(){rcmail_ui=new rcube_mail_ui;$(document.body).mouseup(function(b){rcmail_ui.body_mouseup(b)}).mousedown(function(b){rcmail_ui.body_keydown(b)});rcmail.addEventListener("init",function(){rcmail.env.quota_content&&update_quota(rcmail.env.quota_content);rcmail.addEventListener("setquota",update_quota);rcube_webmail.set_iframe_events({mouseup:function(b){return rcmail_ui.body_mouseup(b)}});if("mail"==rcmail.env.task){if(rcmail.addEventListener("enable-command","enable_command",rcmail_ui).addEventListener("menu-open","menu_open",rcmail_ui).addEventListener("aftersend-attachment","uploadmenu",rcmail_ui).addEventListener("aftertoggle-editor","resize_compose_body_ev",rcmail_ui).gui_object("dragmenu","dragmenu"),rcmail.gui_objects.mailboxlist&&(rcmail.treelist.addEventListener("expand",rcube_render_mailboxlist),rcmail.addEventListener("responseaftermark",rcube_render_mailboxlist).addEventListener("responseaftergetunread",rcube_render_mailboxlist).addEventListener("responseaftercheck-recent",rcube_render_mailboxlist).addEventListener("responseafterrefresh",rcube_render_mailboxlist).addEventListener("afterimport-messages",function(){rcmail_ui.show_popup("uploadform",!1)})),rcmail.init_pagejumper("#pagejumper"),bw.ie&&rcmail.message_list&&$(window).resize(function(){setTimeout(function(){rcmail.message_list.resize()},10)}),"list"==rcmail.env.action||!rcmail.env.action){rcmail.addEventListener("layout-change","set_layout",rcmail_ui),rcmail_ui.set_layout()}else{if("compose"==rcmail.env.action){rcmail_ui.init_compose_form(),rcmail.addEventListener("compose-encrypted",function(b){$("a.button.encrypt")[b.active?"addClass":"removeClass"]("selected");$("select[name='editorSelector']").prop("disabled",b.active);$("a.button.attach, a.button.responses, a.button.attach, #uploadmenulink")[b.active?"addClass":"removeClass"]("buttonPas disabled");$("#responseslist a.insertresponse")[b.active?"removeClass":"addClass"]("active")}),rcmail.addEventListener("fileappended",function(b){b.attachment.complete&&attachment_menu_append(b.item)}),$("#attachmentslist > li").each(function(){attachment_menu_append(this)})}else{if("show"==rcmail.env.action||"preview"==rcmail.env.action){$('#attachment-list > li[id^="attach"]').each(function(){attachment_menu_append(this)}),$(window).resize(function(){$('#attachment-list > li[id^="attach"]').length||$("#attachment-list").hide();var d=$("#messagebody.mailvelope");if(d.length){var c=$("#messageframe");c=(c.length?c.height()+c.offset().top-25:$(this).height())-d.offset().top-20;d.height(c)}})}}}}else{"addressbook"==rcmail.env.task?rcmail.addEventListener("afterupload-photo",function(){rcmail_ui.show_popup("uploadform",!1)}).gui_object("dragmenu","dragmenu"):"settings"==rcmail.env.task&&"folders"==rcmail.env.action&&rcmail_ui.folder_search_init($("#folder-manager"))}})};