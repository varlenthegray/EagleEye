function rcube_init_settings_tabs(){var d;var f=$("#tabsbar");var b=$("span:last",f),a="#settingstabpreferences",c=window.rcmail&&rcmail.env.action?rcmail.env.action:null;b&&"settingstababout"!=b.attr("id")&&(d=$("#settingstababout"))&&(f=d.clone(!0),d.remove(),b.after(f));c&&(a="#settingstab"+(0<c.indexOf("identity")?"identities":c.replace(/\./g,"")));$(a).addClass("tablink-selected");$("a",a).removeAttr("onclick").click(function(){return !1})}function rcube_init_tabs(d,f){var b=$("#"+d),a=b.children("fieldset");if(a.length){f=f?f:0;a.each(function(e){e!=f&&$(this).hide()});var c=$("<div>").addClass("tabsbar").appendTo(b);a.each(function(g){var k=$(this),j=k.children("legend");var h=$("<a>").text(j.text()).attr("href","#");var e=$("<span>").attr({id:"tab"+g,"class":"tablink"}).click(function(){rcube_show_tab(d,g);return !1});j.remove();k.addClass("tabbed");g==f&&e.addClass("tablink-selected");e.append(h).appendTo(c)})}}function rcube_show_tab(a,b){$("#"+a).children("fieldset").each(function(c){$(this)[b==c?"show":"hide"]();$("#tab"+c).toggleClass("tablink-selected",c==b)})}function rcube_mail_ui(){this.popups={markmenu:{id:"markmessagemenu"},replyallmenu:{id:"replyallmenu"},forwardmenu:{id:"forwardmenu",editable:1},searchmenu:{id:"searchmenu",editable:1},messagemenu:{id:"messagemenu"},attachmentmenu:{id:"attachmentmenu"},dragmenu:{id:"dragmenu",sticky:1},groupmenu:{id:"groupoptionsmenu",above:1},mailboxmenu:{id:"mailboxoptionsmenu",above:1},composemenu:{id:"composeoptionsmenu",editable:1,overlap:1},spellmenu:{id:"spellmenu"},responsesmenu:{id:"responsesmenu"},uploadmenu:{id:"attachment-form",editable:1,above:1,toggle:!bw.ie&&!bw.linux},uploadform:{id:"upload-form",editable:1,toggle:!bw.ie&&!bw.linux}};var a;for(a in this.popups){var b=$("#"+this.popups[a].id);b.length?this.popups[a].obj=b:delete this.popups[a]}}rcube_mail_ui.prototype={show_popup:function(c,d,b){var a;!this.popups[c]&&(a=$("#"+c))&&a.length&&(this.popups[c]=$.extend(b,{id:c,obj:a}));return"function"==typeof this[c]?this[c](d):this.show_popupmenu(c,d)},show_popupmenu:function(e,f){var b=this.popups[e].obj,a=this.popups[e].above,d=$(this.popups[e].link?this.popups[e].link:rcube_find_object(e+"link"));"undefined"==typeof f?f=b.is(":visible")?!1:!0:this.popups[e].toggle&&f&&this.popups[e].obj.is(":visible")&&(f=!1);if(f&&d.length){var c=d.parent();e=$(window);c=c.hasClass("dropbutton")?c.offset():d.offset();!a&&c.top+d.height()+b.height()>e.height()&&(a=!0);c.left+b.width()>e.width()&&(c.left=e.width()-b.width()-30);b.css({left:c.left,top:c.top+(a?-b.height():d.height())})}b[f?"show":"hide"]()},dragmenu:function(a){this.popups.dragmenu.obj[a?"show":"hide"]()},forwardmenu:function(a){$("input[name='forwardtype'][value="+(rcmail.env.forward_attachment?1:0)+"]",this.popups.forwardmenu.obj).prop("checked",!0);this.show_popupmenu("forwardmenu",a)},uploadmenu:function(a){"object"==typeof a&&(a=!1);if(!a){try{$("#attachment-form form")[0].reset()}catch(b){}}rcmail.mailvelope_editor||(this.show_popupmenu("uploadmenu",a),!document.all&&this.popups.uploadmenu.obj.is(":visible")&&$("#attachment-form input[type=file]").click())},searchmenu:function(c){var d=this.popups.searchmenu.obj,f=rcube_find_object("searchmenulink");"undefined"==typeof c&&(c=d.is(":visible")?!1:!0);if(c&&f){var e=$(f).offset();d.css({left:e.left,top:e.top+f.offsetHeight+2});if(rcmail.env.search_mods){var k;f=$('input:checkbox[name="s_mods[]"]',d);e=rcmail.env.mailbox;var g=rcmail.env.search_mods,a=rcmail.env.search_scope||"base";if("mail"==rcmail.env.task){g=g[e]?g[e]:g["*"];var b="text";$('input:radio[name="s_scope"]').prop("checked",!1).filter("#s_scope_"+a).prop("checked",!0)}else{b="*"}if(g[b]){f.map(function(){this.checked=!0;this.disabled=this.value!=b})}else{for(k in f.prop("disabled",!1).prop("checked",!1),g){$("#s_mod_"+k).prop("checked",!0)}}}}d[c?"show":"hide"]()},set_searchmod:function(d){var f=rcmail.env.task;var b=rcmail.env.search_mods,a=rcmail.env.mailbox;"all"==$('input[name="s_scope"]:checked').val()&&(a="*");b||(b={});if("mail"==f){b[a]||(b[a]=rcube_clone_object(b["*"]));var c=b[a];f="text"}else{c=b,f="*"}d.checked?c[d.value]=1:delete c[d.value];d.value==f&&$('input:checkbox[name="s_mods[]"]').map(function(){this!=d&&(this.checked=!0,d.checked?(this.disabled=!0,delete c[this.value]):(this.disabled=!1,c[this.value]=1))});rcmail.set_searchmods(c)},show_listmenu:function(c){var d=this,b={},a=$("#listmenu");a.is(":visible")?a.dialog("close",c.originalEvent):($('input[name="sort_col"][value="'+rcmail.env.sort_col+'"]').prop("checked",!0),$('input[name="sort_ord"][value="DESC"]').prop("checked","DESC"==rcmail.env.sort_order),$('input[name="sort_ord"][value="ASC"]').prop("checked","DESC"!=rcmail.env.sort_order),$('input[name="view"][value="thread"]').prop("checked",rcmail.env.threading?!0:!1),$('input[name="view"][value="list"]').prop("checked",rcmail.env.threading?!1:!0),$('input[name="list_col[]"]').each(function(){$(this).prop("checked",-1!=$.inArray(this.value,rcmail.env.listcols))}),$.each(["widescreen","desktop","list"],function(){$('input[name="layout"][value="'+this+'"]').prop("checked",rcmail.env.layout==this)}),$("#listoptions-columns",a)["widescreen"==rcmail.env.layout?"hide":"show"](),b[rcmail.gettext("save")]=function(e){a.dialog("close",e);d.save_listmenu()},a.dialog({modal:!0,resizable:!1,closeOnEscape:!0,title:null,open:function(e){var f=0;$("#listmenu fieldset").each(function(){var g=$(this).height();g>f&&(f=g)}).css("min-height",f+"px").height(f);setTimeout(function(){a.find("a, input:not(:disabled)").not("[aria-disabled=true]").first().focus()},100)},close:function(e){a.dialog("destroy").hide();e.originalEvent&&rcube_event.is_keyboard(e.originalEvent)&&$("#listmenulink").focus()},buttons:b,minWidth:500,width:a.width()+20}).show())},save_listmenu:function(){var d=$('input[name="sort_col"]:checked').val(),f=$('input[name="sort_ord"]:checked').val(),b=$('input[name="view"]:checked').val(),a=$('input[name="layout"]:checked').val(),c=$('input[name="list_col[]"]:checked').map(function(){return this.value}).get();rcmail.set_list_options(c,d,f,"thread"==b?1:0,a)},spellmenu:function(e){var f=rcmail.spellcheck_lang(),b=this.popups.spellmenu.obj,a=$("ul",b);if(!a.length){a=$("<ul>");for(i in rcmail.env.spell_langs){var d=$("<li>");var c=$('<a href="#"></a>').text(rcmail.env.spell_langs[i]).addClass("active").data("lang",i).click(function(){rcmail.spellcheck_lang_set($(this).data("lang"))});c.appendTo(d);d.appendTo(a)}a.appendTo(b)}$("li",a).each(function(){var g=$("a",this);g.data("lang")==f?g.addClass("selected"):g.hasClass("selected")&&g.removeClass("selected")});this.show_popupmenu("spellmenu",e)},show_attachmentmenu:function(b,d){var a=b.parentNode.id.replace(/^attach/,"");$.each(["open","download","rename"],function(){var c=this;$("#attachmenu"+c).off("click").attr("onclick","").click(function(e){return rcmail.command(c+"-attachment",a,this)})});this.popups.attachmentmenu.link=b;rcmail.command("menu-open",{menu:"attachmentmenu",id:a},b,d)},menu_open:function(a){a&&"messagelistmenu"==a.name&&this.show_listmenu()},body_mouseup:function(a){var b=a.target;ref=this;$.each(this.popups,function(d,c){!c.obj.is(":visible")||b==rcube_find_object(d+"link")||c.toggle||b==c.obj.get(0)||c.editable&&ref.target_overlaps(b,c.id)||c.sticky&&rcube_mouse_is_over(a,rcube_find_object(c.id))||$(b).is(".folder-selector-link")||$(b).children(".folder-selector-link").length||window.setTimeout('rcmail_ui.show_popup("'+d+'",false);',50)})},target_overlaps:function(a,b){for(b=rcube_find_object(b);a.parentNode;){if(a.parentNode==b){return !0}a=a.parentNode}return !1},body_keydown:function(a){if(27==a.keyCode){for(var b in this.popups){this.popups[b].obj.is(":visible")&&this.show_popup(b,!1)}}},set_layout:function(c){var d=c?c.new_layout:rcmail.env.layout,b=$("#mailcontframe"),a=$("#mailpreviewframe");c&&$("#mailrightcontainer").removeClass().addClass(d);this.mailviewsplitv||(this.mailviewsplitv=new rcube_splitter({id:"mailviewsplitterv",p1:"mailleftcontainer",p2:"mailrightcontainer",orientation:"v",relative:!0,start:165,callback:rcube_render_mailboxlist}),this.mailviewsplitv.init());$("#mailviewsplitter")["desktop"==d?"show":"hide"]();$("#mailviewsplitter2")["widescreen"==d?"show":"hide"]();$("#mailpreviewframe")["list"!=d?"show":"hide"]();rcmail.env.contentframe="list"==d?null:"messagecontframe";"widescreen"==d?($("#countcontrols").detach().appendTo($("#messagelistheader")),b.css({height:"auto",width:400}),a.css({top:0,left:410,height:"auto"}).show(),this.mailviewsplit2?this.mailviewsplit2.resize():(this.mailviewsplit2=new rcube_splitter({id:"mailviewsplitter2",p1:"mailcontframe",p2:"mailpreviewframe",orientation:"v",relative:!0,start:405}),this.mailviewsplit2.init())):"desktop"==d?(b.css({height:200,width:"100%"}),a.css({left:0,top:210,height:"auto"}).show(),this.mailviewsplit?this.mailviewsplit.resize():(this.mailviewsplit=new rcube_splitter({id:"mailviewsplitter",p1:"mailcontframe",p2:"mailpreviewframe",orientation:"h",relative:!0,start:205}),this.mailviewsplit.init())):(b.css({height:"auto",width:"100%"}),a.hide());c&&"widescreen"==c.old_layout&&$("#countcontrols").detach().appendTo($("#messagelistfooter"))},init_compose_form:function(){var e,f=["cc","bcc","replyto","followupto"],b=document.getElementById("compose-div"),a=document.getElementById("compose-headers-div");for(e=0;e<f.length;e++){var d=f[e];var c=$("#_"+d);c.length&&(c.on("change",{v:d},function(g){this.value&&rcmail_ui.show_header_form(g.data.v)}),""!=c.val()&&rcmail_ui.show_header_form(d))}bw.ie&&(rcube_find_object("form").onkeydown=function(g){27==rcube_event.get_keycode(g)&&rcube_event.cancel(g)});$(window).resize(function(){rcmail_ui.resize_compose_body()});$("#compose-container").resize(function(){rcmail_ui.resize_compose_body()});b.style.top=parseInt(a.offsetHeight,10)+3+"px";$(window).resize();$("#contacts-table").css("top",$("#directorylist").height()+24+"px");$("#quicksearchbox").keydown(function(g){13==rcube_event.get_keycode(g)&&rcmail.command("search")})},resize_compose_body:function(){var b=$("#compose-div .boxlistcontent"),d=b.width()-6;b=b.height()-2;var a=bw.ie||bw.opera?4:0;$("#compose-body_ifr").width(d+6).height(b-1-$("div.mce-toolbar").height());$("#compose-body").width(d-a).height(b);$("#googie_edit_layer").width(d).height(b)},resize_compose_body_ev:function(){window.setTimeout(function(){rcmail_ui.resize_compose_body()},100)},show_header_form:function(b){var d,a=document.getElementById(b+"-link");if(d=this.next_sibling(a)){d.style.display="none"}else{if(d=this.prev_sibling(a)){d.style.display="none"}}a.style.display="none";if(b=document.getElementById("compose-"+b)){d=document.getElementById("compose-div"),a=document.getElementById("compose-headers-div"),$(b).show(),d.style.top=parseInt(a.offsetHeight,10)+3+"px",this.resize_compose_body()}return !1},hide_header_form:function(d){var f,b=document.getElementById(d+"-link"),a=b.parentNode.getElementsByTagName("a");b.style.display="";for(b=0;b<a.length;b++){if("none"!=a[b].style.display){for(var c=b+1;c<a.length;c++){if("none"!=a[c].style.display&&(f=this.next_sibling(a[b]))){f.style.display="";break}}}}document.getElementById("_"+d).value="";if(d=document.getElementById("compose-"+d)){f=document.getElementById("compose-div"),a=document.getElementById("compose-headers-div"),d.style.display="none",f.style.top=parseInt(a.offsetHeight,10)+1+"px",this.resize_compose_body()}return !1},next_sibling:function(a){for(a=a.nextSibling;a&&3==a.nodeType;){a=a.nextSibling}return a},prev_sibling:function(a){for(a=a.previousSibling;a&&3==a.nodeType;){a=a.previousSibling}return a},enable_command:function(a){"reply-list"==a.command&&1==rcmail.env.reply_all_mode?(a=rcmail.gettext(a.status?"replylist":"replyall"),$("a.button.replyAll").attr("title",a)):"compose-encrypted"==a.command&&$("#messagetoolbar > a.encrypt").show()},folder_search_init:function(a){$(".boxtitle a.search",a).click(function(b){var d=$(".boxtitle",a),c=$(".listsearchbox",a),f=c.is(":visible")?-1:1,e=24+($("select",c).length?24:0);c.slideToggle({duration:160,progress:function(h,g){0>f&&(g=1-g);$(".boxlistcontent",a).css("top",d.outerHeight()+e*g+"px")},complete:function(){c.toggleClass("expanded");c.is(":visible")?c.find("input[type=text]").focus():$("a.reset",c).click()}});return !1})}};function rcube_layer(a,b){this.name=a;this.create=function(c){var h=c.x?c.x:0,e=c.y?c.y:0,g=c.width,k=c.height,s=c.zindex,d=c.vis;c=c.parent;var l=document.createElement("DIV");l.id=this.name;l.style.position="absolute";l.style.visibility=d?2==d?"inherit":"visible":"hidden";l.style.left=h+"px";l.style.top=e+"px";g&&(l.style.width=g.toString().match(/%$/)?g:g+"px");k&&(l.style.height=k.toString().match(/%$/)?k:k+"px");s&&(l.style.zIndex=s);c?c.appendChild(l):document.body.appendChild(l);this.elm=l};null!=b?(this.create(b),this.name=this.elm.id):this.elm=document.getElementById(a);if(!this.elm){return !1}this.css=this.elm.style;this.event=this.elm;this.width=this.elm.offsetWidth;this.height=this.elm.offsetHeight;this.x=parseInt(this.elm.offsetLeft);this.y=parseInt(this.elm.offsetTop);this.visible="visible"==this.css.visibility||"show"==this.css.visibility||"inherit"==this.css.visibility?!0:!1;this.move=function(c,d){this.x=c;this.y=d;this.css.left=Math.round(this.x)+"px";this.css.top=Math.round(this.y)+"px"};this.resize=function(c,d){this.css.width=c+"px";this.css.height=d+"px";this.width=c;this.height=d};this.show=function(c){1==c?(this.css.visibility="visible",this.visible=!0):2==c?(this.css.visibility="inherit",this.visible=!0):(this.css.visibility="hidden",this.visible=!1)};this.write=function(c){this.elm.innerHTML=c}}function rcmail_scroller(c,d,b){var a=this;this.list=$(c);this.top=$(d);this.bottom=$(b);this.step_size=6;this.step_time=20;this.delay=500;this.top.mouseenter(function(){a.ts=window.setTimeout(function(){a.scroll("down")},a.delay)}).mouseout(function(){a.ts&&window.clearTimeout(a.ts)});this.bottom.mouseenter(function(){a.ts=window.setTimeout(function(){a.scroll("up")},a.delay)}).mouseout(function(){a.ts&&window.clearTimeout(a.ts)});this.scroll=function(f){var g=this,e=this.step_size;rcmail.drag_active&&("down"==f&&(e*=-1),this.list.get(0).scrollTop+=e,this.ts=window.setTimeout(function(){g.scroll(f)},this.step_time))}}function rcube_render_mailboxlist(){var a=$("#mailboxlist > li > a, #mailboxlist ul:visible > li > a");100<a.length||a.each(function(){var d=$(this),c=d.data("text");c||(c=d.text().replace(/\s+\([0-9]+\)$/,""),d.data("text",c));if(!(6>c.length)){var b=fit_string_to_size(c,d,d.width()-d.children("span.unreadcount").width()-16);b!=c&&d.attr("title",c);d.contents().filter(function(){return 3==this.nodeType}).get(0).data=b}})}function fit_string_to_size(d,e,g){var f=d;rcmail.env.tmp_span?e=rcmail.env.tmp_span:(e=$("<b>").css({visibility:"hidden",padding:"0px","font-family":e.css("font-family"),"font-size":e.css("font-size")}).appendTo($("body",document)).get(0),rcmail.env.tmp_span=e);var b=$(e);b.text(f);var a=e.offsetWidth;if(a>g){g=Math.max(1,Math.floor((a-g)/a*d.length/2));f=Math.floor(d.length/2);for(var c;;){a=f-g;c=f+g;b.text(d.substring(0,a)+"..."+d.substring(c));if(3>a||e.offsetWidth){break}g++}f=d.substring(0,a)+"..."+d.substring(c)}return f}function update_quota(a){percent_indicator(rcmail.gui_objects.quotadisplay,a);if(a.table){var b=$("#quotamenu");b.length||(b=$('<div id="quotamenu" class="popupmenu">').appendTo($("body")));b.html(a.table);$("#quotaimg").css("cursor","pointer").off("click").on("click",function(c){return rcmail.command("menu-open","quotamenu",c.target,c)})}}function percent_indicator(l,a){if(!a||!l){return !1}var c=a.width?a.width:rcmail.env.indicator_width?rcmail.env.indicator_width:100,b=a.height?a.height:rcmail.env.indicator_height?rcmail.env.indicator_height:14,e=a.percent?Math.abs(parseInt(a.percent)):0,d=parseInt(e/100*c),f=$(l).position();f.top=Math.max(0,f.top);f.left=Math.max(0,f.left);rcmail.env.indicator_width=c;rcmail.env.indicator_height=b;d>c&&(d=c,e=100);a.title&&(a.title=rcmail.get_label("quota")+": "+a.title);var g=$("<div>");g.css({position:"absolute",top:f.top,left:f.left,width:c+"px",height:b+"px",zIndex:100,lineHeight:b+"px"}).attr("title",a.title).addClass("quota_text").html(e+"%");var k=$("<div>");k.css({position:"absolute",top:f.top+1,left:f.left+1,width:d+"px",height:b+"px",zIndex:99});d=$("<div>");d.css({position:"absolute",top:f.top+1,left:f.left+1,width:c+"px",height:b+"px",zIndex:98}).addClass("quota_bg");80<=e?(g.addClass(" quota_text_high"),k.addClass("quota_high")):55<=e?(g.addClass(" quota_text_mid"),k.addClass("quota_mid")):(g.addClass(" quota_text_low"),k.addClass("quota_low"));$(l).html("").append(k).append(d).append(g);$("#quotaimg").attr("title",a.title)}function attachment_menu_append(a){$(a).append($('<a class="drop"></a>').on("click keypress",function(b){if("keypress"!=b.type||13==b.which){return rcmail_ui.show_attachmentmenu(this,b),!1}}))}var rcmail_editor_settings={},rcmail_ui;function rcube_init_mail_ui(){rcmail_ui=new rcube_mail_ui;$(document.body).mouseup(function(a){rcmail_ui.body_mouseup(a)}).mousedown(function(a){rcmail_ui.body_keydown(a)});rcmail.addEventListener("init",function(){rcmail.env.quota_content&&update_quota(rcmail.env.quota_content);rcmail.addEventListener("setquota",update_quota);rcube_webmail.set_iframe_events({mouseup:function(a){return rcmail_ui.body_mouseup(a)}});if("mail"==rcmail.env.task){if(rcmail.addEventListener("enable-command","enable_command",rcmail_ui).addEventListener("menu-open","menu_open",rcmail_ui).addEventListener("aftersend-attachment","uploadmenu",rcmail_ui).addEventListener("aftertoggle-editor","resize_compose_body_ev",rcmail_ui).gui_object("dragmenu","dragmenu"),rcmail.gui_objects.mailboxlist&&(rcmail.treelist.addEventListener("expand",rcube_render_mailboxlist),rcmail.addEventListener("responseaftermark",rcube_render_mailboxlist).addEventListener("responseaftergetunread",rcube_render_mailboxlist).addEventListener("responseaftercheck-recent",rcube_render_mailboxlist).addEventListener("responseafterrefresh",rcube_render_mailboxlist).addEventListener("afterimport-messages",function(){rcmail_ui.show_popup("uploadform",!1)})),rcmail.init_pagejumper("#pagejumper"),bw.ie&&rcmail.message_list&&$(window).resize(function(){setTimeout(function(){rcmail.message_list.resize()},10)}),"list"==rcmail.env.action||!rcmail.env.action){rcmail.addEventListener("layout-change","set_layout",rcmail_ui),rcmail_ui.set_layout()}else{if("compose"==rcmail.env.action){rcmail_ui.init_compose_form(),rcmail.addEventListener("compose-encrypted",function(a){$("a.button.encrypt")[a.active?"addClass":"removeClass"]("selected");$("select[name='editorSelector']").prop("disabled",a.active);$("a.button.attach, a.button.responses, a.button.attach, #uploadmenulink")[a.active?"addClass":"removeClass"]("buttonPas disabled");$("#responseslist a.insertresponse")[a.active?"removeClass":"addClass"]("active")}),rcmail.addEventListener("fileappended",function(a){a.attachment.complete&&attachment_menu_append(a.item)}),$("#attachmentslist > li").each(function(){attachment_menu_append(this)})}else{if("show"==rcmail.env.action||"preview"==rcmail.env.action){$('#attachment-list > li[id^="attach"]').each(function(){attachment_menu_append(this)}),$(window).resize(function(){$('#attachment-list > li[id^="attach"]').length||$("#attachment-list").hide();var a=$("#messagebody.mailvelope");if(a.length){var b=$("#messageframe");b=(b.length?b.height()+b.offset().top-25:$(this).height())-a.offset().top-20;a.height(b)}})}}}}else{"addressbook"==rcmail.env.task?rcmail.addEventListener("afterupload-photo",function(){rcmail_ui.show_popup("uploadform",!1)}).gui_object("dragmenu","dragmenu"):"settings"==rcmail.env.task&&"folders"==rcmail.env.action&&rcmail_ui.folder_search_init($("#folder-manager"))}})};