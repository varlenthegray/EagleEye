tinymce.PluginManager.add("textcolor",function(j){function p(a){var c;return j.dom.getParents(j.selection.getStart(),function(l){var i;(i=l.style["forecolor"==a?"color":"background-color"])&&(c=i)}),c}function f(c){var l,e,a=[];for(e=["000000","Black","993300","Burnt orange","333300","Dark olive","003300","Dark green","003366","Dark azure","000080","Navy Blue","333399","Indigo","333333","Very dark gray","800000","Maroon","FF6600","Orange","808000","Olive","008000","Green","008080","Teal","0000FF","Blue","666699","Grayish blue","808080","Gray","FF0000","Red","FF9900","Amber","99CC00","Yellow green","339966","Sea green","33CCCC","Turquoise","3366FF","Royal blue","800080","Purple","999999","Medium gray","FF00FF","Magenta","FFCC00","Gold","FFFF00","Yellow","00FF00","Lime","00FFFF","Aqua","00CCFF","Sky blue","993366","Red violet","FFFFFF","White","FF99CC","Pink","FFCC99","Peach","FFFF99","Light yellow","CCFFCC","Pale green","CCFFFF","Pale cyan","99CCFF","Light sky blue","CC99FF","Plum"],e=j.settings.textcolor_map||e,e=j.settings[c+"_map"]||e,l=0;l<e.length;l+=2){a.push({text:e[l+1],color:"#"+e[l]})}return a}function b(){function B(i,a){var o="transparent"==i;return'<td class="mce-grid-cell'+(o?" mce-colorbtn-trans":"")+'"><div id="'+n+"-"+w+++'" data-mce-color="'+(i?i:"")+'" role="option" tabIndex="-1" style="'+(i?"background-color: "+i:"")+'" title="'+tinymce.translate(a)+'">'+(o?"&#215;":"")+"</div></td>"}var c,v,l,z,C,A,y,x,e=this,n=e._id,w=0;for(x=e.settings.origin,c=f(x),c.push({text:tinymce.translate("No color"),color:"transparent"}),l='<table class="mce-grid mce-grid-border mce-colorbutton-grid" role="list" cellspacing="0"><tbody>',z=c.length-1,A=0;A<k[x];A++){for(l+="<tr>",C=0;C<g[x];C++){y=A*g[x]+C,y>z?l+="<td></td>":(v=c[y],l+=B(v.color,v.text))}l+="</tr>"}if(j.settings.color_picker_callback){for(l+='<tr><td colspan="'+g[x]+'" class="mce-custom-color-btn"><div id="'+n+'-c" class="mce-widget mce-btn mce-btn-small mce-btn-flat" role="button" tabindex="-1" aria-labelledby="'+n+'-c" style="width: 100%"><button type="button" role="presentation" tabindex="-1">'+tinymce.translate("Custom...")+"</button></div></td></tr>",l+="<tr>",C=0;C<g[x];C++){l+=B("","Custom color")}l+="</tr>"}return l+="</tbody></table>"}function h(a,c){j.undoManager.transact(function(){j.focus(),j.formatter.apply(a,{value:c}),j.nodeChanged()})}function d(a){j.undoManager.transact(function(){j.focus(),j.formatter.remove(a,{value:null},null,!0),j.nodeChanged()})}function m(w){function o(a){t.hidePanel(),t.color(a),h(t.settings.format,a)}function e(){t.hidePanel(),t.resetColor(),d(t.settings.format)}function l(c,a){c.style.background=a,c.setAttribute("data-mce-color",a)}var v,i,t=this.parent();i=t.settings.origin,tinymce.DOM.getParent(w.target,".mce-custom-color-btn")&&(t.hidePanel(),j.settings.color_picker_callback.call(j,function(r){var c,u,a,s=t.panel.getEl().getElementsByTagName("table")[0];for(c=tinymce.map(s.rows[s.rows.length-1].childNodes,function(n){return n.firstChild}),a=0;a<c.length&&(u=c[a],u.getAttribute("data-mce-color"));a++){}if(a==g[i]){for(a=0;a<g[i]-1;a++){l(c[a],c[a+1].getAttribute("data-mce-color"))}}l(u,r),o(r)},p(t.settings.format))),v=w.target.getAttribute("data-mce-color"),v?(this.lastId&&document.getElementById(this.lastId).setAttribute("aria-selected",!1),w.target.setAttribute("aria-selected",!0),this.lastId=w.target.id,"transparent"==v?e():o(v)):null!==v&&t.hidePanel()}function q(){var a=this;a._color?h(a.settings.format,a._color):d(a.settings.format)}var g,k;k={forecolor:j.settings.forecolor_rows||j.settings.textcolor_rows||5,backcolor:j.settings.backcolor_rows||j.settings.textcolor_rows||5},g={forecolor:j.settings.forecolor_cols||j.settings.textcolor_cols||8,backcolor:j.settings.backcolor_cols||j.settings.textcolor_cols||8},j.addButton("forecolor",{type:"colorbutton",tooltip:"Text color",format:"forecolor",panel:{origin:"forecolor",role:"application",ariaRemember:!0,html:b,onclick:m},onclick:q}),j.addButton("backcolor",{type:"colorbutton",tooltip:"Background color",format:"hilitecolor",panel:{origin:"backcolor",role:"application",ariaRemember:!0,html:b,onclick:m},onclick:q})});