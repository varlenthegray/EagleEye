tinymce.PluginManager.add("textcolor",function(l){function c(b){var d;return l.dom.getParents(l.selection.getStart(),function(f){var g;(g=f.style["forecolor"==b?"color":"background-color"])&&(d=g)}),d}function r(g){var d,f,b=[];for(f=["000000","Black","993300","Burnt orange","333300","Dark olive","003300","Dark green","003366","Dark azure","000080","Navy Blue","333399","Indigo","333333","Very dark gray","800000","Maroon","FF6600","Orange","808000","Olive","008000","Green","008080","Teal","0000FF","Blue","666699","Grayish blue","808080","Gray","FF0000","Red","FF9900","Amber","99CC00","Yellow green","339966","Sea green","33CCCC","Turquoise","3366FF","Royal blue","800080","Purple","999999","Medium gray","FF00FF","Magenta","FFCC00","Gold","FFFF00","Yellow","00FF00","Lime","00FFFF","Aqua","00CCFF","Sky blue","993366","Red violet","FFFFFF","White","FF99CC","Pink","FFCC99","Peach","FFFF99","Light yellow","CCFFCC","Pale green","CCFFFF","Pale cyan","99CCFF","Light sky blue","CC99FF","Plum"],f=l.settings.textcolor_map||f,f=l.settings[g+"_map"]||f,d=0;d<f.length;d+=2){b.push({text:f[d+1],color:"#"+f[d]})}return b}function t(){function d(w,v){var x="transparent"==w;return'<td class="mce-grid-cell'+(x?" mce-colorbtn-trans":"")+'"><div id="'+g+"-"+u+++'" data-mce-color="'+(w?w:"")+'" role="option" tabIndex="-1" style="'+(w?"background-color: "+w:"")+'" title="'+tinymce.translate(v)+'">'+(x?"&#215;":"")+"</div></td>"}var k,D,h,m,b,f,p,q,j=this,g=j._id,u=0;for(q=j.settings.origin,k=r(q),k.push({text:tinymce.translate("No color"),color:"transparent"}),h='<table class="mce-grid mce-grid-border mce-colorbutton-grid" role="list" cellspacing="0"><tbody>',m=k.length-1,f=0;f<i[q];f++){for(h+="<tr>",b=0;b<o[q];b++){p=f*o[q]+b,p>m?h+="<td></td>":(D=k[p],h+=d(D.color,D.text))}h+="</tr>"}if(l.settings.color_picker_callback){for(h+='<tr><td colspan="'+o[q]+'" class="mce-custom-color-btn"><div id="'+g+'-c" class="mce-widget mce-btn mce-btn-small mce-btn-flat" role="button" tabindex="-1" aria-labelledby="'+g+'-c" style="width: 100%"><button type="button" role="presentation" tabindex="-1">'+tinymce.translate("Custom...")+"</button></div></td></tr>",h+="<tr>",b=0;b<o[q];b++){h+=d("","Custom color")}h+="</tr>"}return h+="</tbody></table>"}function n(b,d){l.undoManager.transact(function(){l.focus(),l.formatter.apply(b,{value:d}),l.nodeChanged()})}function s(b){l.undoManager.transact(function(){l.focus(),l.formatter.remove(b,{value:null},null,!0),l.nodeChanged()})}function e(d){function k(m){g.hidePanel(),g.color(m),n(g.settings.format,m)}function j(){g.hidePanel(),g.resetColor(),s(g.settings.format)}function b(p,m){p.style.background=m,p.setAttribute("data-mce-color",m)}var f,h,g=this.parent();h=g.settings.origin,tinymce.DOM.getParent(d.target,".mce-custom-color-btn")&&(g.hidePanel(),l.settings.color_picker_callback.call(l,function(v){var w,p,m,q=g.panel.getEl().getElementsByTagName("table")[0];for(w=tinymce.map(q.rows[q.rows.length-1].childNodes,function(u){return u.firstChild}),m=0;m<w.length&&(p=w[m],p.getAttribute("data-mce-color"));m++){}if(m==o[h]){for(m=0;m<o[h]-1;m++){b(w[m],w[m+1].getAttribute("data-mce-color"))}}b(p,v),k(v)},c(g.settings.format))),f=d.target.getAttribute("data-mce-color"),f?(this.lastId&&document.getElementById(this.lastId).setAttribute("aria-selected",!1),d.target.setAttribute("aria-selected",!0),this.lastId=d.target.id,"transparent"==f?j():k(f)):null!==f&&g.hidePanel()}function a(){var b=this;b._color?n(b.settings.format,b._color):s(b.settings.format)}var o,i;i={forecolor:l.settings.forecolor_rows||l.settings.textcolor_rows||5,backcolor:l.settings.backcolor_rows||l.settings.textcolor_rows||5},o={forecolor:l.settings.forecolor_cols||l.settings.textcolor_cols||8,backcolor:l.settings.backcolor_cols||l.settings.textcolor_cols||8},l.addButton("forecolor",{type:"colorbutton",tooltip:"Text color",format:"forecolor",panel:{origin:"forecolor",role:"application",ariaRemember:!0,html:t,onclick:e},onclick:a}),l.addButton("backcolor",{type:"colorbutton",tooltip:"Background color",format:"hilitecolor",panel:{origin:"backcolor",role:"application",ariaRemember:!0,html:t,onclick:e},onclick:a})});