!function(){var h={},d=function(q){for(var w=h[q],p=w.deps,u=w.defn,m=p.length,r=new Array(m),e=0;e<m;++e){r[e]=g(p[e])}var v=u.apply(null,r);if(void 0===v){throw"module ["+q+"] returned undefined"}w.instance=v},k=function(a,i,e){if("string"!=typeof a){throw"module id must be a string"}if(void 0===i){throw"no dependencies for "+a}if(void 0===e){throw"no definition function for "+a}h[a]={deps:i,defn:e,instance:void 0}},g=function(e){var a=h[e];if(void 0===a){throw"module ["+e+"] was undefined"}return void 0===a.instance&&d(e),a.instance},c=function(m,l){for(var q=m.length,a=new Array(q),p=0;p<q;++p){a[p]=g(m[p])}l.apply(null,a)},j={};j.bolt={module:{api:{define:k,require:c,demand:g}}};var b=k,f=function(i,a){b(i,[],function(){return a})};f("1",tinymce.PluginManager),f("2",tinymce.Env),f("3",tinymce.util.Promise),f("4",tinymce.util.URI),f("5",tinymce.util.Tools),f("6",tinymce.util.Delay),b("m",[],function(){function l(o,n){return i(document.createElement("canvas"),o,n)}function a(n){return n.getContext("2d")}function m(o){var n=null;try{n=o.getContext("webgl")||o.getContext("experimental-webgl")}catch(o){}return n||(n=null),n}function i(p,o,q){return p.width=o,p.height=q,p}return{create:l,resize:i,get2dContext:a,get3dContext:m}}),b("n",[],function(){function i(l){return l.naturalWidth||l.width}function a(l){return l.naturalHeight||l.height}return{getWidth:i,getHeight:a}}),b("o",[],function(){function w(i,a){return function(){i.apply(a,arguments)}}function z(a){if("object"!=typeof this){throw new TypeError("Promises must be constructed via new")}if("function"!=typeof a){throw new TypeError("not a function")}this._state=null,this._value=null,this._deferreds=[],A(a,w(m,this),w(v,this))}function q(i){var a=this;return null===this._state?void this._deferreds.push(i):void u(function(){var o=e._state?i.onFulfilled:i.onRejected;if(null===o){return void (e._state?i.resolve:i.reject)(e._value)}var l;try{l=o(e._value)}catch(e){return void i.reject(e)}i.resolve(l)})}function m(a){try{if(a===this){throw new TypeError("A promise cannot be resolved with itself.")}if(a&&("object"==typeof a||"function"==typeof a)){var l=a.then;if("function"==typeof l){return void A(i(l,a),i(m,this),i(v,this))}}this._state=!0,this._value=a,p.call(this)}catch(i){v.call(this,i)}}function v(a){this._state=!1,this._value=a,p.call(this)}function p(){for(var i=0,a=this._deferreds.length;i<a;i++){q.call(this,this._deferreds[i])}this._deferreds=null}function y(l,a,o,i){this.onFulfilled="function"==typeof l?l:null,this.onRejected="function"==typeof a?a:null,this.resolve=o,this.reject=i}function A(l,a,o){var i=!1;try{l(function(n){i||(i=!0,a(n))},function(n){i||(i=!0,o(n))})}catch(l){if(i){return}i=!0,o(l)}}if(window.Promise){return window.Promise}var u=z.immediateFn||"function"==typeof setImmediate&&setImmediate||function(a){setTimeout(a,1)},x=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};return z.prototype["catch"]=function(a){return this.then(null,a)},z.prototype.then=function(n,l){var a=this;return new z(function(e,i){q.call(a,new y(n,l,e,i))})},z.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&x(arguments[0])?arguments[0]:arguments);return new z(function(l,C){function s(t,i){try{if(i&&("object"==typeof i||"function"==typeof i)){var n=i.then;if("function"==typeof n){return void n.call(i,function(o){s(t,o)},C)}}r[t]=i,0===--e&&l(r)}catch(r){C(r)}}if(0===a.length){return l([])}for(var e=a.length,B=0;B<a.length;B++){s(B,a[B])}})},z.resolve=function(a){return a&&"object"==typeof a&&a.constructor===z?a:new z(function(e){e(a)})},z.reject=function(a){return new z(function(e,i){i(a)})},z.race=function(a){return new z(function(l,s){for(var o=0,e=a.length;o<e;o++){a[o].then(l,s)}})},z}),b("p",[],function(){function i(m){var l=document.createElement("a");return l.href=m,l.pathname}function a(l){var o=i(l).split("."),m=o[o.length-1],e={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"};return m&&(m=m.toLowerCase()),e[m]}return{guessMimeType:a}}),b("e",["o","m","p","n"],function(C,H,x,q){function A(a){return new C(function(i){function l(){a.removeEventListener("load",l),i(a)}a.complete?i(a):a.addEventListener("load",l)})}function w(a){return A(a).then(function(m){var o,l;return l=H.create(q.getWidth(m),q.getHeight(m)),o=H.get2dContext(l),o.drawImage(m,0,0),l})}function F(a){return A(a).then(function(l){var i=l.src;return 0===i.indexOf("blob:")?z(i):0===i.indexOf("data:")?E(i):w(l).then(function(m){return E(m.toDataURL(x.guessMimeType(i)))})})}function I(a){return new C(function(l){function m(){i.removeEventListener("load",m),l(i)}var i=new Image;i.addEventListener("load",m),i.src=URL.createObjectURL(a),i.complete&&m()})}function z(a){return new C(function(i){var l=new XMLHttpRequest;l.open("GET",a,!0),l.responseType="blob",l.onload=function(){200==this.status&&i(this.response)},l.send()})}function E(a){return new C(function(u){var K,t,m,J,l,p;if(a=a.split(","),J=/data:([^;]+)/.exec(a[0]),J&&(l=J[1]),K=atob(a[1]),window.WebKitBlobBuilder){for(p=new WebKitBlobBuilder,t=new ArrayBuffer(K.length),m=0;m<t.length;m++){t[m]=K.charCodeAt(m)}return p.append(t),void u(p.getBlob(l))}for(t=new Uint8Array(K.length),m=0;m<t.length;m++){t[m]=K.charCodeAt(m)}u(new Blob([t],{type:l}))})}function G(a){return 0===a.indexOf("blob:")?z(a):0===a.indexOf("data:")?E(a):null}function D(i,a){return E(i.toDataURL(a))}function B(a){return new C(function(i){var l=new FileReader;l.onloadend=function(){i(l.result)},l.readAsDataURL(a)})}function v(a){return B(a).then(function(i){return i.split(",")[1]})}function y(a){URL.revokeObjectURL(a.src)}return{blobToImage:I,imageToBlob:F,blobToDataUri:B,blobToBase64:v,imageToCanvas:w,canvasToBlob:D,revokeImageUrl:y,uriToBlob:G}}),b("q",[],function(){function x(i,a,l){return i=parseFloat(i),i>l?i=l:i<a&&(i=a),i}function C(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}function q(H,E){var J,G,u,I,l=[],F=new Array(10);for(J=0;J<5;J++){for(G=0;G<5;G++){l[G]=E[G+5*J]}for(G=0;G<5;G++){for(I=0,u=0;u<5;u++){I+=H[G+5*u]*l[u]}F[G+5*J]=I}}return F}function m(a,e){return e=x(e,0,1),a.map(function(i,l){return l%6===0?i=1-(1-i)*e:i*=e,x(i,0,1)})}function w(e,l){var a;return l=x(l,-1,1),l*=100,l<0?a=127+l/100*127:(a=l%1,a=0===a?y[l]:y[Math.floor(l)]*(1-a)+y[Math.floor(l)+1]*a,a=127*a+127),q(e,[a/127,0,0,0,0.5*(127-a),0,a/127,0,0,0.5*(127-a),0,0,a/127,0,0.5*(127-a),0,0,0,1,0,0,0,0,0,1])}function p(n,E){var l,F,e,u;return E=x(E,-1,1),l=1+(E>0?3*E:E),F=0.3086,e=0.6094,u=0.082,q(n,[F*(1-l)+l,e*(1-l),u*(1-l),0,0,F*(1-l),e*(1-l)+l,u*(1-l),0,0,F*(1-l),e*(1-l),u*(1-l)+l,0,0,0,0,0,1,0,0,0,0,0,1])}function A(E,G){var u,H,n,F,e;return G=x(G,-180,180)/180*Math.PI,u=Math.cos(G),H=Math.sin(G),n=0.213,F=0.715,e=0.072,q(E,[n+u*(1-n)+H*-n,F+u*-F+H*-F,e+u*-e+H*(1-e),0,0,n+u*-n+0.143*H,F+u*(1-F)+0.14*H,e+u*-e+H*-0.283,0,0,n+u*-n+H*-(1-n),F+u*-F+H*F,e+u*(1-e)+H*e,0,0,0,0,0,1,0,0,0,0,0,1])}function D(a,e){return e=x(255*e,-255,255),q(a,[1,0,0,0,e,0,1,0,0,e,0,0,1,0,e,0,0,0,1,0,0,0,0,0,1])}function v(e,l,a,n){return l=x(l,0,2),a=x(a,0,2),n=x(n,0,2),q(e,[l,0,0,0,0,0,a,0,0,0,0,0,n,0,0,0,0,0,1,0,0,0,0,0,1])}function z(e,a){return a=x(a,0,1),q(e,m([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],a))}function B(e,a){return a=x(a,0,1),q(e,m([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],a))}var y=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.2,0.21,0.22,0.24,0.25,0.27,0.28,0.3,0.32,0.34,0.36,0.38,0.4,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.8,0.83,0.86,0.89,0.92,0.95,0.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:C,adjust:m,multiply:q,adjustContrast:w,adjustBrightness:D,adjustSaturation:p,adjustHue:A,adjustColors:v,adjustSepia:z,adjustGrayscale:B}}),b("c",["m","n","e","q"],function(x,B,q,m){function w(e,a){return q.blobToImage(e).then(function(u){function D(ad,O){var V,R,Z,U,ah,P=ad.data,X=O[0],af=O[1],L=O[2],ae=O[3],ac=O[4],T=O[5],W=O[6],ab=O[7],aa=O[8],K=O[9],ag=O[10],H=O[11],I=O[12],Q=O[13],J=O[14],G=O[15],Y=O[16],F=O[17],ai=O[18],M=O[19];for(ah=0;ah<P.length;ah+=4){V=P[ah],R=P[ah+1],Z=P[ah+2],U=P[ah+3],P[ah]=V*X+R*af+Z*L+U*ae+ac,P[ah+1]=V*T+R*W+Z*ab+U*aa+K,P[ah+2]=V*ag+R*H+Z*I+U*Q+J,P[ah+3]=V*G+R*Y+Z*F+U*ai+M}return ad}var n,t=x.create(B.getWidth(u),B.getHeight(u)),i=x.get2dContext(t);return i.drawImage(u,0,0),A(u),n=D(i.getImageData(0,0,t.width,t.height),a),i.putImageData(n,0,0),q.canvasToBlob(t)})}function p(e,a){return q.blobToImage(e).then(function(u){function D(V,J,O){function L(o,l,r){return o>r?o=r:o<l&&(o=l),o}var R,N,Z,K,Q,X,I,W,U,M,P,T,S,H,Y,F,G;for(Z=Math.round(Math.sqrt(O.length)),K=Math.floor(Z/2),R=V.data,N=J.data,F=V.width,G=V.height,X=0;X<G;X++){for(Q=0;Q<F;Q++){for(I=W=U=0,P=0;P<Z;P++){for(M=0;M<Z;M++){T=L(Q+M-K,0,F-1),S=L(X+P-K,0,G-1),H=4*(S*F+T),Y=O[P*Z+M],I+=R[H]*Y,W+=R[H+1]*Y,U+=R[H+2]*Y}}H=4*(X*F+Q),N[H]=L(I,0,255),N[H+1]=L(W,0,255),N[H+2]=L(U,0,255)}}return J}var n,t,i=x.create(B.getWidth(u),B.getHeight(u)),E=x.get2dContext(i);return E.drawImage(u,0,0),A(u),n=E.getImageData(0,0,i.width,i.height),t=E.getImageData(0,0,i.width,i.height),t=D(n,t,a),E.putImageData(t,0,0),q.canvasToBlob(i)})}function z(a){return function(e,l){return q.blobToImage(e).then(function(r){function o(F,i){var G,s=F.data;for(G=0;G<s.length;G+=4){s[G]=i[s[G]],s[G+1]=i[s[G+1]],s[G+2]=i[s[G+2]]}return F}var t,n,E=x.create(B.getWidth(r),B.getHeight(r)),D=x.get2dContext(E),u=new Array(256);for(n=0;n<u.length;n++){u[n]=a(n,l)}return D.drawImage(r,0,0),A(r),t=o(D.getImageData(0,0,E.width,E.height),u),D.putImageData(t,0,0),q.canvasToBlob(E)})}}function C(a){return function(e,i){return w(e,a(m.identity(),i))}}function v(a){return function(e){return w(e,a)}}function y(a){return function(e){return p(e,a)}}var A=q.revokeImageUrl;return{invert:v([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:C(m.adjustBrightness),hue:C(m.adjustHue),saturate:C(m.adjustSaturation),contrast:C(m.adjustContrast),grayscale:C(m.adjustGrayscale),sepia:C(m.adjustSepia),colorize:function(i,a,r,l){return w(i,m.adjustColors(m.identity(),a,r,l))},sharpen:y([0,-1,0,-1,5,-1,0,-1,0]),emboss:y([-2,-1,0,-1,1,1,0,1,2]),gamma:z(function(i,a){return 255*Math.pow(i/255,1-a)}),exposure:z(function(i,a){return 255*(1-Math.exp(-(i/255)*a))}),colorFilter:w,convoluteFilter:p}}),b("r",["o","e","m","n"],function(p,l,s,m){function a(r,z,i){var x=m.getWidth(r),A=m.getHeight(r),o=z/x,w=i/A,y=!1;(o<0.5||o>2)&&(o=o<0.5?0.5:2,y=!0),(w<0.5||w>2)&&(w=w<0.5?0.5:2,y=!0);var v=q(r,o,w);return y?v.then(function(n){return a(n,z,i)}):v}function q(n,e,r){return new p(function(w){var o=m.getWidth(n),v=m.getHeight(n),i=Math.floor(o*e),y=Math.floor(v*r),t=s.create(i,y),x=s.get2dContext(t);x.drawImage(n,0,0,o,v,0,0,i,y),w(t)})}return{scale:a}}),b("d",["e","m","n","r"],function(w,z,q,m){function v(e,a){return w.blobToImage(e).then(function(r){var i=z.create(q.getWidth(r),q.getHeight(r)),n=z.get2dContext(i),t=0,l=0;return a=a<0?360+a:a,90!=a&&270!=a||z.resize(i,i.height,i.width),90!=a&&180!=a||(t=i.width),270!=a&&180!=a||(l=i.height),n.translate(t,l),n.rotate(a*Math.PI/180),n.drawImage(r,0,0),u(r),w.canvasToBlob(i,e.type)})}function p(e,a){return w.blobToImage(e).then(function(l){var n=z.create(q.getWidth(l),q.getHeight(l)),i=z.get2dContext(n);return"v"==a?(i.scale(1,-1),i.drawImage(l,0,-n.height)):(i.scale(-1,1),i.drawImage(l,-n.width,0)),u(l),w.canvasToBlob(n)})}function y(B,s,l,t,e){return w.blobToImage(B).then(function(o){var a=z.create(t,e),i=z.get2dContext(a);return i.drawImage(o,-s,-l),u(o),w.canvasToBlob(a)})}function A(e,l,a){return w.blobToImage(e).then(function(n){var i;return i=m.scale(n,l,a).then(function(o){return w.canvasToBlob(o,e.type)}).then(x(n))["catch"](x(n))})}var u=w.revokeImageUrl,x=function(a){return function(e){return u(a),e}};return{rotate:v,flip:p,crop:y,resize:A}}),b("7",["c","d"],function(J,x){var C=function(a){return J.invert(a)},z=function(a){return J.sharpen(a)},F=function(a){return J.emboss(a)},B=function(a,e){return J.gamma(a,e)},M=function(a,e){return J.exposure(a,e)},y=function(e,m,l,a){return J.colorize(e,m,l,a)},E=function(a,e){return J.brightness(a,e)},L=function(a,e){return J.hue(a,e)},w=function(a,e){return J.saturate(a,e)},K=function(a,e){return J.contrast(a,e)},I=function(a,e){return J.grayscale(a,e)},A=function(a,e){return J.sepia(a,e)},D=function(a,i){return x.flip(a,i)},H=function(m,s,l,a,p){return x.crop(m,s,l,a,p)},G=function(i,l,a){return x.resize(i,l,a)},q=function(a,i){return x.rotate(a,i)};return{invert:C,sharpen:z,emboss:F,brightness:E,hue:L,saturate:w,contrast:K,grayscale:I,sepia:A,colorize:y,gamma:B,exposure:M,flip:D,crop:H,resize:G,rotate:q}}),b("8",["e"],function(o){var l=function(e){return o.blobToImage(e)},p=function(e){return o.imageToBlob(e)},m=function(e){return o.blobToDataUri(e)},a=function(e){return o.blobToBase64(e)};return{blobToImage:l,imageToBlob:p,blobToDataUri:m,blobToBase64:a}}),f("f",tinymce.dom.DOMUtils),f("g",tinymce.ui.Factory),f("h",tinymce.ui.Form),f("i",tinymce.ui.Container),f("s",tinymce.ui.Control),f("t",tinymce.ui.DragHelper),f("u",tinymce.geom.Rect),f("w",tinymce.dom.DomQuery),f("x",tinymce.util.Observable),f("y",tinymce.util.VK),b("v",["w","t","u","5","x","y"],function(s,p,v,q,m,u){var l=0;return function(D,I,P,A,O){function M(x,w){return{x:w.x+x.x,y:w.y+x.y,w:w.w,h:w.h}}function G(x,w){return{x:w.x-x.x,y:w.y-x.y,w:w.w,h:w.h}}function H(){return G(P,D)}function L(E,T,w,C){var x,R,y,S,N;x=T.x,R=T.y,y=T.w,S=T.h,x+=w*E.deltaX,R+=C*E.deltaY,y+=w*E.deltaW,S+=C*E.deltaH,y<20&&(y=20),S<20&&(S=20),N=D=v.clamp({x:x,y:R,w:y,h:S},P,"move"==E.name),N=G(P,N),J.fire("updateRect",{rect:N}),F(N)}function K(){function w(x){var y;return new p(i,{document:A.ownerDocument,handle:i+"-"+x.name,start:function(){y=D},drag:function(C){L(x,y,C.deltaX,C.deltaY)}})}s('<div id="'+i+'" class="'+a+'croprect-container" role="grid" aria-dropeffect="execute">').appendTo(A),q.each(B,function(x){s("#"+i,A).append('<div id="'+i+"-"+x+'"class="'+a+'croprect-block" style="display: none" data-mce-bogus="all">')}),q.each(e,function(x){s("#"+i,A).append('<div id="'+i+"-"+x.name+'" class="'+a+"croprect-handle "+a+"croprect-handle-"+x.name+'"style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1" aria-label="'+x.label+'" aria-grabbed="false">')}),U=q.map(e,w),Q(D),s(A).on("focusin focusout",function(x){s(x.target).attr("aria-grabbed","focus"===x.type)}),s(A).on("keydown",function(y){function x(S,N,R,E,T){S.stopPropagation(),S.preventDefault(),L(C,R,E,T)}var C;switch(q.each(e,function(E){if(y.target.id==i+"-"+E.name){return C=E,!1}}),y.keyCode){case u.LEFT:x(y,C,D,-10,0);break;case u.RIGHT:x(y,C,D,10,0);break;case u.UP:x(y,C,D,0,-10);break;case u.DOWN:x(y,C,D,0,10);break;case u.ENTER:case u.SPACEBAR:y.preventDefault(),O()}})}function z(w){var x;x=q.map(e,function(y){return"#"+i+"-"+y.name}).concat(q.map(B,function(y){return"#"+i+"-"+y})).join(","),w?s(x,A).show():s(x,A).hide()}function Q(w){function x(y,C){C.h<0&&(C.h=0),C.w<0&&(C.w=0),s("#"+i+"-"+y,A).css({left:C.x,top:C.y,width:C.w,height:C.h})}q.each(e,function(y){s("#"+i+"-"+y.name,A).css({left:w.w*y.xMul+w.x,top:w.h*y.yMul+w.y})}),x("top",{x:I.x,y:I.y,w:I.w,h:w.y-I.y}),x("right",{x:w.x+w.w,y:w.y,w:I.w-w.x-w.w+I.x,h:w.h}),x("bottom",{x:I.x,y:w.y+w.h,w:I.w,h:I.h-w.y-w.h+I.y}),x("left",{x:I.x,y:w.y,w:w.x-I.x,h:w.h}),x("move",w)}function o(w){D=w,Q(D)}function r(w){I=w,Q(D)}function F(w){o(M(P,w))}function t(w){P=w,Q(D)}function n(){q.each(U,function(w){w.destroy()}),U=[]}var J,e,U,B,a="mce-",i=a+"crid-"+l++;return e=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}],B=["top","right","bottom","left"],K(A),J=q.extend({toggleVisibility:z,setClampRect:t,setRect:o,getInnerRect:H,setInnerRect:F,setViewPortRect:r,destroy:n},m)}}),b("j",["s","t","u","5","3","v"],function(s,p,v,q,m,u){function l(a){return new m(function(e){function i(){a.removeEventListener("load",i),e(a)}a.complete?e(a):a.addEventListener("load",i)})}return s.extend({Defaults:{classes:"imagepanel"},selection:function(a){return arguments.length?(this.state.set("rect",a),this):this.state.get("rect")},imageSize:function(){var a=this.state.get("viewRect");return{w:a.w,h:a.h}},toggleCropRect:function(a){this.state.set("cropEnabled",a)},imageSrc:function(n){var a=this,i=new Image;i.src=n,l(i).then(function(){var w,t,x=a.state.get("viewRect");if(t=a.$el.find("img"),t[0]){t.replaceWith(i)}else{var r=document.createElement("div");r.className="mce-imagepanel-bg",a.getEl().appendChild(r),a.getEl().appendChild(i)}w={x:0,y:0,w:i.naturalWidth,h:i.naturalHeight},a.state.set("viewRect",w),a.state.set("rect",v.inflate(w,-20,-20)),x&&x.w==w.w&&x.h==w.h||a.zoomFit(),a.repaintImage(),a.fire("load")})},zoom:function(a){return arguments.length?(this.state.set("zoom",a),this):this.state.get("zoom")},postRender:function(){return this.imageSrc(this.settings.imageSrc),this._super()},zoomFit:function(){var B,y,D,A,x,C,w,z=this;w=10,B=z.$el.find("img"),y=z.getEl().clientWidth,D=z.getEl().clientHeight,A=B[0].naturalWidth,x=B[0].naturalHeight,C=Math.min((y-w)/A,(D-w)/x),C>=1&&(C=1),z.zoom(C)},repaintImage:function(){var B,F,y,w,A,x,D,G,z,C,E;E=this.getEl(),z=this.zoom(),C=this.state.get("rect"),D=this.$el.find("img"),G=this.$el.find(".mce-imagepanel-bg"),A=E.offsetWidth,x=E.offsetHeight,y=D[0].naturalWidth*z,w=D[0].naturalHeight*z,B=Math.max(0,A/2-y/2),F=Math.max(0,x/2-w/2),D.css({left:B,top:F,width:y,height:w}),G.css({left:B,top:F,width:y,height:w}),this.cropRect&&(this.cropRect.setRect({x:C.x*z+B,y:C.y*z+F,w:C.w*z,h:C.h*z}),this.cropRect.setClampRect({x:B,y:F,w:y,h:w}),this.cropRect.setViewPortRect({x:0,y:0,w:A,h:x}))},bindStates:function(){function i(n){a.cropRect=new u(n,a.state.get("viewRect"),a.state.get("viewRect"),a.getEl(),function(){a.fire("crop")}),a.cropRect.on("updateRect",function(t){var w=t.rect,o=a.zoom();w={x:Math.round(w.x/o),y:Math.round(w.y/o),w:Math.round(w.w/o),h:Math.round(w.h/o)},a.state.set("rect",w)}),a.on("remove",a.cropRect.destroy)}var a=this;a.state.on("change:cropEnabled",function(n){a.cropRect.toggleVisibility(n.value),a.repaintImage()}),a.state.on("change:zoom",function(){a.repaintImage()}),a.state.on("change:rect",function(o){var e=o.value;a.cropRect||i(e),a.cropRect.setRect(e)})}})}),b("k",[],function(){return function(){function s(i){var a;return a=u.splice(++l),u.push(i),{state:i,removed:a}}function p(){if(q()){return u[--l]}}function v(){if(m()){return u[++l]}}function q(){return l>0}function m(){return l!=-1&&l<u.length-1}var u=[],l=-1;return{data:u,add:s,undo:p,redo:v,canUndo:q,canRedo:m}}}),b("9",["f","5","3","g","h","i","j","7","8","k"],function(C,H,x,q,A,w,F,I,z,E){function G(a){return{blob:a,url:URL.createObjectURL(a)}}function D(a){a&&URL.revokeObjectURL(a.url)}function B(a){H.each(a,D)}function v(aM,aO,aL){function aN(J){var m,K,p,l;m=ag.find("#w")[0],K=ag.find("#h")[0],p=parseInt(m.value(),10),l=parseInt(K.value(),10),ag.find("#constrain")[0].checked()&&ar&&ax&&p&&l&&("w"==J.control.settings.name?(l=Math.round(p*aB),K.value(l)):(p=Math.round(l*az),m.value(p))),ar=p,ax=l}function aS(l){return Math.round(100*l)+"%"}function aR(){ag.find("#undo").disabled(!aI.canUndo()),ag.find("#redo").disabled(!aI.canRedo()),ag.statusbar.find("#save").disabled(!aI.canUndo())}function aJ(){ag.find("#undo").disabled(!0),ag.find("#redo").disabled(!0)}function aT(l){l&&ay.imageSrc(l.url)}function aE(l){return function(){var m=H.grep(aC,function(n){return n.settings.name!=l});H.each(m,function(n){n.hide()}),l.show(),l.focus()}}function aG(l){aD=G(l),aT(aD)}function au(l){aM=G(l),aT(aM),B(aI.add(aM).removed),aR()}function aH(){var l=ay.selection();I.crop(aM.blob,l.x,l.y,l.w,l.h).then(function(m){au(m),ab()})}function ah(m){var l=[].slice.call(arguments,1);return function(){var n=aD||aM;m.apply(this,[n.blob].concat(l)).then(aG)}}function aP(m){var l=[].slice.call(arguments,1);return function(){m.apply(this,[aM.blob].concat(l)).then(au)}}function ab(){aT(aM),D(aD),aE(an)(),aR()}function aV(){aD&&(au(aD.blob),ab())}function aq(){var l=ay.zoom();l<2&&(l+=0.1),ay.zoom(l)}function aa(){var l=ay.zoom();l>0.1&&(l-=0.1),ay.zoom(l)}function ac(){aM=aI.undo(),aT(aM),aR()}function aw(){aM=aI.redo(),aT(aM),aR()}function av(){aO(aM.blob),ag.close()}function af(l){return new A({layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:l})}function at(m,l){return af([{text:"Back",onclick:ab},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:aV}]).hide().on("show",function(){aJ(),l(aM.blob).then(function(p){var n=G(p);aT(n),D(aD),aD=n})})}function ai(J,n,p,m,K){function l(L){n(aM.blob,L).then(function(N){var M=G(N);aT(M),D(aD),aD=M})}return af([{text:"Back",onclick:ab},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(L){l(L.value)},minValue:m,maxValue:K,value:p,previewFilter:aS},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:aV}]).hide().on("show",function(){this.find("slider").value(p),aJ()})}function aj(n,l){function m(){var K,J,p;K=ag.find("#r")[0].value(),J=ag.find("#g")[0].value(),p=ag.find("#b")[0].value(),l(aM.blob,K,J,p).then(function(M){var L=G(M);aT(L),D(aD),aD=L})}return af([{text:"Back",onclick:ab},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:m,previewFilter:aS},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:m,previewFilter:aS},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:m,previewFilter:aS},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:aV}]).hide().on("show",function(){ag.find("#r,#g,#b").value(1),aJ()})}function am(l){l.control.value()===!0&&(aB=ax/ar,az=ar/ax)}var ag,an,ap,aD,s,u,t,ay,aQ,aK,i,o,ak,ao,al,e,ad,aU,r,a,aF,aA,aC,ar,ax,aB,az,aI=new E;s=af([{text:"Back",onclick:ab},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:aH}]).hide().on("show hide",function(l){ay.toggleCropRect("show"==l.type)}).on("show",aJ),u=af([{text:"Back",onclick:ab},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:aN},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:aN},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:am},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(m){var l=parseInt(ag.find("#w").value(),10),p=parseInt(ag.find("#h").value(),10);m.preventDefault(),aP(I.resize,l,p)(),ab()}).on("show",aJ),t=af([{text:"Back",onclick:ab},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:ah(I.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:ah(I.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:ah(I.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:ah(I.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:aV}]).hide().on("show",aJ),i=at("Invert",I.invert),r=at("Sharpen",I.sharpen),a=at("Emboss",I.emboss),o=ai("Brightness",I.brightness,0,-1,1),ak=ai("Hue",I.hue,180,0,360),ao=ai("Saturate",I.saturate,0,-1,1),al=ai("Contrast",I.contrast,0,-1,1),e=ai("Grayscale",I.grayscale,0,0,1),ad=ai("Sepia",I.sepia,0,0,1),aU=aj("Colorize",I.colorize),aF=ai("Gamma",I.gamma,0,-1,1),aA=ai("Exposure",I.exposure,1,0,2),ap=af([{text:"Back",onclick:ab},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:aE(ak)},{text:"saturate",icon:"saturate",onclick:aE(ao)},{text:"sepia",icon:"sepia",onclick:aE(ad)},{text:"emboss",icon:"emboss",onclick:aE(a)},{text:"exposure",icon:"exposure",onclick:aE(aA)},{type:"spacer",flex:1}]).hide(),an=af([{tooltip:"Crop",icon:"crop",onclick:aE(s)},{tooltip:"Resize",icon:"resize2",onclick:aE(u)},{tooltip:"Orientation",icon:"orientation",onclick:aE(t)},{tooltip:"Brightness",icon:"sun",onclick:aE(o)},{tooltip:"Sharpen",icon:"sharpen",onclick:aE(r)},{tooltip:"Contrast",icon:"contrast",onclick:aE(al)},{tooltip:"Color levels",icon:"drop",onclick:aE(aU)},{tooltip:"Gamma",icon:"gamma",onclick:aE(aF)},{tooltip:"Invert",icon:"invert",onclick:aE(i)}]),ay=new F({flex:1,imageSrc:aM.url}),aQ=new w({layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:ac},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:aw},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:aq},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:aa}]}),aK=new w({type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[aQ,ay]}),aC=[an,s,u,t,ap,i,o,ak,ao,al,e,ad,aU,r,a,aF,aA],ag=q.create("window",{layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(C.DOM.getViewPort().w,800),minHeight:Math.min(C.DOM.getViewPort().h,650),title:"Edit image",items:aC.concat([aK]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:av},{text:"Cancel",onclick:"close"}]}),ag.renderTo(document.body).reflow(),ag.on("close",function(){aL(),B(aI.data),aI=null,aD=null}),aI.add(aM),aR(),ay.on("load",function(){ar=ay.imageSize().w,ax=ay.imageSize().h,aB=ax/ar,az=ar/ax,ag.find("#w").value(ar),ag.find("#h").value(ax)}),ay.on("crop",aH)}function y(a){return new x(function(e,i){v(G(a),e,i)})}return{edit:y}}),b("a",[],function(){function i(p){function m(n){return/^[0-9\.]+px$/.test(n)}var q,o;return q=p.style.width,o=p.style.height,q||o?m(q)&&m(o)?{w:parseInt(q,10),h:parseInt(o,10)}:null:(q=p.width,o=p.height,q&&o?{w:parseInt(q,10),h:parseInt(o,10)}:null)}function a(p,m){var q,o;m&&(q=p.style.width,o=p.style.height,(q||o)&&(p.style.width=m.w+"px",p.style.height=m.h+"px",p.removeAttribute("data-mce-style")),q=p.width,o=p.height,(q||o)&&(p.setAttribute("width",m.w),p.setAttribute("height",m.h)))}function l(m){return{w:m.naturalWidth,h:m.naturalHeight}}return{getImageSize:i,setImageSize:a,getNaturalImageSize:l}}),b("l",["3","5"],function(s,p){var v=function(a){return null!==a&&void 0!==a},q=function(n,a){var i;return i=a.reduce(function(r,o){return v(r)?r[o]:void 0},n),v(i)?i:null},m=function(e,a){return new s(function(o){var n;n=new XMLHttpRequest,n.onreadystatechange=function(){4===n.readyState&&o({status:n.status,blob:this.response})},n.open("GET",e,!0),p.each(a,function(r,i){n.setRequestHeader(i,r)}),n.responseType="blob",n.send()})},u=function(a){return new s(function(i){var o=new FileReader;o.onload=function(e){var r=e.target;i(r.result)},o.readAsText(a)})},l=function(i){var a;try{a=JSON.parse(i)}catch(i){}return a};return{traverse:q,readBlob:u,requestUrlAsBlob:m,parseJson:l}}),b("b",["3","5","l"],function(x,B,q){function m(a){return q.requestUrlAsBlob(a,{}).then(function(e){return e.status>=400?p(e.status):x.resolve(e.blob)})}var w=function(a){return 400===a||403===a||500===a},p=function(a){return x.reject("ImageProxy HTTP error: "+a)},z=function(a){x.reject("ImageProxy Service error: "+a)},C=function(i,a){return q.readBlob(a).then(function(o){var l=q.parseJson(o),n=q.traverse(l,["error","type"]);return z(n?n:"Invalid JSON")})},v=function(i,a){return w(i)?C(i,a):p(i)},y=function(a,e){return q.requestUrlAsBlob(a,{"Content-Type":"application/json;charset=UTF-8","tiny-api-key":e}).then(function(i){return i.status>=400?v(i.status,i.blob):x.resolve(i.blob)})},A=function(i,a){return a?y(i,a):m(i)};return{getUrl:A}}),b("0",["1","2","3","4","5","6","7","8","9","a","b"],function(x,C,q,m,w,p,A,D,v,z,B){var y=function(V){function W(e){V.notificationManager.open({text:e,type:"error"})}function U(){return V.selection.getNode()}function K(e){var E=e.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i);return E?V.dom.encode(E[1]):null}function L(){return"imagetools"+G++}function Q(e){var E=e.src;return 0===E.indexOf("data:")||0===E.indexOf("blob:")||new m(E).host===V.documentBaseURI.host}function O(e){return w.inArray(V.settings.imagetools_cors_hosts,new m(e.src).host)!==-1}function u(){return V.settings.api_key||V.settings.imagetools_api_key}function X(e){var N,E=e.src;return O(e)?B.getUrl(e.src,null):Q(e)?D.imageToBlob(e):(E=V.settings.imagetools_proxy,E+=(E.indexOf("?")===-1?"?":"&")+"url="+encodeURIComponent(e.src),N=u(),B.getUrl(E,N))}function r(){var e;return e=V.editorUpload.blobCache.getByUri(U().src),e?e.blob():X(U())}function s(){I=p.setEditorTimeout(V,function(){V.editorUpload.uploadImagesAuto()},V.settings.images_upload_timeout||30000)}function H(){clearTimeout(I)}function t(e,E){return D.blobToDataUri(e).then(function(S){var Z,P,T,N,aa,R;return R=U(),N=V.editorUpload.blobCache,aa=N.getByUri(R.src),T=m.parseDataUri(S).data,Z=L(),V.settings.images_reuse_filename&&(P=aa?aa.filename():K(R.src)),aa=N.create(Z,e,T,P),N.add(aa),V.undoManager.transact(function(){function ab(){V.$(R).off("load",ab),V.nodeChanged(),E?V.editorUpload.uploadImagesAuto():(H(),s())}V.$(R).on("load",ab),V.$(R).attr({src:aa.blobUri()}).removeAttr("data-mce-src")}),aa})}function o(e){return function(){return V._scanForImages().then(r).then(e).then(t,W)}}function M(E){return function(){return o(function(e){var N=z.getImageSize(U());return N&&z.setImageSize(U(),{w:N.h,h:N.w}),A.rotate(e,E)})()}}function i(E){return function(){return o(function(e){return A.flip(e,E)})()}}function Y(){var R=U(),N=z.getNaturalImageSize(R),P=function(e){return new q(function(S){D.blobToImage(e).then(function(T){var Z=z.getNaturalImageSize(T);N.w==Z.w&&N.h==Z.h||z.getImageSize(R)&&z.setImageSize(R,Z),URL.revokeObjectURL(T.src),S(e)})})},E=function(S){return v.edit(S).then(P).then(function(T){t(T,!0)},function(){})};R&&X(R).then(E,W)}function F(){V.addButton("rotateleft",{title:"Rotate counterclockwise",cmd:"mceImageRotateLeft"}),V.addButton("rotateright",{title:"Rotate clockwise",cmd:"mceImageRotateRight"}),V.addButton("flipv",{title:"Flip vertically",cmd:"mceImageFlipVertical"}),V.addButton("fliph",{title:"Flip horizontally",cmd:"mceImageFlipHorizontal"}),V.addButton("editimage",{title:"Edit image",cmd:"mceEditImage"}),V.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"})}function a(){V.on("NodeChange",function(e){n&&n.src!=e.element.src&&(H(),V.editorUpload.uploadImagesAuto(),n=void 0),l(e.element)&&(n=e.element)})}function l(e){var E=V.dom.is(e,"img:not([data-mce-object],[data-mce-placeholder])");return E&&(Q(e)||O(e)||V.settings.imagetools_proxy)}function J(){var e=V.settings.imagetools_toolbar;e||(e="rotateleft rotateright | flipv fliph | crop editimage imageoptions"),V.addContextToolbar(l,e)}var I,n,G=0;C.fileApi&&(w.each({mceImageRotateLeft:M(-90),mceImageRotateRight:M(90),mceImageFlipVertical:i("v"),mceImageFlipHorizontal:i("h"),mceEditImage:Y},function(e,E){V.addCommand(E,e)}),F(),J(),a())};return x.add("imagetools",y),function(){}}),g("0")()}();