tinymce._beforeUnloadHandler=function(){var b;return tinymce.each(tinymce.editors,function(a){a.plugins.autosave&&a.plugins.autosave.storeDraft(),!b&&a.isDirty()&&a.getParam("autosave_ask_before_unload",!0)&&(b=a.translate("You have unsaved changes are you sure you want to navigate away?"))}),b},tinymce.PluginManager.add("autosave",function(u){function d(h,b){var g={s:1000,m:60000};return h=/^(\d+)([ms]?)$/.exec(""+(h||b)),(h[2]?g[h[2]]:1)*parseInt(h,10)}function i(){var b=parseInt(n.getItem(o+"time"),10)||0;return !((new Date).getTime()-b>a.autosave_retention)||(r(!1),!1)}function r(b){n.removeItem(o+"draft"),n.removeItem(o+"time"),b!==!1&&u.fire("RemoveDraft")}function e(){!s()&&u.isDirty()&&(n.setItem(o+"draft",u.getContent({format:"raw",no_events:!0})),n.setItem(o+"time",(new Date).getTime()),u.fire("StoreDraft"))}function l(){i()&&(u.setContent(n.getItem(o+"draft"),{format:"raw"}),u.fire("RestoreDraft"))}function p(){t||(setInterval(function(){u.removed||e()},a.autosave_interval),t=!0)}function c(){var b=this;b.disabled(!i()),u.on("StoreDraft RestoreDraft RemoveDraft",function(){b.disabled(!i())}),p()}function f(){u.undoManager.beforeChange(),l(),r(),u.undoManager.add()}function s(b){var g=u.settings.forced_root_block;return b=tinymce.trim("undefined"==typeof b?u.getBody().innerHTML:b),""===b||new RegExp("^<"+g+"[^>]*>((\xa0|&nbsp;|[ \t]|<br[^>]*>)+?|)</"+g+">|<br>$","i").test(b)}var o,t,a=u.settings,n=tinymce.util.LocalStorage;o=a.autosave_prefix||"tinymce-autosave-{path}{query}-{id}-",o=o.replace(/\{path\}/g,document.location.pathname),o=o.replace(/\{query\}/g,document.location.search),o=o.replace(/\{id\}/g,u.id),a.autosave_interval=d(a.autosave_interval,"30s"),a.autosave_retention=d(a.autosave_retention,"20m"),u.addButton("restoredraft",{title:"Restore last draft",onclick:f,onPostRender:c}),u.addMenuItem("restoredraft",{text:"Restore last draft",onclick:f,onPostRender:c,context:"file"}),u.settings.autosave_restore_when_empty!==!1&&(u.on("init",function(){i()&&s()&&l()}),u.on("saveContent",function(){r()})),window.onbeforeunload=tinymce._beforeUnloadHandler,this.hasDraft=i,this.storeDraft=e,this.restoreDraft=l,this.removeDraft=r,this.isEmpty=s});