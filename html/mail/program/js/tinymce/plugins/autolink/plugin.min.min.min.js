tinymce.PluginManager.add("autolink",function(k){function m(b){n(b,-1,"(",!0)}function e(b){n(b,0,"",!0)}function l(b){n(b,-1,"",!1)}function n(c,I,u){function p(v,w){if(w<0&&(w=0),3==v.nodeType){var q=v.data.length;w>q&&(w=q)}return w}function o(q,v){1!=q.nodeType||q.hasChildNodes()?t.setStart(q,p(q,v)):t.setStartBefore(q)}function d(q,v){1!=q.nodeType||q.hasChildNodes()?t.setEnd(q,p(q,v)):t.setEndAfter(q)}var t,r,K,J,b,f,h,s,g,j;if("A"!=c.selection.getNode().tagName){if(t=c.selection.getRng(!0).cloneRange(),t.startOffset<5){if(s=t.endContainer.previousSibling,!s){if(!t.endContainer.firstChild||!t.endContainer.firstChild.nextSibling){return}s=t.endContainer.firstChild.nextSibling}if(g=s.length,o(s,g),d(s,g),t.endOffset<5){return}r=t.endOffset,J=s}else{if(J=t.endContainer,3!=J.nodeType&&J.firstChild){for(;3!=J.nodeType&&J.firstChild;){J=J.firstChild}3==J.nodeType&&(o(J,0),d(J,J.nodeValue.length))}r=1==t.endOffset?2:t.endOffset-1-I}K=r;do{o(J,r>=2?r-2:0),d(J,r>=1?r-1:0),r-=1,j=t.toString()}while(" "!=j&&""!==j&&160!=j.charCodeAt(0)&&r-2>=0&&j!=u);t.toString()==u||160==t.toString().charCodeAt(0)?(o(J,r),d(J,K),r+=1):0===t.startOffset?(o(J,0),d(J,K)):(o(J,r),d(J,K)),f=t.toString(),"."==f.charAt(f.length-1)&&d(J,K-1),f=t.toString(),h=f.match(a),h&&("www."==h[1]?h[1]="http://www.":/@$/.test(h[1])&&!/^mailto:/.test(h[1])&&(h[1]="mailto:"+h[1]),b=c.selection.getBookmark(),c.selection.setRng(t),c.execCommand("createlink",!1,h[1]+h[2]),c.settings.default_link_target&&c.dom.setAttrib(c.selection.getNode(),"target",c.settings.default_link_target),c.selection.moveToBookmark(b),c.nodeChanged())}}var i,a=/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i;return k.settings.autolink_pattern&&(a=k.settings.autolink_pattern),k.on("keydown",function(b){if(13==b.keyCode){return l(k)}}),tinymce.Env.ie?void k.on("focus",function(){if(!i){i=!0;try{b.execCommand("AutoUrlDetect",!1,!0)}catch(b){}}}):(k.on("keypress",function(b){if(41==b.keyCode){return m(k)}}),void k.on("keyup",function(b){if(32==b.keyCode){return e(k)}}))});