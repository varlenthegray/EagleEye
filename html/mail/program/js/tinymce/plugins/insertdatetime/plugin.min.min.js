tinymce.PluginManager.add("insertdatetime",function(j){function p(a,e){function c(l,i){if(l=""+l,l.length<i){for(var o=0;o<i-l.length;o++){l="0"+l}}return l}return e=e||new Date,a=a.replace("%D","%m/%d/%Y"),a=a.replace("%r","%I:%M:%S %p"),a=a.replace("%Y",""+e.getFullYear()),a=a.replace("%y",""+e.getYear()),a=a.replace("%m",c(e.getMonth()+1,2)),a=a.replace("%d",c(e.getDate(),2)),a=a.replace("%H",""+c(e.getHours(),2)),a=a.replace("%M",""+c(e.getMinutes(),2)),a=a.replace("%S",""+c(e.getSeconds(),2)),a=a.replace("%I",""+((e.getHours()+11)%12+1)),a=a.replace("%p",""+(e.getHours()<12?"AM":"PM")),a=a.replace("%B",""+j.translate(g[e.getMonth()])),a=a.replace("%b",""+j.translate(q[e.getMonth()])),a=a.replace("%A",""+j.translate(m[e.getDay()])),a=a.replace("%a",""+j.translate(d[e.getDay()])),a=a.replace("%%","%")}function f(l){var c=p(l);if(j.settings.insertdatetime_element){var a;a=p(/%[HMSIp]/.test(l)?"%Y-%m-%dT%H:%M":"%Y-%m-%d"),c='<time datetime="'+a+'">'+c+"</time>";var e=j.dom.getParent(j.selection.getStart(),"time");if(e){return void j.dom.setOuterHTML(e,c)}}j.insertContent(c)}var b,h,d="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),m="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),q="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),g="January February March April May June July August September October November December".split(" "),k=[];j.addCommand("mceInsertDate",function(){f(j.getParam("insertdatetime_dateformat",j.translate("%Y-%m-%d")))}),j.addCommand("mceInsertTime",function(){f(j.getParam("insertdatetime_timeformat",j.translate("%H:%M:%S")))}),j.addButton("insertdatetime",{type:"splitbutton",title:"Insert date/time",onclick:function(){f(b||h)},menu:k}),tinymce.each(j.settings.insertdatetime_formats||["%H:%M:%S","%Y-%m-%d","%I:%M:%S %p","%D"],function(a){h||(h=a),k.push({text:p(a),onclick:function(){b=a,f(a)}})}),j.addMenuItem("insertdatetime",{icon:"date",text:"Date/time",menu:k,context:"insert"})});