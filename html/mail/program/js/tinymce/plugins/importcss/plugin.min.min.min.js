tinymce.PluginManager.add("importcss",function(u){function d(g){var b=tinymce.Env.cacheSuffix;return"string"==typeof g&&(g=g.replace("?"+b,"").replace("&"+b,"")),g}function i(j){var g=u.settings,h=g.skin!==!1&&(g.skin||"lightgray");if(h){var b=g.skin_url;return b=b?u.documentBaseURI.toAbsolute(b):tinymce.baseURL+"/skins/"+h,j===b+"/content"+(u.inline?".inline":"")+".min.css"}return !1}function r(b){return"string"==typeof b?function(g){return g.indexOf(b)!==-1}:b instanceof RegExp?function(g){return b.test(g)}:b}function e(g,j){function b(v,w){var q,m=v.href;if(m=d(m),m&&j(m,w)&&!i(m)){n(v.imports,function(x){b(x,!0)});try{q=v.cssRules||v.rules}catch(v){}n(q,function(x){x.styleSheet?b(x.styleSheet,!0):x.selectorText&&n(x.selectorText.split(","),function(y){k.push(tinymce.trim(y))})})}}var k=[],h={};n(u.contentCSS,function(m){h[m]=!0}),j||(j=function(q,m){return m||h[q]});try{n(g.styleSheets,function(m){b(m)})}finally{}return k}function l(j){var h,g=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(j);if(g){var k=g[1],b=g[2].substr(1).split(".").join(" "),m=tinymce.makeMap("a,img");return g[1]?(h={title:j},u.schema.getTextBlockElements()[k]?h.block=k:u.schema.getBlockElements()[k]||m[k.toLowerCase()]?h.selector=k:h.inline=k):g[2]&&(h={inline:"span",title:j.substr(1),classes:b}),u.settings.importcss_merge_classes!==!1?h.classes=b:h.attributes={"class":b},h}}function p(g,b){return tinymce.util.Tools.grep(g,function(h){return !h.filter||h.filter(b)})}function c(b){return tinymce.util.Tools.map(b,function(g){return tinymce.util.Tools.extend({},g,{original:g,selectors:{},filter:r(g.filter),item:{text:g.title,menu:[]}})})}function f(g,b){return null===b||g.settings.importcss_exclusive!==!1}function s(b,g,h){return !(f(u,g)?b in h:b in g.selectors)}function o(b,g,h){f(u,g)?h[b]=!0:g.selectors[b]=!0}function t(h,b,g){var j,k=u.settings;return j=g&&g.selector_converter?g.selector_converter:k.importcss_selector_converter?k.importcss_selector_converter:l,j.call(h,b,g)}var a=this,n=tinymce.each;u.on("renderFormatsMenu",function(m){var k=u.settings,g={},q=r(k.importcss_selector_filter),b=m.control,h=c(k.importcss_groups),j=function(y,w){if(s(y,w,g)){o(y,w,g);var x=t(a,y,w);if(x){var v=x.name||tinymce.DOM.uniqueId();return u.formatter.register(v,x),tinymce.extend({},b.settings.itemDefaults,{text:x.title,format:v})}}return null};u.settings.importcss_append||b.items().remove(),n(e(m.doc||u.getDoc(),r(k.importcss_file_filter)),function(x){if(x.indexOf(".mce-")===-1&&(!q||q(x))){var v=p(h,x);if(v.length>0){tinymce.util.Tools.each(v,function(z){var y=j(x,z);y&&z.item.menu.push(y)})}else{var w=j(x,null);w&&b.add(w)}}}),n(h,function(v){v.item.menu.length>0&&b.add(v.item)}),m.control.renderNew()}),a.convertSelectorToFormat=l});