!function(){function b(d){return d&&1==d.nodeType&&"false"===d.contentEditable}function a(H,q,e,y,k){function E(g,d){if(d=d||0,!g[0]){throw"findAndReplaceDOMText cannot handle zero-length matches"}var h=g.index;if(d>0){var f=g[d];if(!f){throw"Invalid capture group"}h+=g[0].indexOf(f),g[0]=f}return[h,h+g[0].length,[g[0]]]}function I(d){var f;if(3===d.nodeType){return d.data}if(w[d.nodeName]&&!j[d.nodeName]){return""}if(f="",b(d)){return"\n"}if((j[d.nodeName]||A[d.nodeName])&&(f+="\n"),d=d.firstChild){do{f+=I(d)}while(d=d.nextSibling)}return f}function x(O,m,g){var v,h,M,P,p=[],L=0,N=O,K=m.shift(),J=0;b:for(;;){if((j[N.nodeName]||A[N.nodeName]||b(N))&&L++,3===N.nodeType&&(!h&&N.length+L>=K[1]?(h=N,P=K[1]-L):v&&p.push(N),!v&&N.length+L>K[0]&&(v=N,M=K[0]-L),L+=N.length),v&&h){if(N=g({startNode:v,startNodeIndex:M,endNode:h,endNodeIndex:P,innerNodes:p,match:K[2],matchIndex:J}),L-=h.length-P,v=null,h=null,p=[],K=m.shift(),J++,!K){break}}else{if(w[N.nodeName]&&!j[N.nodeName]||!N.firstChild){if(N.nextSibling){N=N.nextSibling;continue}}else{if(!b(N)){N=N.firstChild;continue}}}for(;;){if(N.nextSibling){N=N.nextSibling;break}if(N.parentNode===O){break b}N=N.parentNode}}}function D(f){var d;if("function"!=typeof f){var g=f.nodeType?f:B.createElement(f);d=function(l,h){var i=g.cloneNode(!1);return i.setAttribute("data-mce-index",h),l&&i.appendChild(B.createTextNode(l)),i}}else{d=f}return function(R){var L,t,O,K=R.startNode,U=R.endNode,X=R.matchIndex;if(K===U){var N=K;O=N.parentNode,R.startNodeIndex>0&&(L=B.createTextNode(N.data.substring(0,R.startNodeIndex)),O.insertBefore(L,N));var T=d(R.match[0],X);return O.insertBefore(T,N),R.endNodeIndex<N.length&&(t=B.createTextNode(N.data.substring(R.endNodeIndex)),O.insertBefore(t,N)),N.parentNode.removeChild(N),T}L=B.createTextNode(K.data.substring(0,R.startNodeIndex)),t=B.createTextNode(U.data.substring(R.endNodeIndex));for(var W=d(K.data.substring(R.startNodeIndex),X),S=[],J=0,M=R.innerNodes.length;J<M;++J){var Q=R.innerNodes[J],P=d(Q.data,X);Q.parentNode.replaceChild(P,Q),S.push(P)}var V=d(U.data.substring(0,R.endNodeIndex),X);return O=K.parentNode,O.insertBefore(L,K),O.insertBefore(W,K),O.removeChild(K),O=U.parentNode,O.insertBefore(V,U),O.insertBefore(t,U),O.removeChild(U),V}}var G,C,B,j,w,A,z=[],F=0;if(B=q.ownerDocument,j=k.getBlockElements(),w=k.getWhiteSpaceElements(),A=k.getShortEndedElements(),C=I(q)){if(H.global){for(;G=H.exec(C);){z.push(E(G,y))}}else{G=C.match(H),z.push(E(G,y))}return z.length&&(F=z.length,x(q,z,D(e))),F}}function c(m){function h(){function e(){s.statusbar.find("#next").disabled(!t(p+1).length),s.statusbar.find("#prev").disabled(!t(p-1).length)}function u(){m.windowManager.alert("Could not find the specified string.",function(){s.find("#find")[0].focus()})}var l,d={};l=tinymce.trim(m.selection.getContent({format:"text"}));var s=m.windowManager.open({layout:"flex",pack:"center",align:"center",onClose:function(){m.focus(),v.done()},onSubmit:function(x){var o,n,i,y;return x.preventDefault(),n=s.find("#case").checked(),y=s.find("#words").checked(),i=s.find("#find").value(),i.length?d.text==i&&d.caseState==n&&d.wholeWord==y?0===t(p+1).length?void u():(v.next(),void e()):(o=v.find(i,n,y),o||u(),s.statusbar.items().slice(1).disabled(0===o),e(),void (d={text:i,caseState:n,wholeWord:y})):(v.done(!1),void s.statusbar.items().slice(1).disabled(!0))},buttons:[{text:"Find",subtype:"primary",onclick:function(){s.submit()}},{text:"Replace",disabled:!0,onclick:function(){v.replace(s.find("#replace").value())||(s.statusbar.items().slice(1).disabled(!0),p=-1,d={})}},{text:"Replace all",disabled:!0,onclick:function(){v.replace(s.find("#replace").value(),!0,!0),s.statusbar.items().slice(1).disabled(!0),d={}}},{type:"spacer",flex:1},{text:"Prev",name:"prev",disabled:!0,onclick:function(){v.prev(),e()}},{text:"Next",name:"next",disabled:!0,onclick:function(){v.next(),e()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,items:[{type:"textbox",name:"find",size:40,label:"Find",value:l},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",label:" "}]}})}function f(i){var d=i.getAttribute("data-mce-index");return"number"==typeof d?""+d:d}function k(l){var e,d;return d=m.dom.create("span",{"data-mce-bogus":1}),d.className="mce-match-marker",e=m.getBody(),v.done(!1),a(l,e,d,!1,m.schema)}function g(i){var d=i.parentNode;i.firstChild&&d.insertBefore(i.firstChild,i),i.parentNode.removeChild(i)}function t(l){var s,e=[];if(s=tinymce.toArray(m.getBody().getElementsByTagName("span")),s.length){for(var r=0;r<s.length;r++){var d=f(s[r]);null!==d&&d.length&&d===l.toString()&&e.push(s[r])}}return e}function w(e){var o=p,l=m.dom;e=e!==!1,e?o++:o--,l.removeClass(t(p),"mce-match-marker-selected");var d=t(o);return d.length?(l.addClass(t(o),"mce-match-marker-selected"),m.selection.scrollIntoView(d[0]),o):-1}function j(d){var i=m.dom,e=d.parentNode;i.remove(d),i.isEmpty(e)&&i.remove(e)}function q(i){var d=f(i);return null!==d&&d.length>0}var v=this,p=-1;v.init=function(d){d.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Meta+F",onclick:h,separator:"before",context:"edit"}),d.addButton("searchreplace",{tooltip:"Find and replace",shortcut:"Meta+F",onclick:h}),d.addCommand("SearchReplace",h),d.shortcuts.add("Meta+F","",h)},v.find=function(l,d,o){l=l.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),l=o?"\\b"+l+"\\b":l;var i=k(new RegExp(l,d?"g":"gi"));return i&&(p=-1,p=w(!0)),i},v.next=function(){var d=w(!0);d!==-1&&(p=d)},v.prev=function(){var d=w(!1);d!==-1&&(p=d)},v.replace=function(A,e,o){var B,x,d,l,u,r,z=p;for(e=e!==!1,d=m.getBody(),x=tinymce.grep(tinymce.toArray(d.getElementsByTagName("span")),q),B=0;B<x.length;B++){var y=f(x[B]);if(l=u=parseInt(y,10),o||l===p){for(A.length?(x[B].firstChild.nodeValue=A,g(x[B])):j(x[B]);x[++B];){if(l=parseInt(f(x[B]),10),l!==u){B--;break}j(x[B])}e&&z--}else{u>p&&x[B].setAttribute("data-mce-index",u-1)}}return m.undoManager.add(),p=z,e?(r=t(z+1).length>0,v.next()):(r=t(z-1).length>0,v.prev()),!o&&r},v.done=function(r){var y,o,e,u;for(o=tinymce.toArray(m.getBody().getElementsByTagName("span")),y=0;y<o.length;y++){var d=f(o[y]);null!==d&&d.length&&(d===p.toString()&&(e||(e=o[y].firstChild),u=o[y].firstChild),g(o[y]))}if(e&&u){var x=m.dom.createRng();return x.setStart(e,0),x.setEnd(u,u.data.length),r!==!1&&m.selection.setRng(x),x}}}tinymce.PluginManager.add("searchreplace",c)}();