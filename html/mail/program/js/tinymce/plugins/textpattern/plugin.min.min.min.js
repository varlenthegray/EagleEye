tinymce.PluginManager.add("textpattern",function(l){function c(){return i&&(o.sort(function(d,b){return d.start.length>b.start.length?-1:d.start.length<b.start.length?1:0}),i=!1),o}function r(f){for(var d=c(),b=0;b<d.length;b++){if(0===f.indexOf(d[b].start)&&(!d[b].end||f.lastIndexOf(d[b].end)==f.length-d[b].end.length)){return d[b]}}}function t(g,d,h){var b,f,j;for(b=c(),j=0;j<b.length;j++){if(f=b[j],f.end&&g.substr(d-f.end.length-h,f.end.length)==f.end){return f}}}function n(d){function u(){F=F.splitText(f),F.splitText(h-f-b),F.deleteData(0,k.start.length),F.deleteData(F.data.length-k.end.length,k.end.length)}var j,g,G,F,h,f,m,p,k,b,q;if(j=l.selection,g=l.dom,j.isCollapsed()&&(G=j.getRng(!0),F=G.startContainer,h=G.startOffset,m=F.data,b=d?1:0,3==F.nodeType&&(k=t(m,h,b),k&&(f=Math.max(0,h-b),f=m.lastIndexOf(k.start,f-k.end.length-1),f!==-1&&(p=g.createRng(),p.setStart(F,f),p.setEnd(F,h-b),k=r(p.toString()),k&&k.end&&!(F.data.length<=k.start.length+k.end.length)))))){return q=l.formatter.get(k.format),q&&q[0].inline?(u(),l.formatter.apply(k.format,{},F),F):void 0}}function s(){var d,j,q,h,g,b,u,k,f,m,p;if(d=l.selection,j=l.dom,d.isCollapsed()&&(u=j.getParent(d.getStart(),"p"))){for(f=new tinymce.dom.TreeWalker(u,u);g=f.next();){if(3==g.nodeType){h=g;break}}if(h){if(k=r(h.data),!k){return}if(m=d.getRng(!0),q=m.startContainer,p=m.startOffset,h==q&&(p=Math.max(0,p-k.start.length)),tinymce.trim(h.data).length==k.start.length){return}k.format&&(b=l.formatter.get(k.format),b&&b[0].block&&(h.deleteData(0,k.start.length),l.formatter.apply(k.format,{},h),m.setStart(q,p),m.collapse(!0),d.setRng(m))),k.cmd&&l.undoManager.transact(function(){h.deleteData(0,k.start.length),l.execCommand(k.cmd)})}}}function e(){var b,d;d=n(),d&&(b=l.dom.createRng(),b.setStart(d,d.data.length),b.setEnd(d,d.data.length),l.selection.setRng(b)),s()}function a(){var g,f,d,b,h;g=n(!0),g&&(h=l.dom,f=g.data.slice(-1),/[\u00a0 ]/.test(f)&&(g.deleteData(g.data.length-1,1),d=h.doc.createTextNode(f),g.nextSibling?h.insertAfter(d,g.nextSibling):g.parentNode.appendChild(d),b=h.createRng(),b.setStart(d,1),b.setEnd(d,1),l.selection.setRng(b)))}var o,i=!0;o=l.settings.textpattern_patterns||[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],l.on("keydown",function(b){13!=b.keyCode||tinymce.util.VK.modifierPressed(b)||e()},!0),l.on("keyup",function(b){32!=b.keyCode||tinymce.util.VK.modifierPressed(b)||a()}),this.getPatterns=c,this.setPatterns=function(b){o=b,i=!0}});