tinymce.PluginManager.add("visualchars",function(i){function e(d){function m(k){return'<span data-mce-bogus="1" class="mce-'+o[k]+'">'+k+"</span>"}function n(){var k,q="";for(k in o){q+=k}return new RegExp("["+q+"]","g")}function p(){var k,q="";for(k in o){q&&(q+=","),q+="span.mce-"+o[k]}return q}var b,c,s,f,t,u,o,l,D=i.getBody(),a=i.selection;if(o={"\xa0":"nbsp","\xad":"shy"},j=!j,g.state=j,i.fire("VisualChars",{state:j}),l=n(),d&&(u=a.getBookmark()),j){for(c=[],tinymce.walk(D,function(k){3==k.nodeType&&k.nodeValue&&l.test(k.nodeValue)&&c.push(k)},"childNodes"),s=0;s<c.length;s++){for(f=c[s].nodeValue,f=f.replace(l,m),t=i.dom.create("div",null,f);b=t.lastChild;){i.dom.insertAfter(b,c[s])}i.dom.remove(c[s])}}else{for(c=i.dom.select(p(),D),s=c.length-1;s>=0;s--){i.dom.remove(c[s],1)}}a.moveToBookmark(u)}function h(){var a=this;i.on("VisualChars",function(b){a.active(b.state)})}var j,g=this;i.addCommand("mceVisualChars",e),i.addButton("visualchars",{title:"Show invisible characters",cmd:"mceVisualChars",onPostRender:h}),i.addMenuItem("visualchars",{text:"Show invisible characters",cmd:"mceVisualChars",onPostRender:h,selectable:!0,context:"view",prependToContext:!0})});