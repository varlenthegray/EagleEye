tinymce.PluginManager.add("visualchars",function(d){function b(B){function j(g){return'<span data-mce-bogus="1" class="mce-'+e[g]+'">'+g+"</span>"}function i(){var h,g="";for(h in e){g+=h}return new RegExp("["+g+"]","g")}function z(){var h,g="";for(h in e){g&&(g+=","),g+="span.mce-"+e[h]}return g}var C,q,y,A,x,w,e,k,v=d.getBody(),r=d.selection;if(e={"\xa0":"nbsp","\xad":"shy"},c=!c,a.state=c,d.fire("VisualChars",{state:c}),k=i(),B&&(w=r.getBookmark()),c){for(q=[],tinymce.walk(v,function(g){3==g.nodeType&&g.nodeValue&&k.test(g.nodeValue)&&q.push(g)},"childNodes"),y=0;y<q.length;y++){for(A=q[y].nodeValue,A=A.replace(k,j),x=d.dom.create("div",null,A);C=x.lastChild;){d.dom.insertAfter(C,q[y])}d.dom.remove(q[y])}}else{for(q=d.dom.select(z(),v),y=q.length-1;y>=0;y--){d.dom.remove(q[y],1)}}r.moveToBookmark(w)}function f(){var e=this;d.on("VisualChars",function(g){e.active(g.state)})}var c,a=this;d.addCommand("mceVisualChars",b),d.addButton("visualchars",{title:"Show invisible characters",cmd:"mceVisualChars",onPostRender:f}),d.addMenuItem("visualchars",{text:"Show invisible characters",cmd:"mceVisualChars",onPostRender:f,selectable:!0,context:"view",prependToContext:!0})});