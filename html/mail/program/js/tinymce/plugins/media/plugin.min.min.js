!function(){var h={},d=function(q){for(var w=h[q],p=w.deps,u=w.defn,m=p.length,r=new Array(m),e=0;e<m;++e){r[e]=g(p[e])}var v=u.apply(null,r);if(void 0===v){throw"module ["+q+"] returned undefined"}w.instance=v},k=function(a,i,e){if("string"!=typeof a){throw"module id must be a string"}if(void 0===i){throw"no dependencies for "+a}if(void 0===e){throw"no definition function for "+a}h[a]={deps:i,defn:e,instance:void 0}},g=function(e){var a=h[e];if(void 0===a){throw"module ["+e+"] was undefined"}return void 0===a.instance&&d(e),a.instance},c=function(m,l){for(var q=m.length,a=new Array(q),p=0;p<q;++p){a[p]=g(m[p])}l.apply(null,a)},j={};j.bolt={module:{api:{define:k,require:c,demand:g}}};var b=k,f=function(i,a){b(i,[],function(){return a})};f("1",tinymce.PluginManager),f("6",tinymce.util.Delay),f("e",tinymce.util.Tools),f("9",tinymce.html.SaxParser),f("a",tinymce.html.Schema),f("b",tinymce.dom.DOMUtils.DOM),b("h",[],function(){var a=function(l,i){if(l){for(var m=0;m<l.length;m++){if(i.indexOf(l[m].filter)!==-1){return l[m]}}}};return{getVideoScriptMatch:a}}),b("c",[],function(){var l=function(n){return n.replace(/px$/,"")},a=function(n){return/^[0-9.]+$/.test(n)?n+"px":n},m=function(e){return function(o){return o?l(o.style[e]):""}},i=function(n){return function(o,e){o&&(o.style[n]=a(e))}};return{getMaxWidth:m("maxWidth"),getMaxHeight:m("maxHeight"),setMaxWidth:i("maxWidth"),setMaxHeight:i("maxHeight")}}),b("7",["e","9","a","b","h","c"],function(x,B,q,m,w,p){var z=function(a){return m.getAttrib(a,"data-ephox-embed-iri")},C=function(i){var a=m.createFragment(i);return""!==z(a.firstChild)},v=function(i,a){var e={};return new B({validate:!1,allow_conditional_comments:!0,special:"script,noscript",start:function(n,o){if(e.source1||"param"!==n||(e.source1=o.map.movie),"iframe"!==n&&"object"!==n&&"embed"!==n&&"video"!==n&&"audio"!==n||(e.type||(e.type=n),e=x.extend(o.map,e)),"script"===n){var l=w.getVideoScriptMatch(i,o.map.src);if(!l){return}e={type:"script",source1:o.map.src,width:l.width,height:l.height}}"source"===n&&(e.source1?e.source2||(e.source2=o.map.src):e.source1=o.map.src),"img"!==n||e.poster||(e.poster=o.map.src)}}).parse(a),e.source1=e.source1||e.src||e.data,e.source2=e.source2||"",e.poster=e.poster||"",e},y=function(i){var a=m.createFragment(i),l=a.firstChild;return{type:"ephox-embed-iri",source1:z(l),source2:"",poster:"",width:p.getMaxWidth(l),height:p.getMaxHeight(l)}},A=function(i,a){return C(a)?y(a):v(i,a)};return{htmlToData:A}}),f("8",tinymce.html.Writer),b("4",["8","9","a","b","c"],function(x,B,q,m,w){var p=function(u,l){var E,s,a,D;for(E in l){if(a=""+l[E],u.map[E]){for(s=u.length;s--;){D=u[s],D.name===E&&(a?(u.map[E]=a,D.value=a):(delete u.map[E],u.splice(s,1)))}}else{a&&(u.push({name:E,value:a}),u.map[E]=a)}}},z=function(l){var e=new x,a=new B(e);return a.parse(l),e.getContent()},C=function(u,o,n){var t,e=new x,D=0;return new B({validate:!1,allow_conditional_comments:!0,special:"script,noscript",comment:function(a){e.comment(a)},cdata:function(a){e.cdata(a)},text:function(i,a){e.text(i,a)},start:function(i,a,l){switch(i){case"video":case"object":case"embed":case"img":case"iframe":p(a,{width:o.width,height:o.height})}if(n){switch(i){case"video":p(a,{poster:o.poster,src:""}),o.source2&&p(a,{src:""});break;case"iframe":p(a,{src:o.source1});break;case"source":if(D++,D<=2&&(p(a,{src:o["source"+D],type:o["source"+D+"mime"]}),!o["source"+D])){return}break;case"img":if(!o.poster){return}t=!0}}e.start(i,a,l)},end:function(l){if("video"===l&&n){for(var a=1;a<=2;a++){if(o["source"+a]){var s=[];s.map={},D<a&&(p(s,{src:o["source"+a],type:o["source"+a+"mime"]}),e.start("source",s,!0))}}}if(o.poster&&"object"===l&&n&&!t){var i=[];i.map={},p(i,{src:o.poster,width:o.width,height:o.height}),e.start("img",i,!0)}e.end(l)}},new q({})).parse(u),e.getContent()},v=function(i){var a=m.createFragment(i);return""!==m.getAttrib(a.firstChild,"data-ephox-embed-iri")},y=function(i,a){var r=m.createFragment(i),l=r.firstChild;return w.setMaxWidth(l,a.width),w.setMaxHeight(l,a.height),z(l.outerHTML)},A=function(i,a,l){return v(i)?y(i,a):C(i,a,l)};return{updateHtml:A}}),b("l",[],function(){var a=function(m){var i={mp3:"audio/mpeg",wav:"audio/wav",mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",swf:"application/x-shockwave-flash"},o=m.toLowerCase().split(".").pop(),l=i[o];return l?l:""};return{guess:a}}),b("m",[],function(){var a=[{regex:/youtu\.be\/([\w\-.]+)/,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/youtube\.com(.+)v=([^&]+)/,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$2",allowFullscreen:!0},{regex:/youtube.com\/embed\/([a-z0-9\-_]+(?:\?.+)?)/i,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowfullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$2?title=0&amp;byline=0",allowfullscreen:!0},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'//maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:!1},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"//www.dailymotion.com/embed/video/$1",allowFullscreen:!0}];return{urlPatterns:a}}),b("j",["l","7","m","h","4","e"],function(s,p,v,q,m,u){var l=function(i,o){var e="",t=u.extend({},o);if(!t.source1&&(u.extend(t,p.htmlToData(i.settings.media_scripts,t.embed)),!t.source1)){return""}if(t.source2||(t.source2=""),t.poster||(t.poster=""),t.source1=i.convertURL(t.source1,"source"),t.source2=i.convertURL(t.source2,"source"),t.source1mime=s.guess(t.source1),t.source2mime=s.guess(t.source2),t.poster=i.convertURL(t.poster,"poster"),u.each(v.urlPatterns,function(x){var a,y,w=x.regex.exec(t.source1);if(w){for(y=x.url,a=0;w[a];a++){y=y.replace("$"+a,function(){return w[a]})}t.source1=y,t.type=x.type,t.allowFullscreen=x.allowFullscreen,t.width=t.width||x.w,t.height=t.height||x.h}}),t.embed){e=m.updateHtml(t.embed,t,!0)}else{var n=q.getVideoScriptMatch(i.settings.media_scripts,t.source1);if(n&&(t.type="script",t.width=n.width,t.height=n.height),t.width=t.width||300,t.height=t.height||150,u.each(t,function(w,a){t[a]=i.dom.encode(w)}),"iframe"===t.type){var r=t.allowFullscreen?' allowFullscreen="1"':"";e+='<iframe src="'+t.source1+'" width="'+t.width+'" height="'+t.height+'"'+r+"></iframe>"}else{"application/x-shockwave-flash"===t.source1mime?(e+='<object data="'+t.source1+'" width="'+t.width+'" height="'+t.height+'" type="application/x-shockwave-flash">',t.poster&&(e+='<img src="'+t.poster+'" width="'+t.width+'" height="'+t.height+'" />'),e+="</object>"):t.source1mime.indexOf("audio")!==-1?i.settings.audio_template_callback?e=i.settings.audio_template_callback(t):e+='<audio controls="controls" src="'+t.source1+'">'+(t.source2?'\n<source src="'+t.source2+'"'+(t.source2mime?' type="'+t.source2mime+'"':"")+" />\n":"")+"</audio>":"script"===t.type?e+='<script src="'+t.source1+'"><\/script>':e=i.settings.video_template_callback?i.settings.video_template_callback(t):'<video width="'+t.width+'" height="'+t.height+'"'+(t.poster?' poster="'+t.poster+'"':"")+' controls="controls">\n<source src="'+t.source1+'"'+(t.source1mime?' type="'+t.source1mime+'"':"")+" />\n"+(t.source2?'<source src="'+t.source2+'"'+(t.source2mime?' type="'+t.source2mime+'"':"")+" />\n":"")+"</video>"}}return e};return{dataToHtml:l}}),f("k",tinymce.util.Promise),b("d",["j","k"],function(p,l){var s=function(u,v,t){var o={};return new l(function(i,n){var e=function(w){return w.html&&(o[u.source1]=w),i({url:u.source1,html:w.html?w.html:v(u)})};o[u.source1]?e(o[u.source1]):t({url:u.source1},e,n)})},m=function(i,o){return new l(function(e){e({html:o(i),url:i.source1})})},a=function(e){return function(i){return p.dataToHtml(e,i)}},q=function(n,i){var r=n.settings.media_url_resolver;return r?s(i,a(n),r):m(i,a(n))};return{getEmbedHtml:q}}),f("f",tinymce.Env),b("g",[],function(){var p=function(n,i){n.state.set("oldVal",n.value()),i.state.set("oldVal",i.value())},l=function(w,u){var x=w.find("#width")[0],v=w.find("#height")[0],o=w.find("#constrain")[0];x&&v&&o&&u(x,v,o.checked())},s=function(v,z,x){var u=v.state.get("oldVal"),y=z.state.get("oldVal"),e=v.value(),w=z.value();x&&u&&y&&e&&w&&(e!==u?(w=Math.round(e/u*w),isNaN(w)||z.value(w)):(e=Math.round(w/y*e),isNaN(e)||v.value(e))),p(v,z)},m=function(e){l(e,p)},a=function(i){l(i,s)},q=function(n){var i=function(){n(function(o){a(o)})};return{type:"container",label:"Dimensions",layout:"flex",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:5,onchange:i,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:5,onchange:i,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}};return{createUi:q,syncSize:m,updateSize:a}}),b("2",["6","7","4","d","c","e","f","g"],function(J,x,C,z,F,B,M,y){var E=M.ie&&M.ie<=8?"onChange":"onInput",L=function(a){return function(e){var i=e&&e.msg?"Media embed handler error: "+e.msg:"Media embed handler threw unknown error.";a.notificationManager.open({type:"error",text:i})}},w=function(i){var l=i.selection.getNode(),a=l.getAttribute("data-ephox-embed-iri");return a?{source1:a,"data-ephox-embed-iri":a,width:F.getMaxWidth(l),height:F.getMaxHeight(l)}:l.getAttribute("data-mce-object")?x.htmlToData(i.settings.media_scripts,i.serializer.serialize(l,{selection:!0})):{}},K=function(i){var a=i.selection.getNode();if(a.getAttribute("data-mce-object")||a.getAttribute("data-ephox-embed-iri")){return i.selection.getContent()}},I=function(a,i){return function(o){var n=o.html,m=a.find("#embed")[0],e=B.extend(x.htmlToData(i.settings.media_scripts,n),{source1:o.url});a.fromJSON(e),m&&(m.value(n),y.updateSize(a))}},A=function(o,l){var p,m,a=o.dom.select("img[data-mce-object]");for(p=0;p<l.length;p++){for(m=a.length-1;m>=0;m--){l[p]===a[m]&&a.splice(m,1)}}o.selection.select(a[0])},D=function(i,a){var l=i.dom.select("img[data-mce-object]");i.insertContent(a),A(i,l),i.nodeChanged()},H=function(m,l){var a=m.toJSON();a.embed=C.updateHtml(a.embed,a),a.embed?D(l,a.embed):z.getEmbedHtml(l,a).then(function(i){D(l,i.html)})["catch"](L(l))},G=function(i,a){B.each(a,function(e,l){i.find("#"+l).value(e)})},q=function(r){var o,N,l=[{name:"source1",type:"filepicker",filetype:"media",size:40,autofocus:!0,label:"Source",onpaste:function(){setTimeout(function(){z.getEmbedHtml(r,o.toJSON()).then(I(o,r))["catch"](L(r))},1)},onchange:function(a){z.getEmbedHtml(r,o.toJSON()).then(I(o,r))["catch"](L(r)),G(o,a.meta)},onbeforecall:function(a){a.meta=o.toJSON()}}],n=[],O=function(a){a(o),N=o.toJSON(),o.find("#embed").value(C.updateHtml(N.embed,N))};if(r.settings.media_alt_source!==!1&&n.push({name:"source2",type:"filepicker",filetype:"media",size:40,label:"Alternative source"}),r.settings.media_poster!==!1&&n.push({name:"poster",type:"filepicker",filetype:"image",size:40,label:"Poster"}),r.settings.media_dimensions!==!1){var t=y.createUi(O);l.push(t)}N=w(r);var s={id:"mcemediasource",type:"textbox",flex:1,name:"embed",value:K(r),multiline:!0,rows:5,label:"Source"},u=function(){N=B.extend({},x.htmlToData(r.settings.media_scripts,this.value())),this.parent().parent().fromJSON(N)};s[E]=u,o=r.windowManager.open({title:"Insert/edit media",data:N,bodyType:"tabpanel",body:[{title:"General",type:"form",items:l},{title:"Embed",type:"container",layout:"flex",direction:"column",align:"stretch",padding:10,spacing:10,items:[{type:"label",text:"Paste your embed code below:",forId:"mcemediasource"},s]},{title:"Advanced",type:"form",items:n}],onSubmit:function(){y.updateSize(o),H(o,r)}}),y.syncSize(o)};return{showDialog:q}}),b("3",["e","8","9","a"],function(o,l,p,m){var a=function(r,q){if(r.settings.media_filter_html===!1){return q}var s,n=new l;return new p({validate:!1,allow_conditional_comments:!1,special:"script,noscript",comment:function(i){n.comment(i)},cdata:function(i){n.cdata(i)},text:function(u,i){n.text(u,i)},start:function(u,w,v){if(s=!0,"script"!==u&&"noscript"!==u){for(var e=0;e<w.length;e++){if(0===w[e].name.indexOf("on")){return}"style"===w[e].name&&(w[e].value=r.dom.serializeStyle(r.dom.parseStyle(w[e].value),u))}n.start(u,w,v),s=!1}},end:function(i){s||n.end(i)}},new m({})).parse(q),n.getContent()};return{sanitize:a}}),f("i",tinymce.html.Node),b("5",["3","h","i","f"],function(w,y,q,m){var v=function(n,l){var a,r=l.name;return a=new q("img",1),a.shortEnded=!0,x(n,l,a),a.attr({width:l.attr("width")||"300",height:l.attr("height")||("audio"===r?"30":"150"),style:l.attr("style"),src:m.transparentSrc,"data-mce-object":r,"class":"mce-object mce-object-"+r}),a},p=function(B,l){var A,a,C,n=l.name;return A=new q("span",1),A.attr({contentEditable:"false",style:l.attr("style"),"data-mce-object":n,"class":"mce-preview-object mce-object-"+n}),x(B,l,A),a=new q(n,1),a.attr({src:l.attr("src"),allowfullscreen:l.attr("allowfullscreen"),width:l.attr("width")||"300",height:l.attr("height")||("audio"===n?"30":"150"),frameborder:"0"}),C=new q("span",1),C.attr("class","mce-shim"),A.append(a),A.append(C),A},x=function(C,G,E){var B,F,A,D,e;for(A=G.attributes,D=A.length;D--;){B=A[D].name,F=A[D].value,"width"!==B&&"height"!==B&&"style"!==B&&("data"!==B&&"src"!==B||(F=C.convertURL(F,B)),E.attr("data-mce-p-"+B,F))}e=G.firstChild&&G.firstChild.value,e&&(E.attr("data-mce-html",escape(w.sanitize(C,e))),E.firstChild=null)},z=function(a){for(;a=a.parent;){if(a.attr("data-ephox-embed-iri")){return !0}}return !1},u=function(a){return function(r){for(var i,e,o=r.length;o--;){i=r[o],i.parent&&(i.parent.attr("data-mce-object")||("script"!==i.name||(e=y.getVideoScriptMatch(a.settings.media_scripts,i.attr("src"))))&&(e&&(e.width&&i.attr("width",e.width.toString()),e.height&&i.attr("height",e.height.toString())),"iframe"===i.name&&a.settings.media_live_embeds!==!1&&m.ceFalse?z(i)||i.replace(p(a,i)):z(i)||i.replace(v(a,i))))}}};return{createPreviewIframeNode:p,createPlaceholderNode:v,placeHolderConverter:u}}),b("0",["1","2","3","4","5"],function(p,l,s,m,a){var q=function(i){i.on("ResolveName",function(o){var n;1===o.target.nodeType&&(n=o.target.getAttribute("data-mce-object"))&&(o.name=n)}),i.on("preInit",function(){var e=i.schema.getSpecialElements();tinymce.each("video audio iframe object".split(" "),function(o){e[o]=new RegExp("</"+o+"[^>]*>","gi")});var n=i.schema.getBoolAttrs();tinymce.each("webkitallowfullscreen mozallowfullscreen allowfullscreen".split(" "),function(o){n[o]={}}),i.parser.addNodeFilter("iframe,video,audio,object,embed,script",a.placeHolderConverter(i)),i.serializer.addAttributeFilter("data-mce-object",function(F,v){for(var z,x,D,G,y,C,E,B,A=F.length;A--;){if(z=F[A],z.parent){for(E=z.attr(v),x=new tinymce.html.Node(E,1),"audio"!==E&&"script"!==E&&(B=z.attr("class"),B&&B.indexOf("mce-preview-object")!==-1?x.attr({width:z.firstChild.attr("width"),height:z.firstChild.attr("height")}):x.attr({width:z.attr("width"),height:z.attr("height")})),x.attr({style:z.attr("style")}),G=z.attributes,D=G.length;D--;){var w=G[D].name;0===w.indexOf("data-mce-p-")&&x.attr(w.substr(11),G[D].value)}"script"===E&&x.attr("type","text/javascript"),y=z.attr("data-mce-html"),y&&(C=new tinymce.html.Node("#text",3),C.raw=!0,C.value=s.sanitize(i,unescape(y)),x.append(C)),z.replace(x)}}})}),i.on("click keyup",function(){var e=i.selection.getNode();e&&i.dom.hasClass(e,"mce-preview-object")&&i.dom.getAttrib(e,"data-mce-selected")&&e.setAttribute("data-mce-selected","2")}),i.on("ObjectSelected",function(o){var n=o.target.getAttribute("data-mce-object");"audio"!==n&&"script"!==n||o.preventDefault()}),i.on("objectResized",function(r){var o,u=r.target;u.getAttribute("data-mce-object")&&(o=u.getAttribute("data-mce-html"),o&&(o=unescape(o),u.setAttribute("data-mce-html",escape(m.updateHtml(o,{width:r.width,height:r.height})))))}),this.showDialog=function(){l.showDialog(i)},i.addButton("media",{tooltip:"Insert/edit media",onclick:this.showDialog,stateSelector:["img[data-mce-object]","span[data-mce-object]","div[data-ephox-embed-iri]"]}),i.addMenuItem("media",{icon:"media",text:"Media",onclick:this.showDialog,context:"insert",prependToContext:!0}),i.on("setContent",function(){i.$("span.mce-preview-object").each(function(e,u){var o=i.$(u);0===o.find("span.mce-shim",u).length&&o.append('<span class="mce-shim"></span>')})}),i.addCommand("mceMedia",this.showDialog)};return p.add("media",q),function(){}}),g("0")()}();