"use strict";(function(a){var c=["https://keys.fedoraproject.org/","https://keybase.io/"];var b=function(d){this.keyservers=d||c};b.prototype.get=function(j,i,d,e){if(d===undefined){d=0}if(d>=this.keyservers.length){return i(null,e||404)}var h=this.keyservers[d];var g=this;if(h.indexOf("https://keybase.io/")===0){if(j.indexOf("0x")===0){j=j.substr(2)}var f=new XMLHttpRequest();f.open("get","https://keybase.io/_/api/1.0/user/lookup.json?fields=public_keys&key_fingerprint="+j);f.onload=function(){if(f.status===200){var k=JSON.parse(f.responseText);if(k.status["code"]!==0){return g.get(j,i,d+1,k.status["code"])}if(k.them.length===0){return g.get(j,i,d+1,404)}var l=k.them[0]["public_keys"]["primary"]["bundle"];return i(l,null)}else{return g.get(j,i,d+1,f.status)}};f.send()}else{if(j.indexOf("0x")!==0){j="0x"+j}var f=new XMLHttpRequest();f.open("get",h+"pks/lookup?op=get&options=mr&search="+j);f.onload=function(){if(f.status===200){return i(f.responseText,null)}else{return g.get(j,i,d+1,f.status)}};f.send()}};b.prototype.search=function(p,t,j,g,e){if(j===undefined){j=0}if(g===undefined){g=[]}if(j>=this.keyservers.length){if(g.length===0){return t(null,e||404)}else{var r={};for(var h=0;h<g.length;h++){var f=g[h];if(r[f.keyid]!==undefined){for(var s=0;s<f.uids.length;s++){var o=false;for(var d=0;d<r[f.keyid]["uids"].length;d++){if(r[f.keyid]["uids"][d]["uid"]===f.uids[s]){o=true;break}}if(!o){r[f.keyid]["uids"].push(f.uids[s])}}}else{r[f.keyid]=f}}var n=[];for(var h=0;h<g.length;h++){var f=g[h];if(r[f.keyid]!==undefined){n.push(r[f.keyid]);delete (r[f.keyid])}}return t(n,null)}}var q=this.keyservers[j];var l=this;if(q.indexOf("https://keybase.io/")===0){var v=new XMLHttpRequest();v.open("get","https://keybase.io/_/api/1.0/user/autocomplete.json?q="+encodeURIComponent(p));v.onload=function(){if(v.status===200){var z=JSON.parse(v.responseText);if(z.status["code"]!==0){return l.search(p,t,j+1,g,z.status["code"])}if(z.completions.length===0){return l.search(p,t,j+1,g,404)}var k=[];for(var x=0;x<z.completions.length;x++){var u=z.completions[x]["components"];if(u.key_fingerprint===undefined){continue}var y={keyid:u.key_fingerprint["val"].toUpperCase(),href:"https://keybase.io/"+u.username["val"]+"/key.asc",info:"https://keybase.io/"+u.username["val"],algo:u.key_fingerprint["algo"],keylen:u.key_fingerprint["nbits"],creationdate:null,expirationdate:null,revoked:false,disabled:false,expired:false,uids:[{uid:u.username["val"]+" on Keybase <https://keybase.io/"+u.username["val"]+">",creationdate:null,expirationdate:null,revoked:false,disabled:false,expired:false}]};if(u.full_name!==undefined){y.uids.push({uid:"Full Name: "+u.full_name["val"],creationdate:null,expirationdate:null,revoked:false,disabled:false,expired:false})}if(u.twitter!==undefined){y.uids.push({uid:u.twitter["val"]+" on Twitter <https://twitter.com/"+u.twitter["val"]+">",creationdate:null,expirationdate:null,revoked:false,disabled:false,expired:false})}if(u.github!==undefined){y.uids.push({uid:u.github["val"]+" on Github <https://github.com/"+u.github["val"]+">",creationdate:null,expirationdate:null,revoked:false,disabled:false,expired:false})}if(u.reddit!==undefined){y.uids.push({uid:u.reddit["val"]+" on Github <https://reddit.com/u/"+u.reddit["val"]+">",creationdate:null,expirationdate:null,revoked:false,disabled:false,expired:false})}if(u.hackernews!==undefined){y.uids.push({uid:u.hackernews["val"]+" on Hacker News <https://news.ycombinator.com/user?id="+u.hackernews["val"]+">",creationdate:null,expirationdate:null,revoked:false,disabled:false,expired:false})}if(u.coinbase!==undefined){y.uids.push({uid:u.coinbase["val"]+" on Coinbase <https://www.coinbase.com/"+u.coinbase["val"]+">",creationdate:null,expirationdate:null,revoked:false,disabled:false,expired:false})}if(u.websites!==undefined){for(var m=0;m<u.websites.length;m++){y.uids.push({uid:"Owns "+u.websites[m]["val"],creationdate:null,expirationdate:null,revoked:false,disabled:false,expired:false})}}k.push(y)}g=g.concat(k);return l.search(p,t,j+1,g,null)}else{return l.search(p,t,j+1,g,v.status)}};v.send()}else{var v=new XMLHttpRequest();v.open("get",q+"pks/lookup?op=index&options=mr&fingerprint=on&search="+encodeURIComponent(p));v.onload=function(){if(v.status===200){var k=[];var u=v.responseText.split("\n");var y=undefined;for(var w=0;w<u.length;w++){var m=u[w].trim();if(m.indexOf("pub:")==0){if(y!==undefined){k.push(y)}var x=m.split(":");y={keyid:x[1],href:q+"pks/lookup?op=get&options=mr&search=0x"+x[1],info:q+"pks/lookup?op=vindex&search=0x"+x[1],algo:x[2]===""?null:parseInt(x[2]),keylen:x[3]===""?null:parseInt(x[3]),creationdate:x[4]===""?null:parseInt(x[4]),expirationdate:x[5]===""?null:parseInt(x[5]),revoked:x[6].indexOf("r")!==-1,disabled:x[6].indexOf("d")!==-1,expired:x[6].indexOf("e")!==-1,uids:[]}}if(m.indexOf("uid:")==0){var x=m.split(":");y.uids.push({uid:decodeURIComponent(x[1]),creationdate:x[2]===""?null:parseInt(x[2]),expirationdate:x[3]===""?null:parseInt(x[3]),revoked:x[4].indexOf("r")!==-1,disabled:x[4].indexOf("d")!==-1,expired:x[4].indexOf("e")!==-1})}}k.push(y);g=g.concat(k);return l.search(p,t,j+1,g,null)}else{return l.search(p,t,j+1,g,v.status)}};v.send()}};a.PublicKey=b})(typeof exports==="undefined"?this:exports);