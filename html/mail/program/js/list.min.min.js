function rcube_list_widget(e,d){this.ENTER_KEY=13;this.DELETE_KEY=46;this.BACKSPACE_KEY=8;this.tagname=(this.list=e?e:null)?this.list.nodeName.toLowerCase():"table";this.id_regexp=/^rcmrow([a-z0-9\-_=\+\/]+)/i;this.rows={};this.selection=[];this.modkey=this.subject_col=this.colcount=this.rowcount=0;this.aria_listbox=this.toggleselect=this.keyboard=this.column_movable=this.draggable=this.multi_selecting=this.multiexpand=this.multiselect=!1;this.parent_focus=!0;this.col_drag_active=this.drag_active=!1;this.shift_start=this.last_selected=this.column_fixed=null;this.focused=!1;this.drag_mouse_start=null;this.dblclick_time=500;this.row_init=function(){};this.pointer_touch_start=0;this.pointer_touch_time=500;if(d&&"object"===typeof d){for(var f in d){this[f]=d[f]}}rcube_list_widget._instances.push(this)}rcube_list_widget.prototype={init:function(){"table"==this.tagname&&this.list&&this.list.tBodies[0]?(this.thead=this.list.tHead,this.tbody=this.list.tBodies[0]):"table"!=this.tagname&&this.list&&(this.tbody=this.list);"listbox"==$(this.list).attr("role")&&(this.aria_listbox=!0,this.multiselect&&$(this.list).attr("aria-multiselectable","true"));var f=this;if(this.tbody){this.rows={};this.rowcount=0;var e,h=this.tbody.childNodes;var g=0;for(e=h.length;g<e;g++){1==h[g].nodeType&&(this.rowcount+=this.init_row(h[g])?1:0)}this.init_header();this.frame=this.list.parentNode;this.keyboard&&(rcube_event.add_listener({event:"keydown",object:this,method:"key_press"}),$(this.list).attr("tabindex","0").on("focus",function(a){f.focus(a)}))}this.parent_focus&&(this.list.parentNode.onclick=function(a){f.focus()});return this},init_row:function(f){f.uid=this.get_row_uid(f);if(f&&f.uid){var e=this,h=f.uid;this.rows[h]={uid:h,id:f.id,obj:f};$(f).data("uid",h).mousedown(function(b){return e.drag_row(b,this.uid)}).mouseup(function(b){return 1!=b.which||e.drag_active?!0:e.click_row(b,this.uid)});if((bw.ie||bw.edge)&&bw.pointer){$(f).on("pointerdown",function(b){if("touch"==b.pointerType){return e.pointer_touch_start=(new Date).getTime(),!1}}).on("pointerup",function(b){if("touch"==b.pointerType&&(new Date).getTime()-e.pointer_touch_start<=e.pointer_touch_time){return e.drag_row(b,this.uid),e.click_row(b,this.uid)}})}else{bw.touch&&f.addEventListener&&(f.addEventListener("touchstart",function(b){1==b.touches.length&&(e.touchmoved=!1,e.drag_row(rcube_event.touchevent(b.touches[0]),this.uid))},!1),f.addEventListener("touchend",function(b){1==b.changedTouches.length&&(e.touchmoved||e.click_row(rcube_event.touchevent(b.changedTouches[0]),this.uid)||b.preventDefault())},!1),f.addEventListener("touchmove",function(b){1==b.changedTouches.length&&(e.touchmoved=!0,e.drag_active&&b.preventDefault())},!1))}if(this.aria_listbox){var g="l:"+f.id;$(f).attr("role","option").attr("aria-labelledby",g).find(this.col_tagname()).eq(this.subject_col).attr("id",g)}document.all&&(f.onselectstart=function(){return !1});this.row_init(this.rows[h]);this.triggerEvent("initrow",this.rows[h]);return !0}},init_header:function(){if(this.thead){this.colcount=0;this.fixed_header?($(this.list.tHead).replaceWith($(this.fixed_header).find("thead").clone()),$(this.list.tHead).find("th,td").attr("style","").find("a").attr("tabindex","-1")):!bw.touch&&0<=this.list.className.indexOf("fixedheader")&&this.init_fixed_header();var e,d=this;if(this.column_movable&&this.thead&&this.thead.rows){for(e=0;e<this.thead.rows[0].cells.length;e++){if(this.column_fixed!=e){var f=this.thead.rows[0].cells[e];f.onmousedown=function(b){return d.drag_column(b,this)};this.colcount++}}}}},init_fixed_header:function(){var d=$(this.list.tHead).clone();if(this.fixed_header){$(this.fixed_header).find("thead").replaceWith(d)}else{this.fixed_header=$("<table>").attr("class",this.list.className+" fixedcopy").attr("role","presentation").css({position:"fixed"}).append(d).append("<tbody></tbody>");$(this.list).before(this.fixed_header);var c=this;$(window).resize(function(){c.resize()});$(window).scroll(function(){var b=$(window);c.fixed_header.css({marginLeft:-b.scrollLeft()+"px",marginTop:-b.scrollTop()+"px"})})}$(this.list.tHead).find("a.sortcol").attr("tabindex","-1");d.find("a.sortcol").attr("tabindex","0");this.thead=d.get(0);this.resize()},resize:function(){if(this.fixed_header){var b=[];$(this.tbody).parent().find("thead th,thead td").each(function(a){b[a]=$(this).width()});$(this.thead).parent().width($(this.tbody).parent().width());$(this.thead).find("th,td").each(function(a){$(this).width(b[a])});$(window).scroll()}},clear:function(d){if("table"==this.tagname){var c=document.createElement("tbody");this.list.insertBefore(c,this.tbody);this.list.removeChild(this.list.tBodies[1]);this.tbody=c}else{$(this.row_tagname()+":not(.thead)",this.tbody).remove()}this.rows={};this.rowcount=0;this.last_selected=null;d&&this.clear_selection();this.frame&&(this.frame.scrollTop=0);this.resize()},remove_row:function(f,e){var h=this,g=this.rows[f]?this.rows[f].obj:null;g&&(g.style.display="none",e&&this.select_next(),delete this.rows[f],this.rowcount--,clearTimeout(this.resize_timeout),this.resize_timeout=setTimeout(function(){h.resize()},50))},insert_row:function(s,q){var p=this,o=this.tbody;if(void 0===s.nodeName){var n,m,l=document.createElement(this.row_tagname());s.id&&(l.id=s.id);s.uid&&(l.uid=s.uid);s.className&&(l.className=s.className);s.style&&$.extend(l.style,s.style);for(n=0;s.cols&&n<s.cols.length;n++){var j=s.cols[n];var i=j.dom;if(!i){for(m in i=document.createElement(this.col_tagname()),j.className&&(i.className=j.className),j.innerHTML&&(i.innerHTML=j.innerHTML),j.events){i["on"+m]=j.events[m]}}l.appendChild(i)}s=l}q&&o.childNodes.length?o.insertBefore(s,"object"==typeof q&&q.parentNode==o?q:o.firstChild):o.appendChild(s);this.init_row(s);this.rowcount++;clearTimeout(this.resize_timeout);this.resize_timeout=setTimeout(function(){p.resize()},50)},update_row:function(h,g,l,k){var j=this.rows[h];if(!j){return !1}var i=j.obj;for(j=0;g&&j<g.length;j++){this.get_cell(i,j).html(g[j])}l&&(delete this.rows[h],i.uid=l,i.id="rcmrow"+l,this.init_row(i),k&&(this.selection[0]=l),this.last_selected==h&&(this.last_selected=l))},focus:function(b){this.focused||(this.focused=!0,b&&rcube_event.cancel(b),b=null,this.last_selected&&this.rows[this.last_selected]&&(b=$(this.rows[this.last_selected].obj).find(this.col_tagname()).eq(this.subject_col).attr("tabindex","0")),b&&b.length?this.focus_noscroll(b):($("iframe,:focus:not(body)").blur(),window.focus()),$(this.list).addClass("focus").removeAttr("tabindex"),this.last_selected||this.select_first(CONTROL_KEY))},blur:function(d){this.focused=!1;var c=this;setTimeout(function(){$(c.list).attr("tabindex","0")},20);this.last_selected&&this.rows[this.last_selected]&&$(this.rows[this.last_selected].obj).find(this.col_tagname()).eq(this.subject_col).removeAttr("tabindex");$(this.list).removeClass("focus")},focus_noscroll:function(d){var c=this.frame.scrollTop||this.frame.scrollY;d.focus();this.frame.scrollTop=c},hide_column:function(d,c){c=c?"addClass":"removeClass";if(this.fixed_header){$(this.row_tagname()+" "+this.col_tagname()+"."+d,this.fixed_header)[c]("hidden")}$(this.row_tagname()+" "+this.col_tagname()+"."+d,this.list)[c]("hidden")},drag_column:function(d,c){if(1<this.colcount){for(this.drag_start=!0,this.drag_mouse_start=rcube_event.get_mouse_pos(d),rcube_event.add_listener({event:"mousemove",object:this,method:"column_drag_mouse_move"}),rcube_event.add_listener({event:"mouseup",object:this,method:"column_drag_mouse_up"}),this.add_dragfix(),d=0;d<this.thead.rows[0].cells.length;d++){if(c==this.thead.rows[0].cells[d]){this.selected_column=d;break}}}return !1},drag_row:function(e,d){if(!this.is_event_target(e)||2==rcube_event.get_button(e)){return !0}this.in_selection_before=e&&e.istouch||this.in_selection(d)?d:!1;if(!this.in_selection_before){var f=rcube_event.get_modifier(e);this.select_row(d,f,!0)}this.draggable&&this.selection.length&&this.in_selection(d)&&(this.drag_start=!0,this.drag_mouse_start=rcube_event.get_mouse_pos(e),rcube_event.add_listener({event:"mousemove",object:this,method:"drag_mouse_move"}),rcube_event.add_listener({event:"mouseup",object:this,method:"drag_mouse_up"}),bw.touch&&(rcube_event.add_listener({event:"touchmove",object:this,method:"drag_mouse_move"}),rcube_event.add_listener({event:"touchend",object:this,method:"drag_mouse_up"})),this.add_dragfix());return !1},click_row:function(f,e){if(!e||!this.rows[e]){return !1}if(!this.is_event_target(f)){return !0}var h=(new Date).getTime(),g=h-this.rows[e].clicked<this.dblclick_time;this.drag_active||g||this.in_selection_before!=e||this.select_row(e,rcube_event.get_modifier(f),!0);this.in_selection_before=this.drag_start=!1;this.rowcount&&g&&this.in_selection(e)?(this.triggerEvent("dblclick"),h=0):this.triggerEvent("click");this.drag_active||(this.del_dragfix(),rcube_event.cancel(f));this.rows[e].clicked=h;this.focus();return !1},is_event_target:function(d){d=rcube_event.get_target(d);var c=d.tagName.toLowerCase();return !(d&&("input"==c||"img"==c||"a"!=c&&d.onclick))},find_root:function(d){var c=this.rows[d];return c&&c.parent_uid?this.find_root(c.parent_uid):d},expand_row:function(e,d){d=this.rows[d];var f=rcube_event.get_target(e);e=rcube_event.get_modifier(e);d.clicked=0;d.expanded?(f.className="collapsed",e==CONTROL_KEY||this.multiexpand?this.collapse_all(d):this.collapse(d)):(f.className="expanded",e==CONTROL_KEY||this.multiexpand?this.expand_all(d):this.expand(d))},collapse:function(e){var d=e.depth,f=e?e.obj.nextSibling:null;e.expanded=!1;for(this.triggerEvent("expandcollapse",{uid:e.uid,expanded:e.expanded,obj:e.obj});f;){if(1==f.nodeType){if((e=this.rows[f.uid])&&e.depth<=d){break}$(f).css("display","none");e.expanded&&(e.expanded=!1,this.triggerEvent("expandcollapse",{uid:e.uid,expanded:e.expanded,obj:f}))}f=f.nextSibling}this.resize();this.triggerEvent("listupdate");return !1},expand:function(h){var g,l;if(h){h.expanded=!0;var k=h.depth;var j=h.obj.nextSibling;this.update_expando(h.id,!0);this.triggerEvent("expandcollapse",{uid:h.uid,expanded:h.expanded,obj:h.obj})}else{j=this.tbody.firstChild;var i=k=0}for(;j;){if(1==j.nodeType&&(g=this.rows[j.uid])){if(h&&(!g.depth||g.depth<=k)){break}if(g.parent_uid){if((l=this.rows[g.parent_uid])&&l.expanded){if(h&&l==h||i>=l.depth-1){i=l.depth,$(j).css("display",""),g.expanded=!0,this.triggerEvent("expandcollapse",{uid:g.uid,expanded:g.expanded,obj:j})}}else{if(h&&(!l||l.depth<=k)){break}}}}j=j.nextSibling}this.resize();this.triggerEvent("listupdate");return !1},collapse_all:function(f){var e;if(f){f.expanded=!1;var h=f.depth;var g=f.obj.nextSibling;this.update_expando(f.id);this.triggerEvent("expandcollapse",{uid:f.uid,expanded:f.expanded,obj:f.obj});if(h&&this.multiexpand){return !1}}else{g=this.tbody.firstChild,h=0}for(;g;){if(1==g.nodeType&&(e=this.rows[g.uid])){if(f&&(!e.depth||e.depth<=h)){break}(f||e.depth)&&$(g).css("display","none");e.has_children&&e.expanded&&(e.expanded=!1,this.update_expando(e.id,!1),this.triggerEvent("expandcollapse",{uid:e.uid,expanded:e.expanded,obj:g}))}g=g.nextSibling}this.resize();this.triggerEvent("listupdate");return !1},expand_all:function(f){var e;if(f){f.expanded=!0;var h=f.depth;var g=f.obj.nextSibling;this.update_expando(f.id,!0);this.triggerEvent("expandcollapse",{uid:f.uid,expanded:f.expanded,obj:f.obj})}else{g=this.tbody.firstChild,h=0}for(;g;){if(1==g.nodeType&&(e=this.rows[g.uid])){if(f&&e.depth<=h){break}$(g).css("display","");e.has_children&&!e.expanded&&(e.expanded=!0,this.update_expando(e.id,!0),this.triggerEvent("expandcollapse",{uid:e.uid,expanded:e.expanded,obj:g}))}g=g.nextSibling}this.resize();this.triggerEvent("listupdate");return !1},update_expando:function(d,c){if(d=document.getElementById("rcmexpando"+d)){d.className=c?"expanded":"collapsed"}},get_row_uid:function(d){if(d){if(!d.uid){var c=$(d).data("uid");c?d.uid=c:String(d.id).match(this.id_regexp)&&(d.uid=RegExp.$1)}return d.uid}},get_next_row:function(){if(!this.rowcount){return !1}var b=this.rows[this.last_selected];for(b=b?b.obj.nextSibling:null;b&&(1!=b.nodeType||"none"==b.style.display);){b=b.nextSibling}return b},get_prev_row:function(){if(!this.rowcount){return !1}var b=this.rows[this.last_selected];for(b=b?b.obj.previousSibling:null;b&&(1!=b.nodeType||"none"==b.style.display);){b=b.previousSibling}return b},get_first_row:function(){if(this.rowcount){var e,d,f=this.tbody.childNodes;for(e=0;e<f.length;e++){if(f[e].id&&(d=this.get_row_uid(f[e]))){return d}}}return null},get_last_row:function(){if(this.rowcount){var e,d,f=this.tbody.childNodes;for(e=f.length-1;0<=e;e--){if(f[e].id&&(d=this.get_row_uid(f[e]))){return d}}}return null},row_tagname:function(){var b={table:"tr",ul:"li","*":"div"};return b[this.tagname]||b["*"]},col_tagname:function(){var b={table:"td","*":"span"};return b[this.tagname]||b["*"]},get_cell:function(d,c){return $(this.col_tagname(),d).eq(c)},select_row:function(g,f,j){var i=this.selection.join(","),h=this.in_selection(g);!this.multiselect&&j&&(f=0);this.shift_start||(this.shift_start=g);if(f){switch(f){case SHIFT_KEY:this.shift_select(g,!1);break;case CONTROL_KEY:j&&(this.shift_start=g,this.highlight_row(g,!0));break;case CONTROL_SHIFT_KEY:this.shift_select(g,!0);break;default:this.highlight_row(g,!1)}this.multi_selecting=!0}else{this.shift_start=g,this.highlight_row(g,!1),this.multi_selecting=!1}this.last_selected&&this.rows[this.last_selected]&&$(this.rows[this.last_selected].obj).removeClass("focused").find(this.col_tagname()).eq(this.subject_col).removeAttr("tabindex");this.toggleselect&&h&&!f?this.clear_selection():this.selection.join(",")!=i&&this.triggerEvent("select");this.rows[g]&&($(this.rows[g].obj).addClass("focused"),this.focused&&this.focus_noscroll($(this.rows[g].obj).find(this.col_tagname()).eq(this.subject_col).attr("tabindex","0")));this.selection.length||(this.shift_start=null);this.last_selected=g},select:function(b){this.select_row(b,!1);this.scrollto(b)},select_next:function(){var d=this.get_next_row(),c=this.get_prev_row();(d=d?d:c)&&this.select_row(d.uid,!1,!1)},select_first:function(d){var c=this.get_first_row();c&&(this.select_row(c,d,!1),this.scrollto(c))},select_last:function(d){var c=this.get_last_row();c&&(this.select_row(c,d,!1),this.scrollto(c))},select_children:function(e){var d=this.row_children(e),f=d.length;for(e=0;e<f;e++){this.in_selection(d[e])||this.select_row(d[e],CONTROL_KEY,!0)}},shift_select:function(h,g){this.rows[this.shift_start]&&this.selection.length||(this.shift_start=h);var l,k=this.rows[h];var j=this._rowIndex(this.rows[this.shift_start].obj);var i=this._rowIndex(k.obj);j<i&&!k.expanded&&k.has_children&&(k=this.rows[this.row_children(h).pop()])&&(i=this._rowIndex(k.obj));h=j<i?j:i;j=j>i?j:i;for(l in this.rows){this._rowIndex(this.rows[l].obj)>=h&&this._rowIndex(this.rows[l].obj)<=j?this.in_selection(l)||this.highlight_row(l,!0):this.in_selection(l)&&!g&&this.highlight_row(l,!0)}},_rowIndex:function(b){return void 0!==b.rowIndex?b.rowIndex:$(b).prevAll().length},in_selection:function(e,d){for(var f in this.selection){if(this.selection[f]==e){return d?parseInt(f):!0}}return !1},select_all:function(e){if(!this.rowcount){return !1}var d,f=this.selection.join(",");this.selection=[];for(d in this.rows){e&&1!=this.rows[d][e]?$(this.rows[d].obj).removeClass("selected").removeAttr("aria-selected"):(this.last_selected=d,this.highlight_row(d,!0,!0))}this.selection.join(",")!=f&&this.triggerEvent("select");this.focus();return !0},invert_selection:function(){if(!this.rowcount){return !1}var d,c=this.selection.join(",");for(d in this.rows){this.highlight_row(d,!0)}this.selection.join(",")!=c&&this.triggerEvent("select");this.focus();return !0},clear_selection:function(f,e){var h,g=this.selection.length;if(f){for(h in this.selection){if(this.selection[h]==f){this.selection.splice(h,1);break}}}else{for(h in this.selection){this.rows[this.selection[h]]&&$(this.rows[this.selection[h]].obj).removeClass("selected").removeAttr("aria-selected")}this.selection=[]}!g||this.selection.length||e||(this.triggerEvent("select"),this.last_selected=null)},get_selection:function(i){var h=$.merge([],this.selection);if(!1!==i&&h.length){for(var n,m=0,l=h.length;m<l;m++){if(i=h[m],this.rows[i]&&this.rows[i].has_children&&!this.rows[i].expanded){n=this.row_children(i);for(var k=0,j=n.length;k<j;k++){i=n[k],this.in_selection(i)||h.push(i)}}}}return h},get_single_selection:function(){return 1==this.selection.length?this.selection[0]:null},highlight_row:function(f,e,h){if(this.rows[f]){if(e){var g=this.in_selection(f,!0);!1===g?(this.selection.push(f),$(this.rows[f].obj).addClass("selected").attr("aria-selected","true"),h||this.rows[f].expanded||this.highlight_children(f,!0)):(e=this.selection.slice(0,g),g=this.selection.slice(g+1,this.selection.length),this.selection=e.concat(g),$(this.rows[f].obj).removeClass("selected").removeAttr("aria-selected"),h||this.rows[f].expanded||this.highlight_children(f,!1))}else{if(1<this.selection.length||!this.in_selection(f)){this.clear_selection(null,!0),this.selection[0]=f,$(this.rows[f].obj).addClass("selected").attr("aria-selected","true")}}}},highlight_children:function(g,f){var j=this.row_children(g),i=j.length;for(g=0;g<i;g++){var h=this.in_selection(j[g]);(f&&!h||!f&&h)&&this.highlight_row(j[g],!0,!0)}},key_press:function(e){var d=e.target||{};if(!this.focused||"INPUT"==d.nodeName||"TEXTAREA"==d.nodeName||"SELECT"==d.nodeName){return !0}d=rcube_event.get_keycode(e);var f=rcube_event.get_modifier(e);switch(d){case 40:case 38:case 63233:case 63232:return rcube_event.cancel(e),this.use_arrow_key(d,f);case 32:return rcube_event.cancel(e),this.select_row(this.last_selected,f,!0);case 37:case 39:return rcube_event.cancel(e),e=this.use_arrow_key(d,f),this.key_pressed=d,this.modkey=f,this.triggerEvent("keypress"),this.modkey=0,e;case 36:return this.select_first(f),rcube_event.cancel(e);case 35:return this.select_last(f),rcube_event.cancel(e);case 27:return this.drag_active?this.drag_mouse_up(e):this.col_drag_active?(this.selected_column=null,this.column_drag_mouse_up(e)):rcube_event.cancel(e);case 9:this.blur();break;case 13:this.selection.length||this.select_row(this.last_selected,f,!1);default:if(this.key_pressed=d,this.modkey=f,this.triggerEvent("keypress"),this.modkey=0,this.key_pressed==this.BACKSPACE_KEY){return rcube_event.cancel(e)}}return !0},use_arrow_key:function(e,d){var f=this.rows[this.last_selected];if(40==e||63233==e){e=this.get_next_row()}else{if(38==e||63232==e){e=this.get_prev_row()}else{if(!f||!f.has_children){return}if(39==e){if(f.expanded){return}d==CONTROL_KEY||this.multiexpand?this.expand_all(f):this.expand(f)}else{if(!f.expanded){return}d==CONTROL_KEY||this.multiexpand?this.collapse_all(f):this.collapse(f)}this.update_expando(f.id,f.expanded);return !1}}e?(d||this.selection.length||(d=CONTROL_KEY),this.select_row(e.uid,d,!1),this.scrollto(e.uid)):e||f||this.select_first(CONTROL_KEY);return !1},scrollto:function(f){var e=this.rows[f]?this.rows[f].obj:null;if(e&&this.frame){var h=Number(e.offsetTop),g=0;!h&&this.rows[f].parent_uid&&(f=this.find_root(this.rows[f].uid),this.expand_all(this.rows[f]),h=Number(e.offsetTop));this.fixed_header&&(g=Number(this.thead.offsetHeight));h<Number(this.frame.scrollTop)+g?this.frame.scrollTop=h-g:h+Number(e.offsetHeight)>Number(this.frame.scrollTop)+Number(this.frame.offsetHeight)&&(this.frame.scrollTop=h+Number(e.offsetHeight)-Number(this.frame.offsetHeight))}},drag_mouse_move:function(f){if("touchmove"==f.type){if(1==f.touches.length&&1==f.changedTouches.length){f=rcube_event.touchevent(f.changedTouches[0])}else{return rcube_event.cancel(f)}}if(this.drag_start){var e=rcube_event.get_mouse_pos(f),h=[],g=this;if(!this.drag_mouse_start||3>Math.abs(e.x-this.drag_mouse_start.x)&&3>Math.abs(e.y-this.drag_mouse_start.y)){return !1}this.drag_start_pos={left:e.x,top:e.y};this.draglayer?this.draglayer.html(""):this.draglayer=$("<div>").attr("id","rcmdraglayer").css({position:"absolute",display:"none","z-index":2000}).appendTo(document.body);$(this.row_tagname()+".selected",this.tbody).each(function(){var d=g.get_row_uid(this),c=g.rows[d];if(c&&!(-1<$.inArray(d,h))&&(h.push(d),c.has_children&&!c.expanded&&$.each(g.row_children(d),function(){-1<$.inArray(this,h)||h.push(this)}),11<h.length)){return !1}});$.each(h,function(d,c){if(10<d){return g.draglayer.append("..."),!1}$("> "+g.col_tagname(),g.rows[c].obj).each(function(j,i){if(0>g.subject_col||0<=g.subject_col&&g.subject_col==j){if(i=$(i).clone(),$(i).find(".skip-on-drag").remove(),j=i.text()){return j=$.trim(j),j=50<j.length?j.substring(0,50)+"...":j,g.draglayer.append($("<div>").text(j)),!1}}})});this.draglayer.show();this.drag_active=!0;this.triggerEvent("dragstart")}this.drag_active&&this.draglayer&&(e=rcube_event.get_mouse_pos(f),this.draglayer.css({left:e.x+20+"px",top:e.y-5+(bw.ie?document.documentElement.scrollTop:0)+"px"}),this.triggerEvent("dragmove",f?f:window.event));return this.drag_start=!1},drag_mouse_up:function(b){document.onmousemove=null;if("touchend"==b.type&&1!=b.changedTouches.length){return rcube_event.cancel(b)}this.draglayer&&this.draglayer.is(":visible")&&(this.drag_start_pos?this.draglayer.animate(this.drag_start_pos,300,"swing").hide(20):this.draglayer.hide());this.drag_active&&this.focus();this.drag_active=!1;rcube_event.remove_listener({event:"mousemove",object:this,method:"drag_mouse_move"});rcube_event.remove_listener({event:"mouseup",object:this,method:"drag_mouse_up"});bw.touch&&(rcube_event.remove_listener({event:"touchmove",object:this,method:"drag_mouse_move"}),rcube_event.remove_listener({event:"touchend",object:this,method:"drag_mouse_up"}));this.del_dragfix();this.triggerEvent("dragend",b);return rcube_event.cancel(b)},column_drag_mouse_move:function(f){if(this.drag_start){var e=rcube_event.get_mouse_pos(f);if(!this.drag_mouse_start||3>Math.abs(e.x-this.drag_mouse_start.x)&&3>Math.abs(e.y-this.drag_mouse_start.y)){return !1}if(!this.col_draglayer){e=$(this.list).offset();var h=this.thead.rows[0].cells;e.top+=this.list.scrollTop+this.list.parentNode.scrollTop;this.col_draglayer=$("<div>").attr("id","rcmcoldraglayer").css(e).css({position:"absolute","z-index":2001,"background-color":"white",opacity:0.75,height:this.frame.offsetHeight-2+"px",width:this.frame.offsetWidth-2+"px"}).appendTo(document.body).append($("<div>").attr("id","rcmcolumnindicator").css({position:"absolute","border-right":"2px dotted #555","z-index":2002,height:this.frame.offsetHeight-2+"px"}));this.cols=[];this.list_pos=this.list_min_pos=e.left;for(e=0;e<h.length;e++){this.cols[e]=h[e].offsetWidth,null!==this.column_fixed&&e<=this.column_fixed&&(this.list_min_pos+=this.cols[e])}}this.col_draglayer.show();this.col_drag_active=!0;this.triggerEvent("column_dragstart")}if(this.col_drag_active&&this.col_draglayer){h=0;var g=rcube_event.get_mouse_pos(f);for(e=0;e<this.cols.length;e++){if(g.x>=this.cols[e]/2+this.list_pos+h){h+=this.cols[e]}else{break}}0==e&&this.list_min_pos>g.x?h=this.list_min_pos-this.list_pos:this.list.rowcount||e!=this.cols.length||(h-=2);$("#rcmcolumnindicator").css({width:h+"px"});this.triggerEvent("column_dragmove",f?f:window.event)}return this.drag_start=!1},column_drag_mouse_up:function(f){document.onmousemove=null;this.col_draglayer&&(this.col_draglayer.remove(),this.col_draglayer=null);rcube_event.remove_listener({event:"mousemove",object:this,method:"column_drag_mouse_move"});rcube_event.remove_listener({event:"mouseup",object:this,method:"column_drag_mouse_up"});this.del_dragfix();if(this.col_drag_active&&(this.col_drag_active=!1,this.focus(),this.triggerEvent("column_dragend",f),null!==this.selected_column&&this.cols&&this.cols.length)){var e,h=0,g=rcube_event.get_mouse_pos(f);for(e=0;e<this.cols.length;e++){if(g.x>=this.cols[e]/2+this.list_pos+h){h+=this.cols[e]}else{break}}e!=this.selected_column&&e!=this.selected_column+1&&this.column_replace(this.selected_column,e)}return rcube_event.cancel(f)},row_children:function(e){if(!this.rows[e]||!this.rows[e].has_children){return[]}var d=[],f=this.rows[e].depth;for(e=this.rows[e].obj.nextSibling;e;){if(1==e.nodeType&&(r=this.rows[e.uid])){if(!r.depth||r.depth<=f){break}d.push(r.uid)}e=e.nextSibling}return d},add_dragfix:function(){$("iframe").each(function(){$('<div class="iframe-dragdrop-fix"></div>').css({background:"#fff",width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1000}).css($(this).offset()).appendTo(document.body)})},del_dragfix:function(){$("div.iframe-dragdrop-fix").remove()},column_replace:function(h,g){if(this.thead&&this.thead.rows){var l=this.thead.rows[0].cells;var k=l[h],j=l[g],i=document.createElement("td");j?l[0].parentNode.insertBefore(i,j):l[0].parentNode.appendChild(i);l[0].parentNode.replaceChild(k,i);r=0;for(l=this.tbody.rows.length;r<l;r++){row=this.tbody.rows[r],k=row.cells[h],j=row.cells[g],i=document.createElement("td"),j?row.insertBefore(i,j):row.appendChild(i),row.replaceChild(k,i)}this.subject_col==h?this.subject_col=g>h?g-1:g:this.subject_col<h&&g<=this.subject_col?this.subject_col++:this.subject_col>h&&g>=this.subject_col&&this.subject_col--;this.fixed_header&&this.init_header();this.triggerEvent("column_replace")}}};rcube_list_widget.prototype.addEventListener=rcube_event_engine.prototype.addEventListener;rcube_list_widget.prototype.removeEventListener=rcube_event_engine.prototype.removeEventListener;rcube_list_widget.prototype.triggerEvent=rcube_event_engine.prototype.triggerEvent;rcube_list_widget._instances=[];