function rcube_list_widget(b,c){this.ENTER_KEY=13;this.DELETE_KEY=46;this.BACKSPACE_KEY=8;this.tagname=(this.list=b?b:null)?this.list.nodeName.toLowerCase():"table";this.id_regexp=/^rcmrow([a-z0-9\-_=\+\/]+)/i;this.rows={};this.selection=[];this.modkey=this.subject_col=this.colcount=this.rowcount=0;this.aria_listbox=this.toggleselect=this.keyboard=this.column_movable=this.draggable=this.multi_selecting=this.multiexpand=this.multiselect=!1;this.parent_focus=!0;this.col_drag_active=this.drag_active=!1;this.shift_start=this.last_selected=this.column_fixed=null;this.focused=!1;this.drag_mouse_start=null;this.dblclick_time=500;this.row_init=function(){};this.pointer_touch_start=0;this.pointer_touch_time=500;if(c&&"object"===typeof c){for(var a in c){this[a]=c[a]}}rcube_list_widget._instances.push(this)}rcube_list_widget.prototype={init:function(){"table"==this.tagname&&this.list&&this.list.tBodies[0]?(this.thead=this.list.tHead,this.tbody=this.list.tBodies[0]):"table"!=this.tagname&&this.list&&(this.tbody=this.list);"listbox"==$(this.list).attr("role")&&(this.aria_listbox=!0,this.multiselect&&$(this.list).attr("aria-multiselectable","true"));var c=this;if(this.tbody){this.rows={};this.rowcount=0;var d,a=this.tbody.childNodes;var b=0;for(d=a.length;b<d;b++){1==a[b].nodeType&&(this.rowcount+=this.init_row(a[b])?1:0)}this.init_header();this.frame=this.list.parentNode;this.keyboard&&(rcube_event.add_listener({event:"keydown",object:this,method:"key_press"}),$(this.list).attr("tabindex","0").on("focus",function(e){c.focus(e)}))}this.parent_focus&&(this.list.parentNode.onclick=function(e){c.focus()});return this},init_row:function(c){c.uid=this.get_row_uid(c);if(c&&c.uid){var d=this,a=c.uid;this.rows[a]={uid:a,id:c.id,obj:c};$(c).data("uid",a).mousedown(function(e){return d.drag_row(e,this.uid)}).mouseup(function(e){return 1!=e.which||d.drag_active?!0:d.click_row(e,this.uid)});if((bw.ie||bw.edge)&&bw.pointer){$(c).on("pointerdown",function(e){if("touch"==e.pointerType){return d.pointer_touch_start=(new Date).getTime(),!1}}).on("pointerup",function(e){if("touch"==e.pointerType&&(new Date).getTime()-d.pointer_touch_start<=d.pointer_touch_time){return d.drag_row(e,this.uid),d.click_row(e,this.uid)}})}else{bw.touch&&c.addEventListener&&(c.addEventListener("touchstart",function(e){1==e.touches.length&&(d.touchmoved=!1,d.drag_row(rcube_event.touchevent(e.touches[0]),this.uid))},!1),c.addEventListener("touchend",function(e){1==e.changedTouches.length&&(d.touchmoved||d.click_row(rcube_event.touchevent(e.changedTouches[0]),this.uid)||e.preventDefault())},!1),c.addEventListener("touchmove",function(e){1==e.changedTouches.length&&(d.touchmoved=!0,d.drag_active&&e.preventDefault())},!1))}if(this.aria_listbox){var b="l:"+c.id;$(c).attr("role","option").attr("aria-labelledby",b).find(this.col_tagname()).eq(this.subject_col).attr("id",b)}document.all&&(c.onselectstart=function(){return !1});this.row_init(this.rows[a]);this.triggerEvent("initrow",this.rows[a]);return !0}},init_header:function(){if(this.thead){this.colcount=0;this.fixed_header?($(this.list.tHead).replaceWith($(this.fixed_header).find("thead").clone()),$(this.list.tHead).find("th,td").attr("style","").find("a").attr("tabindex","-1")):!bw.touch&&0<=this.list.className.indexOf("fixedheader")&&this.init_fixed_header();var b,c=this;if(this.column_movable&&this.thead&&this.thead.rows){for(b=0;b<this.thead.rows[0].cells.length;b++){if(this.column_fixed!=b){var a=this.thead.rows[0].cells[b];a.onmousedown=function(d){return c.drag_column(d,this)};this.colcount++}}}}},init_fixed_header:function(){var a=$(this.list.tHead).clone();if(this.fixed_header){$(this.fixed_header).find("thead").replaceWith(a)}else{this.fixed_header=$("<table>").attr("class",this.list.className+" fixedcopy").attr("role","presentation").css({position:"fixed"}).append(a).append("<tbody></tbody>");$(this.list).before(this.fixed_header);var b=this;$(window).resize(function(){b.resize()});$(window).scroll(function(){var c=$(window);b.fixed_header.css({marginLeft:-c.scrollLeft()+"px",marginTop:-c.scrollTop()+"px"})})}$(this.list.tHead).find("a.sortcol").attr("tabindex","-1");a.find("a.sortcol").attr("tabindex","0");this.thead=a.get(0);this.resize()},resize:function(){if(this.fixed_header){var a=[];$(this.tbody).parent().find("thead th,thead td").each(function(b){a[b]=$(this).width()});$(this.thead).parent().width($(this.tbody).parent().width());$(this.thead).find("th,td").each(function(b){$(this).width(a[b])});$(window).scroll()}},clear:function(a){if("table"==this.tagname){var b=document.createElement("tbody");this.list.insertBefore(b,this.tbody);this.list.removeChild(this.list.tBodies[1]);this.tbody=b}else{$(this.row_tagname()+":not(.thead)",this.tbody).remove()}this.rows={};this.rowcount=0;this.last_selected=null;a&&this.clear_selection();this.frame&&(this.frame.scrollTop=0);this.resize()},remove_row:function(c,d){var a=this,b=this.rows[c]?this.rows[c].obj:null;b&&(b.style.display="none",d&&this.select_next(),delete this.rows[c],this.rowcount--,clearTimeout(this.resize_timeout),this.resize_timeout=setTimeout(function(){a.resize()},50))},insert_row:function(k,a){var b=this,c=this.tbody;if(void 0===k.nodeName){var d,e,f=document.createElement(this.row_tagname());k.id&&(f.id=k.id);k.uid&&(f.uid=k.uid);k.className&&(f.className=k.className);k.style&&$.extend(f.style,k.style);for(d=0;k.cols&&d<k.cols.length;d++){var g=k.cols[d];var h=g.dom;if(!h){for(e in h=document.createElement(this.col_tagname()),g.className&&(h.className=g.className),g.innerHTML&&(h.innerHTML=g.innerHTML),g.events){h["on"+e]=g.events[e]}}f.appendChild(h)}k=f}a&&c.childNodes.length?c.insertBefore(k,"object"==typeof a&&a.parentNode==c?a:c.firstChild):c.appendChild(k);this.init_row(k);this.rowcount++;clearTimeout(this.resize_timeout);this.resize_timeout=setTimeout(function(){b.resize()},50)},update_row:function(e,f,a,b){var c=this.rows[e];if(!c){return !1}var d=c.obj;for(c=0;f&&c<f.length;c++){this.get_cell(d,c).html(f[c])}a&&(delete this.rows[e],d.uid=a,d.id="rcmrow"+a,this.init_row(d),b&&(this.selection[0]=a),this.last_selected==e&&(this.last_selected=a))},focus:function(a){this.focused||(this.focused=!0,a&&rcube_event.cancel(a),a=null,this.last_selected&&this.rows[this.last_selected]&&(a=$(this.rows[this.last_selected].obj).find(this.col_tagname()).eq(this.subject_col).attr("tabindex","0")),a&&a.length?this.focus_noscroll(a):($("iframe,:focus:not(body)").blur(),window.focus()),$(this.list).addClass("focus").removeAttr("tabindex"),this.last_selected||this.select_first(CONTROL_KEY))},blur:function(a){this.focused=!1;var b=this;setTimeout(function(){$(b.list).attr("tabindex","0")},20);this.last_selected&&this.rows[this.last_selected]&&$(this.rows[this.last_selected].obj).find(this.col_tagname()).eq(this.subject_col).removeAttr("tabindex");$(this.list).removeClass("focus")},focus_noscroll:function(a){var b=this.frame.scrollTop||this.frame.scrollY;a.focus();this.frame.scrollTop=b},hide_column:function(a,b){b=b?"addClass":"removeClass";if(this.fixed_header){$(this.row_tagname()+" "+this.col_tagname()+"."+a,this.fixed_header)[b]("hidden")}$(this.row_tagname()+" "+this.col_tagname()+"."+a,this.list)[b]("hidden")},drag_column:function(a,b){if(1<this.colcount){for(this.drag_start=!0,this.drag_mouse_start=rcube_event.get_mouse_pos(a),rcube_event.add_listener({event:"mousemove",object:this,method:"column_drag_mouse_move"}),rcube_event.add_listener({event:"mouseup",object:this,method:"column_drag_mouse_up"}),this.add_dragfix(),a=0;a<this.thead.rows[0].cells.length;a++){if(b==this.thead.rows[0].cells[a]){this.selected_column=a;break}}}return !1},drag_row:function(b,c){if(!this.is_event_target(b)||2==rcube_event.get_button(b)){return !0}this.in_selection_before=b&&b.istouch||this.in_selection(c)?c:!1;if(!this.in_selection_before){var a=rcube_event.get_modifier(b);this.select_row(c,a,!0)}this.draggable&&this.selection.length&&this.in_selection(c)&&(this.drag_start=!0,this.drag_mouse_start=rcube_event.get_mouse_pos(b),rcube_event.add_listener({event:"mousemove",object:this,method:"drag_mouse_move"}),rcube_event.add_listener({event:"mouseup",object:this,method:"drag_mouse_up"}),bw.touch&&(rcube_event.add_listener({event:"touchmove",object:this,method:"drag_mouse_move"}),rcube_event.add_listener({event:"touchend",object:this,method:"drag_mouse_up"})),this.add_dragfix());return !1},click_row:function(c,d){if(!d||!this.rows[d]){return !1}if(!this.is_event_target(c)){return !0}var a=(new Date).getTime(),b=a-this.rows[d].clicked<this.dblclick_time;this.drag_active||b||this.in_selection_before!=d||this.select_row(d,rcube_event.get_modifier(c),!0);this.in_selection_before=this.drag_start=!1;this.rowcount&&b&&this.in_selection(d)?(this.triggerEvent("dblclick"),a=0):this.triggerEvent("click");this.drag_active||(this.del_dragfix(),rcube_event.cancel(c));this.rows[d].clicked=a;this.focus();return !1},is_event_target:function(a){a=rcube_event.get_target(a);var b=a.tagName.toLowerCase();return !(a&&("input"==b||"img"==b||"a"!=b&&a.onclick))},find_root:function(a){var b=this.rows[a];return b&&b.parent_uid?this.find_root(b.parent_uid):a},expand_row:function(b,c){c=this.rows[c];var a=rcube_event.get_target(b);b=rcube_event.get_modifier(b);c.clicked=0;c.expanded?(a.className="collapsed",b==CONTROL_KEY||this.multiexpand?this.collapse_all(c):this.collapse(c)):(a.className="expanded",b==CONTROL_KEY||this.multiexpand?this.expand_all(c):this.expand(c))},collapse:function(b){var c=b.depth,a=b?b.obj.nextSibling:null;b.expanded=!1;for(this.triggerEvent("expandcollapse",{uid:b.uid,expanded:b.expanded,obj:b.obj});a;){if(1==a.nodeType){if((b=this.rows[a.uid])&&b.depth<=c){break}$(a).css("display","none");b.expanded&&(b.expanded=!1,this.triggerEvent("expandcollapse",{uid:b.uid,expanded:b.expanded,obj:a}))}a=a.nextSibling}this.resize();this.triggerEvent("listupdate");return !1},expand:function(e){var f,a;if(e){e.expanded=!0;var b=e.depth;var c=e.obj.nextSibling;this.update_expando(e.id,!0);this.triggerEvent("expandcollapse",{uid:e.uid,expanded:e.expanded,obj:e.obj})}else{c=this.tbody.firstChild;var d=b=0}for(;c;){if(1==c.nodeType&&(f=this.rows[c.uid])){if(e&&(!f.depth||f.depth<=b)){break}if(f.parent_uid){if((a=this.rows[f.parent_uid])&&a.expanded){if(e&&a==e||d>=a.depth-1){d=a.depth,$(c).css("display",""),f.expanded=!0,this.triggerEvent("expandcollapse",{uid:f.uid,expanded:f.expanded,obj:c})}}else{if(e&&(!a||a.depth<=b)){break}}}}c=c.nextSibling}this.resize();this.triggerEvent("listupdate");return !1},collapse_all:function(c){var d;if(c){c.expanded=!1;var a=c.depth;var b=c.obj.nextSibling;this.update_expando(c.id);this.triggerEvent("expandcollapse",{uid:c.uid,expanded:c.expanded,obj:c.obj});if(a&&this.multiexpand){return !1}}else{b=this.tbody.firstChild,a=0}for(;b;){if(1==b.nodeType&&(d=this.rows[b.uid])){if(c&&(!d.depth||d.depth<=a)){break}(c||d.depth)&&$(b).css("display","none");d.has_children&&d.expanded&&(d.expanded=!1,this.update_expando(d.id,!1),this.triggerEvent("expandcollapse",{uid:d.uid,expanded:d.expanded,obj:b}))}b=b.nextSibling}this.resize();this.triggerEvent("listupdate");return !1},expand_all:function(c){var d;if(c){c.expanded=!0;var a=c.depth;var b=c.obj.nextSibling;this.update_expando(c.id,!0);this.triggerEvent("expandcollapse",{uid:c.uid,expanded:c.expanded,obj:c.obj})}else{b=this.tbody.firstChild,a=0}for(;b;){if(1==b.nodeType&&(d=this.rows[b.uid])){if(c&&d.depth<=a){break}$(b).css("display","");d.has_children&&!d.expanded&&(d.expanded=!0,this.update_expando(d.id,!0),this.triggerEvent("expandcollapse",{uid:d.uid,expanded:d.expanded,obj:b}))}b=b.nextSibling}this.resize();this.triggerEvent("listupdate");return !1},update_expando:function(a,b){if(a=document.getElementById("rcmexpando"+a)){a.className=b?"expanded":"collapsed"}},get_row_uid:function(a){if(a){if(!a.uid){var b=$(a).data("uid");b?a.uid=b:String(a.id).match(this.id_regexp)&&(a.uid=RegExp.$1)}return a.uid}},get_next_row:function(){if(!this.rowcount){return !1}var a=this.rows[this.last_selected];for(a=a?a.obj.nextSibling:null;a&&(1!=a.nodeType||"none"==a.style.display);){a=a.nextSibling}return a},get_prev_row:function(){if(!this.rowcount){return !1}var a=this.rows[this.last_selected];for(a=a?a.obj.previousSibling:null;a&&(1!=a.nodeType||"none"==a.style.display);){a=a.previousSibling}return a},get_first_row:function(){if(this.rowcount){var b,c,a=this.tbody.childNodes;for(b=0;b<a.length;b++){if(a[b].id&&(c=this.get_row_uid(a[b]))){return c}}}return null},get_last_row:function(){if(this.rowcount){var b,c,a=this.tbody.childNodes;for(b=a.length-1;0<=b;b--){if(a[b].id&&(c=this.get_row_uid(a[b]))){return c}}}return null},row_tagname:function(){var a={table:"tr",ul:"li","*":"div"};return a[this.tagname]||a["*"]},col_tagname:function(){var a={table:"td","*":"span"};return a[this.tagname]||a["*"]},get_cell:function(a,b){return $(this.col_tagname(),a).eq(b)},select_row:function(d,e,a){var b=this.selection.join(","),c=this.in_selection(d);!this.multiselect&&a&&(e=0);this.shift_start||(this.shift_start=d);if(e){switch(e){case SHIFT_KEY:this.shift_select(d,!1);break;case CONTROL_KEY:a&&(this.shift_start=d,this.highlight_row(d,!0));break;case CONTROL_SHIFT_KEY:this.shift_select(d,!0);break;default:this.highlight_row(d,!1)}this.multi_selecting=!0}else{this.shift_start=d,this.highlight_row(d,!1),this.multi_selecting=!1}this.last_selected&&this.rows[this.last_selected]&&$(this.rows[this.last_selected].obj).removeClass("focused").find(this.col_tagname()).eq(this.subject_col).removeAttr("tabindex");this.toggleselect&&c&&!e?this.clear_selection():this.selection.join(",")!=b&&this.triggerEvent("select");this.rows[d]&&($(this.rows[d].obj).addClass("focused"),this.focused&&this.focus_noscroll($(this.rows[d].obj).find(this.col_tagname()).eq(this.subject_col).attr("tabindex","0")));this.selection.length||(this.shift_start=null);this.last_selected=d},select:function(a){this.select_row(a,!1);this.scrollto(a)},select_next:function(){var a=this.get_next_row(),b=this.get_prev_row();(a=a?a:b)&&this.select_row(a.uid,!1,!1)},select_first:function(a){var b=this.get_first_row();b&&(this.select_row(b,a,!1),this.scrollto(b))},select_last:function(a){var b=this.get_last_row();b&&(this.select_row(b,a,!1),this.scrollto(b))},select_children:function(b){var c=this.row_children(b),a=c.length;for(b=0;b<a;b++){this.in_selection(c[b])||this.select_row(c[b],CONTROL_KEY,!0)}},shift_select:function(e,f){this.rows[this.shift_start]&&this.selection.length||(this.shift_start=e);var a,b=this.rows[e];var c=this._rowIndex(this.rows[this.shift_start].obj);var d=this._rowIndex(b.obj);c<d&&!b.expanded&&b.has_children&&(b=this.rows[this.row_children(e).pop()])&&(d=this._rowIndex(b.obj));e=c<d?c:d;c=c>d?c:d;for(a in this.rows){this._rowIndex(this.rows[a].obj)>=e&&this._rowIndex(this.rows[a].obj)<=c?this.in_selection(a)||this.highlight_row(a,!0):this.in_selection(a)&&!f&&this.highlight_row(a,!0)}},_rowIndex:function(a){return void 0!==a.rowIndex?a.rowIndex:$(a).prevAll().length},in_selection:function(b,c){for(var a in this.selection){if(this.selection[a]==b){return c?parseInt(a):!0}}return !1},select_all:function(b){if(!this.rowcount){return !1}var c,a=this.selection.join(",");this.selection=[];for(c in this.rows){b&&1!=this.rows[c][b]?$(this.rows[c].obj).removeClass("selected").removeAttr("aria-selected"):(this.last_selected=c,this.highlight_row(c,!0,!0))}this.selection.join(",")!=a&&this.triggerEvent("select");this.focus();return !0},invert_selection:function(){if(!this.rowcount){return !1}var a,b=this.selection.join(",");for(a in this.rows){this.highlight_row(a,!0)}this.selection.join(",")!=b&&this.triggerEvent("select");this.focus();return !0},clear_selection:function(c,d){var a,b=this.selection.length;if(c){for(a in this.selection){if(this.selection[a]==c){this.selection.splice(a,1);break}}}else{for(a in this.selection){this.rows[this.selection[a]]&&$(this.rows[this.selection[a]].obj).removeClass("selected").removeAttr("aria-selected")}this.selection=[]}!b||this.selection.length||d||(this.triggerEvent("select"),this.last_selected=null)},get_selection:function(e){var f=$.merge([],this.selection);if(!1!==e&&f.length){for(var g,a=0,b=f.length;a<b;a++){if(e=f[a],this.rows[e]&&this.rows[e].has_children&&!this.rows[e].expanded){g=this.row_children(e);for(var c=0,d=g.length;c<d;c++){e=g[c],this.in_selection(e)||f.push(e)}}}}return f},get_single_selection:function(){return 1==this.selection.length?this.selection[0]:null},highlight_row:function(c,d,a){if(this.rows[c]){if(d){var b=this.in_selection(c,!0);!1===b?(this.selection.push(c),$(this.rows[c].obj).addClass("selected").attr("aria-selected","true"),a||this.rows[c].expanded||this.highlight_children(c,!0)):(d=this.selection.slice(0,b),b=this.selection.slice(b+1,this.selection.length),this.selection=d.concat(b),$(this.rows[c].obj).removeClass("selected").removeAttr("aria-selected"),a||this.rows[c].expanded||this.highlight_children(c,!1))}else{if(1<this.selection.length||!this.in_selection(c)){this.clear_selection(null,!0),this.selection[0]=c,$(this.rows[c].obj).addClass("selected").attr("aria-selected","true")}}}},highlight_children:function(d,e){var a=this.row_children(d),b=a.length;for(d=0;d<b;d++){var c=this.in_selection(a[d]);(e&&!c||!e&&c)&&this.highlight_row(a[d],!0,!0)}},key_press:function(b){var c=b.target||{};if(!this.focused||"INPUT"==c.nodeName||"TEXTAREA"==c.nodeName||"SELECT"==c.nodeName){return !0}c=rcube_event.get_keycode(b);var a=rcube_event.get_modifier(b);switch(c){case 40:case 38:case 63233:case 63232:return rcube_event.cancel(b),this.use_arrow_key(c,a);case 32:return rcube_event.cancel(b),this.select_row(this.last_selected,a,!0);case 37:case 39:return rcube_event.cancel(b),b=this.use_arrow_key(c,a),this.key_pressed=c,this.modkey=a,this.triggerEvent("keypress"),this.modkey=0,b;case 36:return this.select_first(a),rcube_event.cancel(b);case 35:return this.select_last(a),rcube_event.cancel(b);case 27:return this.drag_active?this.drag_mouse_up(b):this.col_drag_active?(this.selected_column=null,this.column_drag_mouse_up(b)):rcube_event.cancel(b);case 9:this.blur();break;case 13:this.selection.length||this.select_row(this.last_selected,a,!1);default:if(this.key_pressed=c,this.modkey=a,this.triggerEvent("keypress"),this.modkey=0,this.key_pressed==this.BACKSPACE_KEY){return rcube_event.cancel(b)}}return !0},use_arrow_key:function(b,c){var a=this.rows[this.last_selected];if(40==b||63233==b){b=this.get_next_row()}else{if(38==b||63232==b){b=this.get_prev_row()}else{if(!a||!a.has_children){return}if(39==b){if(a.expanded){return}c==CONTROL_KEY||this.multiexpand?this.expand_all(a):this.expand(a)}else{if(!a.expanded){return}c==CONTROL_KEY||this.multiexpand?this.collapse_all(a):this.collapse(a)}this.update_expando(a.id,a.expanded);return !1}}b?(c||this.selection.length||(c=CONTROL_KEY),this.select_row(b.uid,c,!1),this.scrollto(b.uid)):b||a||this.select_first(CONTROL_KEY);return !1},scrollto:function(c){var d=this.rows[c]?this.rows[c].obj:null;if(d&&this.frame){var a=Number(d.offsetTop),b=0;!a&&this.rows[c].parent_uid&&(c=this.find_root(this.rows[c].uid),this.expand_all(this.rows[c]),a=Number(d.offsetTop));this.fixed_header&&(b=Number(this.thead.offsetHeight));a<Number(this.frame.scrollTop)+b?this.frame.scrollTop=a-b:a+Number(d.offsetHeight)>Number(this.frame.scrollTop)+Number(this.frame.offsetHeight)&&(this.frame.scrollTop=a+Number(d.offsetHeight)-Number(this.frame.offsetHeight))}},drag_mouse_move:function(c){if("touchmove"==c.type){if(1==c.touches.length&&1==c.changedTouches.length){c=rcube_event.touchevent(c.changedTouches[0])}else{return rcube_event.cancel(c)}}if(this.drag_start){var d=rcube_event.get_mouse_pos(c),a=[],b=this;if(!this.drag_mouse_start||3>Math.abs(d.x-this.drag_mouse_start.x)&&3>Math.abs(d.y-this.drag_mouse_start.y)){return !1}this.drag_start_pos={left:d.x,top:d.y};this.draglayer?this.draglayer.html(""):this.draglayer=$("<div>").attr("id","rcmdraglayer").css({position:"absolute",display:"none","z-index":2000}).appendTo(document.body);$(this.row_tagname()+".selected",this.tbody).each(function(){var e=b.get_row_uid(this),f=b.rows[e];if(f&&!(-1<$.inArray(e,a))&&(a.push(e),f.has_children&&!f.expanded&&$.each(b.row_children(e),function(){-1<$.inArray(this,a)||a.push(this)}),11<a.length)){return !1}});$.each(a,function(e,f){if(10<e){return b.draglayer.append("..."),!1}$("> "+b.col_tagname(),b.rows[f].obj).each(function(g,h){if(0>b.subject_col||0<=b.subject_col&&b.subject_col==g){if(h=$(h).clone(),$(h).find(".skip-on-drag").remove(),g=h.text()){return g=$.trim(g),g=50<g.length?g.substring(0,50)+"...":g,b.draglayer.append($("<div>").text(g)),!1}}})});this.draglayer.show();this.drag_active=!0;this.triggerEvent("dragstart")}this.drag_active&&this.draglayer&&(d=rcube_event.get_mouse_pos(c),this.draglayer.css({left:d.x+20+"px",top:d.y-5+(bw.ie?document.documentElement.scrollTop:0)+"px"}),this.triggerEvent("dragmove",c?c:window.event));return this.drag_start=!1},drag_mouse_up:function(a){document.onmousemove=null;if("touchend"==a.type&&1!=a.changedTouches.length){return rcube_event.cancel(a)}this.draglayer&&this.draglayer.is(":visible")&&(this.drag_start_pos?this.draglayer.animate(this.drag_start_pos,300,"swing").hide(20):this.draglayer.hide());this.drag_active&&this.focus();this.drag_active=!1;rcube_event.remove_listener({event:"mousemove",object:this,method:"drag_mouse_move"});rcube_event.remove_listener({event:"mouseup",object:this,method:"drag_mouse_up"});bw.touch&&(rcube_event.remove_listener({event:"touchmove",object:this,method:"drag_mouse_move"}),rcube_event.remove_listener({event:"touchend",object:this,method:"drag_mouse_up"}));this.del_dragfix();this.triggerEvent("dragend",a);return rcube_event.cancel(a)},column_drag_mouse_move:function(c){if(this.drag_start){var d=rcube_event.get_mouse_pos(c);if(!this.drag_mouse_start||3>Math.abs(d.x-this.drag_mouse_start.x)&&3>Math.abs(d.y-this.drag_mouse_start.y)){return !1}if(!this.col_draglayer){d=$(this.list).offset();var a=this.thead.rows[0].cells;d.top+=this.list.scrollTop+this.list.parentNode.scrollTop;this.col_draglayer=$("<div>").attr("id","rcmcoldraglayer").css(d).css({position:"absolute","z-index":2001,"background-color":"white",opacity:0.75,height:this.frame.offsetHeight-2+"px",width:this.frame.offsetWidth-2+"px"}).appendTo(document.body).append($("<div>").attr("id","rcmcolumnindicator").css({position:"absolute","border-right":"2px dotted #555","z-index":2002,height:this.frame.offsetHeight-2+"px"}));this.cols=[];this.list_pos=this.list_min_pos=d.left;for(d=0;d<a.length;d++){this.cols[d]=a[d].offsetWidth,null!==this.column_fixed&&d<=this.column_fixed&&(this.list_min_pos+=this.cols[d])}}this.col_draglayer.show();this.col_drag_active=!0;this.triggerEvent("column_dragstart")}if(this.col_drag_active&&this.col_draglayer){a=0;var b=rcube_event.get_mouse_pos(c);for(d=0;d<this.cols.length;d++){if(b.x>=this.cols[d]/2+this.list_pos+a){a+=this.cols[d]}else{break}}0==d&&this.list_min_pos>b.x?a=this.list_min_pos-this.list_pos:this.list.rowcount||d!=this.cols.length||(a-=2);$("#rcmcolumnindicator").css({width:a+"px"});this.triggerEvent("column_dragmove",c?c:window.event)}return this.drag_start=!1},column_drag_mouse_up:function(c){document.onmousemove=null;this.col_draglayer&&(this.col_draglayer.remove(),this.col_draglayer=null);rcube_event.remove_listener({event:"mousemove",object:this,method:"column_drag_mouse_move"});rcube_event.remove_listener({event:"mouseup",object:this,method:"column_drag_mouse_up"});this.del_dragfix();if(this.col_drag_active&&(this.col_drag_active=!1,this.focus(),this.triggerEvent("column_dragend",c),null!==this.selected_column&&this.cols&&this.cols.length)){var d,a=0,b=rcube_event.get_mouse_pos(c);for(d=0;d<this.cols.length;d++){if(b.x>=this.cols[d]/2+this.list_pos+a){a+=this.cols[d]}else{break}}d!=this.selected_column&&d!=this.selected_column+1&&this.column_replace(this.selected_column,d)}return rcube_event.cancel(c)},row_children:function(b){if(!this.rows[b]||!this.rows[b].has_children){return[]}var c=[],a=this.rows[b].depth;for(b=this.rows[b].obj.nextSibling;b;){if(1==b.nodeType&&(r=this.rows[b.uid])){if(!r.depth||r.depth<=a){break}c.push(r.uid)}b=b.nextSibling}return c},add_dragfix:function(){$("iframe").each(function(){$('<div class="iframe-dragdrop-fix"></div>').css({background:"#fff",width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1000}).css($(this).offset()).appendTo(document.body)})},del_dragfix:function(){$("div.iframe-dragdrop-fix").remove()},column_replace:function(e,f){if(this.thead&&this.thead.rows){var a=this.thead.rows[0].cells;var b=a[e],c=a[f],d=document.createElement("td");c?a[0].parentNode.insertBefore(d,c):a[0].parentNode.appendChild(d);a[0].parentNode.replaceChild(b,d);r=0;for(a=this.tbody.rows.length;r<a;r++){row=this.tbody.rows[r],b=row.cells[e],c=row.cells[f],d=document.createElement("td"),c?row.insertBefore(d,c):row.appendChild(d),row.replaceChild(b,d)}this.subject_col==e?this.subject_col=f>e?f-1:f:this.subject_col<e&&f<=this.subject_col?this.subject_col++:this.subject_col>e&&f>=this.subject_col&&this.subject_col--;this.fixed_header&&this.init_header();this.triggerEvent("column_replace")}}};rcube_list_widget.prototype.addEventListener=rcube_event_engine.prototype.addEventListener;rcube_list_widget.prototype.removeEventListener=rcube_event_engine.prototype.removeEventListener;rcube_list_widget.prototype.triggerEvent=rcube_event_engine.prototype.triggerEvent;rcube_list_widget._instances=[];