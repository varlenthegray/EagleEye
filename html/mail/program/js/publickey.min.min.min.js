"use strict";(function(b){var a=["https://keys.fedoraproject.org/","https://keybase.io/"];var c=function(d){this.keyservers=d||a};c.prototype.get=function(g,e,j,d){if(j===undefined){j=0}if(j>=this.keyservers.length){return e(null,d||404)}var i=this.keyservers[j];var h=this;if(i.indexOf("https://keybase.io/")===0){if(g.indexOf("0x")===0){g=g.substr(2)}var f=new XMLHttpRequest();f.open("get","https://keybase.io/_/api/1.0/user/lookup.json?fields=public_keys&key_fingerprint="+g);f.onload=function(){if(f.status===200){var k=JSON.parse(f.responseText);if(k.status.code!==0){return h.get(g,e,j+1,k.status.code)}if(k.them.length===0){return h.get(g,e,j+1,404)}var l=k.them[0]["public_keys"]["primary"]["bundle"];return e(l,null)}else{return h.get(g,e,j+1,f.status)}};f.send()}else{if(g.indexOf("0x")!==0){g="0x"+g}var f=new XMLHttpRequest();f.open("get",i+"pks/lookup?op=get&options=mr&search="+g);f.onload=function(){if(f.status===200){return e(f.responseText,null)}else{return h.get(g,e,j+1,f.status)}};f.send()}};c.prototype.search=function(n,e,v,s,o){if(v===undefined){v=0}if(s===undefined){s=[]}if(v>=this.keyservers.length){if(s.length===0){return e(null,o||404)}else{var r={};for(var t=0;t<s.length;t++){var q=s[t];if(r[q.keyid]!==undefined){for(var d=0;d<q.uids.length;d++){var l=false;for(var g=0;g<r[q.keyid]["uids"].length;g++){if(r[q.keyid]["uids"][g]["uid"]===q.uids[d]){l=true;break}}if(!l){r[q.keyid]["uids"].push(q.uids[d])}}}else{r[q.keyid]=q}}var j=[];for(var t=0;t<s.length;t++){var q=s[t];if(r[q.keyid]!==undefined){j.push(r[q.keyid]);delete (r[q.keyid])}}return e(j,null)}}var p=this.keyservers[v];var h=this;if(p.indexOf("https://keybase.io/")===0){var f=new XMLHttpRequest();f.open("get","https://keybase.io/_/api/1.0/user/autocomplete.json?q="+encodeURIComponent(n));f.onload=function(){if(f.status===200){var x=JSON.parse(f.responseText);if(x.status.code!==0){return h.search(n,e,v+1,s,x.status.code)}if(x.completions.length===0){return h.search(n,e,v+1,s,404)}var k=[];for(var m=0;m<x.completions.length;m++){var i=x.completions[m]["components"];if(i.key_fingerprint===undefined){continue}var w={keyid:i.key_fingerprint.val.toUpperCase(),href:"https://keybase.io/"+i.username.val+"/key.asc",info:"https://keybase.io/"+i.username.val,algo:i.key_fingerprint.algo,keylen:i.key_fingerprint.nbits,creationdate:null,expirationdate:null,revoked:false,disabled:false,expired:false,uids:[{uid:i.username.val+" on Keybase <https://keybase.io/"+i.username.val+">",creationdate:null,expirationdate:null,revoked:false,disabled:false,expired:false}]};if(i.full_name!==undefined){w.uids.push({uid:"Full Name: "+i.full_name.val,creationdate:null,expirationdate:null,revoked:false,disabled:false,expired:false})}if(i.twitter!==undefined){w.uids.push({uid:i.twitter.val+" on Twitter <https://twitter.com/"+i.twitter.val+">",creationdate:null,expirationdate:null,revoked:false,disabled:false,expired:false})}if(i.github!==undefined){w.uids.push({uid:i.github.val+" on Github <https://github.com/"+i.github.val+">",creationdate:null,expirationdate:null,revoked:false,disabled:false,expired:false})}if(i.reddit!==undefined){w.uids.push({uid:i.reddit.val+" on Github <https://reddit.com/u/"+i.reddit.val+">",creationdate:null,expirationdate:null,revoked:false,disabled:false,expired:false})}if(i.hackernews!==undefined){w.uids.push({uid:i.hackernews.val+" on Hacker News <https://news.ycombinator.com/user?id="+i.hackernews.val+">",creationdate:null,expirationdate:null,revoked:false,disabled:false,expired:false})}if(i.coinbase!==undefined){w.uids.push({uid:i.coinbase.val+" on Coinbase <https://www.coinbase.com/"+i.coinbase.val+">",creationdate:null,expirationdate:null,revoked:false,disabled:false,expired:false})}if(i.websites!==undefined){for(var u=0;u<i.websites.length;u++){w.uids.push({uid:"Owns "+i.websites[u]["val"],creationdate:null,expirationdate:null,revoked:false,disabled:false,expired:false})}}k.push(w)}s=s.concat(k);return h.search(n,e,v+1,s,null)}else{return h.search(n,e,v+1,s,f.status)}};f.send()}else{var f=new XMLHttpRequest();f.open("get",p+"pks/lookup?op=index&options=mr&fingerprint=on&search="+encodeURIComponent(n));f.onload=function(){if(f.status===200){var i=[];var x=f.responseText.split("\n");var w=undefined;for(var k=0;k<x.length;k++){var m=x[k].trim();if(m.indexOf("pub:")==0){if(w!==undefined){i.push(w)}var u=m.split(":");w={keyid:u[1],href:p+"pks/lookup?op=get&options=mr&search=0x"+u[1],info:p+"pks/lookup?op=vindex&search=0x"+u[1],algo:u[2]===""?null:parseInt(u[2]),keylen:u[3]===""?null:parseInt(u[3]),creationdate:u[4]===""?null:parseInt(u[4]),expirationdate:u[5]===""?null:parseInt(u[5]),revoked:u[6].indexOf("r")!==-1,disabled:u[6].indexOf("d")!==-1,expired:u[6].indexOf("e")!==-1,uids:[]}}if(m.indexOf("uid:")==0){var u=m.split(":");w.uids.push({uid:decodeURIComponent(u[1]),creationdate:u[2]===""?null:parseInt(u[2]),expirationdate:u[3]===""?null:parseInt(u[3]),revoked:u[4].indexOf("r")!==-1,disabled:u[4].indexOf("d")!==-1,expired:u[4].indexOf("e")!==-1})}}i.push(w);s=s.concat(i);return h.search(n,e,v+1,s,null)}else{return h.search(n,e,v+1,s,f.status)}};f.send()}};b.PublicKey=c})(typeof exports==="undefined"?this:exports);