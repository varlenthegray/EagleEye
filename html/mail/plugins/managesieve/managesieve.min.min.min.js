window.rcmail&&rcmail.addEventListener("init",function(a){"mail"==rcmail.env.task&&("show"!=rcmail.env.action?rcmail.env.message_commands.push("managesieve-create"):rcmail.enable_command("managesieve-create",!0));"mail"!=rcmail.env.task&&!rcmail.env.action.startsWith("plugin.managesieve")||rcmail.env.framed||(rcmail.env.ms_tip_layer=$('<div id="managesieve-tip" class="popupmenu"></div>'),rcmail.env.ms_tip_layer.appendTo(document.body));rcmail.register_command("plugin.managesieve-save",function(){rcmail.managesieve_save()});rcmail.register_command("plugin.managesieve-act",function(){rcmail.managesieve_act()});rcmail.register_command("plugin.managesieve-add",function(){rcmail.managesieve_add()});rcmail.register_command("plugin.managesieve-del",function(){rcmail.managesieve_del()});rcmail.register_command("plugin.managesieve-move",function(){rcmail.managesieve_move()});rcmail.register_command("plugin.managesieve-setadd",function(){rcmail.managesieve_setadd()});rcmail.register_command("plugin.managesieve-setdel",function(){rcmail.managesieve_setdel()});rcmail.register_command("plugin.managesieve-setact",function(){rcmail.managesieve_setact()});rcmail.register_command("plugin.managesieve-setget",function(){rcmail.managesieve_setget()});rcmail.register_command("plugin.managesieve-seteditraw",function(){rcmail.managesieve_seteditraw()});rcmail.env.action.startsWith("plugin.managesieve")&&(rcmail.gui_objects.sieveform?(rcmail.enable_command("plugin.managesieve-save",!0),sieve_form_init()):rcmail.gui_objects.sievesetrawform?(rcmail.enable_command("plugin.managesieve-save",!0),sieve_raw_editor_init()):rcmail.enable_command("plugin.managesieve-add","plugin.managesieve-setadd",!rcmail.env.sieveconnerror),a=rcmail.env.currentset,rcmail.gui_objects.filterslist&&(rcmail.filters_list=new rcube_list_widget(rcmail.gui_objects.filterslist,{multiselect:!1,draggable:!0,keyboard:!0}),rcmail.filters_list.addEventListener("select",function(b){rcmail.managesieve_select(b)}).addEventListener("dragstart",function(b){rcmail.managesieve_dragstart(b)}).addEventListener("dragend",function(b){rcmail.managesieve_dragend(b)}).addEventListener("initrow",function(b){b.obj.onmouseover=function(){rcmail.managesieve_focus_filter(b)};b.obj.onmouseout=function(){rcmail.managesieve_unfocus_filter(b)}}).init()),rcmail.gui_objects.filtersetslist&&(rcmail.filtersets_list=new rcube_list_widget(rcmail.gui_objects.filtersetslist,{multiselect:!1,draggable:!1,keyboard:!0}),rcmail.filtersets_list.init().focus(),null!=a&&(a=rcmail.managesieve_setid(a),rcmail.filtersets_list.select(a)),rcmail.filtersets_list.addEventListener("select",function(b){rcmail.managesieve_setselect(b)}),a=rcmail.filtersets_list.rowcount,rcmail.enable_command("plugin.managesieve-set",!0),rcmail.enable_command("plugin.managesieve-setact","plugin.managesieve-setget",0<a),rcmail.enable_command("plugin.managesieve-setdel",1<a),rcmail.enable_command("plugin.managesieve-seteditraw",0<a&&rcmail.env.raw_sieve_editor),$("tr",rcmail.gui_objects.filtersetslist).each(function(c,b){rcmail.managesieve_fixdragend(b)})));rcmail.gui_objects.sieveform&&rcmail.env.rule_disabled&&$("#disabled").attr("checked",!0)});rcube_webmail.prototype.managesieve_add=function(){this.load_managesieveframe("",!0)};rcube_webmail.prototype.managesieve_del=function(){var a=this.filters_list.get_single_selection();if(confirm(this.get_label("managesieve.filterdeleteconfirm"))){var b=this.set_busy(!0,"loading");this.http_post("plugin.managesieve-action","_act=delete&_fid="+this.filters_list.rows[a].uid,b)}};rcube_webmail.prototype.managesieve_act=function(){var a=this.filters_list.get_single_selection(),b=this.set_busy(!0,"loading");this.http_post("plugin.managesieve-action","_act=act&_fid="+this.filters_list.rows[a].uid,b)};rcube_webmail.prototype.managesieve_select=function(a){var b=a.get_single_selection();null!=b&&(b=a.rows[b].uid,this.load_managesieveframe("_fid="+b));this.enable_command("plugin.managesieve-act","plugin.managesieve-del","undefined"!=typeof b&&null!=b)};rcube_webmail.prototype.managesieve_setselect=function(a){this.show_contentframe(!1);this.filters_list.clear(!0);this.enable_command("plugin.managesieve-setdel",1<a.rowcount);this.enable_command("plugin.managesieve-setact","plugin.managesieve-setget",0<a.rowcount);this.enable_command("plugin.managesieve-seteditraw",0<a.rowcount&&this.env.raw_sieve_editor);a=a.get_single_selection();null!=a&&this.managesieve_list(this.env.filtersets[a])};rcube_webmail.prototype.managesieve_rowid=function(b){var c,a=this.filters_list.rows;for(c in a){if(null!=a[c]&&a[c].uid==b){return c}}};rcube_webmail.prototype.managesieve_setid=function(a){for(var b in this.env.filtersets){if(this.env.filtersets[b]==a){return b}}};rcube_webmail.prototype.managesieve_list=function(a){var b=this.set_busy(!0,"loading");this.http_post("plugin.managesieve-action","_act=list&_set="+urlencode(a),b)};rcube_webmail.prototype.managesieve_setget=function(){var a=this.filtersets_list.get_single_selection();this.goto_url("plugin.managesieve-action",{_act:"setget",_set:this.env.filtersets[a]},!1,!0)};rcube_webmail.prototype.managesieve_setact=function(){var b=this.filtersets_list.get_single_selection(),c=this.set_busy(!0,"loading"),a=this.env.filtersets[b];b=$("#rcmrow"+b).hasClass("disabled")?"setact":"deact";this.http_post("plugin.managesieve-action","_act="+b+"&_set="+urlencode(a),c)};rcube_webmail.prototype.managesieve_setdel=function(){if(!confirm(this.get_label("managesieve.setdeleteconfirm"))){return !1}var a=this.filtersets_list.get_single_selection(),b=this.set_busy(!0,"loading");this.http_post("plugin.managesieve-action","_act=setdel&_set="+urlencode(this.env.filtersets[a]),b)};rcube_webmail.prototype.managesieve_seteditraw=function(){var a=this.filtersets_list.get_single_selection();this.load_managesieveframe("_seteditraw=1&_set="+urlencode(this.env.filtersets[a]),!0)};rcube_webmail.prototype.managesieve_setadd=function(){this.load_managesieveframe("_newset=1",!0)};rcube_webmail.prototype.managesieve_updatelist=function(c,e){this.set_busy(!0);switch(c){case"del":var g=e.id;c=this.filters_list;c.remove_row(this.managesieve_rowid(e.id));this.show_contentframe(!1);this.reset_filters_list();$("tr",this.filters_list.list).each(function(){if("none"==this.style.display){$(this).detach()}else{var f=this.id.substr(6);$(this).off();f>g&&(this.uid=f-1,$(this).attr("id","rcmrow"+this.uid))}});c.init();break;case"update":var l=$("#rcmrow"+this.managesieve_rowid(e.id));e.name&&$("td",l).text(e.name);e.disabled?l.addClass("disabled"):l.removeClass("disabled");$("#disabled",$("iframe").contents()).prop("checked",e.disabled);break;case"add":c=this.filters_list;l=$('<tr><td class="name"></td></tr>');$("td",l).text(e.name);l.attr("id","rcmrow"+e.id);e.disabled&&l.addClass("disabled");c.insert_row(l.get(0));c.highlight_row(e.id);this.enable_command("plugin.managesieve-del","plugin.managesieve-act",!0);break;case"list":c=this.filters_list;e.clear&&c.clear();for(l in e.list){var a=e.list[l];var b=document.createElement("TR");var d=document.createElement("TD");$(d).text(a.name);d.className="name";b.id="rcmrow"+a.id;a["class"]&&(b.className=a["class"]);b.appendChild(d);c.insert_row(b)}e.set?c.highlight_row(e.set):this.enable_command("plugin.managesieve-del","plugin.managesieve-act",!1);break;case"setact":g=this.managesieve_setid(e.name);l=$("#rcmrow"+g);e.active?(e.all&&$("tr",this.gui_objects.filtersetslist).addClass("disabled"),l.removeClass("disabled")):l.addClass("disabled");break;case"setdel":g=this.managesieve_setid(e.name);this.filtersets_list.remove_row(g);this.filters_list.clear();this.show_contentframe(!1);this.enable_command("plugin.managesieve-setdel","plugin.managesieve-setact","plugin.managesieve-setget",!1);delete this.env.filtersets[g];break;case"setadd":g="S"+(new Date).getTime();c=this.filtersets_list;l=$('<tr class="disabled"><td class="name"></td></tr>');$("td",l).text(e.name);l.attr("id","rcmrow"+g);this.env.filtersets[g]=e.name;c.insert_row(l.get(0));e.index!=c.rowcount-1&&(l.detach(),e=$("tr:visible",c.list).get(e.index),l.insertBefore(e));c.select(g);this.managesieve_fixdragend(l);break;case"refresh":this.reset_filters_list(!0)}this.set_busy(!1)};rcube_webmail.prototype.reset_filters_list=function(a){this.filters_list.clear_selection();this.enable_command("plugin.managesieve-act","plugin.managesieve-del",!1);a&&(a=this.filtersets_list.get_single_selection(),this.filters_list.clear(!0),this.managesieve_list(this.env.filtersets[a]))};rcube_webmail.prototype.load_managesieveframe=function(a,b){b&&this.reset_filters_list();this.env.contentframe&&window.frames&&window.frames[this.env.contentframe]&&(b=this.set_busy(!0,"loading"),target=window.frames[this.env.contentframe],target.location.href=this.env.comm_path+"&_action=plugin.managesieve-action&_framed=1&_unlock="+b+(a?"&"+a:""))};rcube_webmail.prototype.managesieve_dragstart=function(a){a=this.filters_list.get_single_selection();this.drag_active=!0;this.drag_filter=a};rcube_webmail.prototype.managesieve_dragend=function(a){this.drag_active&&(this.drag_filter_target&&(a=this.set_busy(!0,"loading"),this.show_contentframe(!1),this.http_post("plugin.managesieve-action","_act=move&_fid="+this.drag_filter+"&_to="+this.drag_filter_target,a)),this.drag_active=!1)};rcube_webmail.prototype.managesieve_fixdragend=function(a){var b=this;$(a).on("mouseup"+(bw.iphone||bw.ipad?" touchend":""),function(c){b.drag_active&&b.filters_list.drag_mouse_up(c)})};rcube_webmail.prototype.managesieve_focus_filter=function(a){var b=a.id.replace(/^rcmrow/,"");this.drag_active&&b!=this.drag_filter&&(this.drag_filter_target=b,$(a.obj).addClass(b<this.drag_filter?"filtermoveup":"filtermovedown"))};rcube_webmail.prototype.managesieve_unfocus_filter=function(a){this.drag_active&&($(a.obj).removeClass("filtermoveup filtermovedown"),this.drag_filter_target=null)};rcube_webmail.prototype.managesieve_save=function(){if("plugin.managesieve-vacation"==this.env.action){var a=$(this.gui_objects.sieveform).serialize();this.http_post("plugin.managesieve-vacation",a,this.display_message(this.get_label("managesieve.vacation.saving"),"loading"))}else{this.gui_objects.sieveform?(parent.rcmail&&parent.rcmail.filters_list&&"filtersetform"!=this.gui_objects.sieveform.name&&(a=parent.rcmail.filters_list.get_single_selection(),null!=a&&(this.gui_objects.sieveform.elements._fid.value=parent.rcmail.filters_list.rows[a].uid)),this.gui_objects.sieveform.submit()):this.gui_objects.sievesetrawform&&this.gui_objects.sievesetrawform.submit()}};rcube_webmail.prototype.managesieve_ruleadd=function(a){this.http_post("plugin.managesieve-action","_act=ruleadd&_rid="+a)};rcube_webmail.prototype.managesieve_rulefill=function(d,e,a){if(""!=d){var b=document.getElementById("rules"),c=document.createElement("div");this.managesieve_insertrow(b,c,a);c.setAttribute("id","rulerow"+e);c.className="rulerow";c.innerHTML=d;$('textarea[data-type="list"]',c).each(function(){smart_field_init(this)});this.managesieve_formbuttons(b)}};rcube_webmail.prototype.managesieve_ruledel=function(a){!$("#ruledel"+a).hasClass("disabled")&&confirm(this.get_label("managesieve.ruledeleteconfirm"))&&(a=document.getElementById("rulerow"+a),a.parentNode.removeChild(a),this.managesieve_formbuttons(document.getElementById("rules")))};rcube_webmail.prototype.managesieve_actionadd=function(a){this.http_post("plugin.managesieve-action","_act=actionadd&_aid="+a)};rcube_webmail.prototype.managesieve_actionfill=function(d,e,a){if(""!=d){var b=document.getElementById("actions"),c=document.createElement("div");this.managesieve_insertrow(b,c,a);c.className="actionrow";c.setAttribute("id","actionrow"+e);c.innerHTML=d;$('textarea[data-type="list"]',c).each(function(){smart_field_init(this)});this.managesieve_formbuttons(b)}};rcube_webmail.prototype.managesieve_actiondel=function(a){!$("#actiondel"+a).hasClass("disabled")&&confirm(this.get_label("managesieve.actiondeleteconfirm"))&&(a=document.getElementById("actionrow"+a),a.parentNode.removeChild(a),this.managesieve_formbuttons(document.getElementById("actions")))};rcube_webmail.prototype.managesieve_insertrow=function(c,d,a){for(var b=0;b<c.childNodes.length&&c.childNodes[b].id!=("rules"==c.id?"rulerow":"actionrow")+a;b++){}c.childNodes[b+1]?c.insertBefore(d,c.childNodes[b+1]):c.appendChild(d)};rcube_webmail.prototype.managesieve_formbuttons=function(b){var c,a=[];for(c=0;c<b.childNodes.length;c++){"rules"==b.id&&b.childNodes[c].id?/rulerow/.test(b.childNodes[c].id)&&a.push("ruledel"+b.childNodes[c].id.replace(/rulerow/,"")):b.childNodes[c].id&&/actionrow/.test(b.childNodes[c].id)&&a.push("actiondel"+b.childNodes[c].id.replace(/actionrow/,""))}for(c=0;c<a.length;c++){b=document.getElementById(a[c]),0<c||1<a.length?$(b).removeClass("disabled"):$(b).addClass("disabled")}};rcube_webmail.prototype.managesieve_vacation_addresses=function(a){var b=this.set_busy(!0,"loading");this.http_post("plugin.managesieve-action",{_act:"addresses",_aid:a},b)};rcube_webmail.prototype.managesieve_vacation_addresses_update=function(a,b){a=$("#vacation_addresses,#action_addresses"+(a||""));smart_field_reset(a.get(0),b)};function rule_header_select(t){var a=document.getElementById("header"+t),b=document.getElementById("rule_size"+t),c=document.getElementById("rule_message"+t),e=document.getElementById("rule_op"+t),l=document.getElementById("custom_header"+t+"_list"),n=document.getElementById("custom_var"+t+"_list"),m=document.getElementById("rule_mod"+t),p=document.getElementById("rule_trans"+t),f=document.getElementById("rule_comp"+t),g=document.getElementById("rule_date_part"+t),q=document.getElementById("rule_date_header_div"+t),r=$("#rule_op"+t),k=a.value,d=[e,l,n,m,p,f,b];"size"==k?(c&&d.push(c),$.each(d,function(){this.style.display="none"}),b.style.display="inline"):"message"==k&&c?($.each(d,function(){this.style.display="none"}),c.style.display="inline"):(l.style.display="..."!=k?"none":"inline-block",n.style.display="string"!=k?"none":"inline-block",b.style.display="none",e.style.display="inline",f.style.display="",m.style.display="body"==k||"currentdate"==k||"date"==k||"string"==k?"none":"block",p.style.display="body"==k?"block":"none",c&&(c.style.display="message"==k?"block":"none"));g&&(g.style.display="currentdate"==k||"date"==k?"inline":"none");q&&(q.style.display="date"==k?"":"none");$('[value="exists"],[value="notexists"]',r).prop("disabled","string"==k);r.val()||r.val("contains");rule_op_select(e,t,k);rule_mod_select(t,k);a.style.width="..."==k?"40px":""}function rule_op_select(c,d,a){var b=document.getElementById("rule_target"+d+"_list");a||(a=document.getElementById("header"+d).value);b.style.display=c.value.match(/^(exists|notexists)$/)||a.match(/^(size|message)$/)?"none":"inline-block"}function rule_trans_select(a){var b=document.getElementById("rule_trans_op"+a);document.getElementById("rule_trans_type"+a).style.display="content"!=b.value?"none":"inline"}function rule_mod_select(e,g){var a=document.getElementById("rule_mod_op"+e),b=document.getElementById("rule_mod_type"+e),c=document.getElementById("rule_duplicate_div"+e),d=document.getElementById("rule_index_div"+e);g||(g=document.getElementById("header"+e).value);b.style.display="address"!=a.value&&"envelope"!=a.value?"none":"inline";d&&(d.style.display=g.match(/^(body|currentdate|size|message|string)$/)||"envelope"==a.value?"none":"");c&&(c.style.display="message"==g?"":"none")}function rule_join_radio(a){$("#rules").css("display","any"==a?"none":"block")}function rule_adv_switch(b,c){c=$(c);var a=c.hasClass("hide");b=$("#rule_advanced"+b);a?(b.hide(),c.removeClass("hide").addClass("show")):(b.show(),c.removeClass("show").addClass("hide"))}function action_type_select(c){var d=document.getElementById("action_type"+c).value,a={};c={mailbox:document.getElementById("action_mailbox"+c),target:document.getElementById("redirect_target"+c),target_area:document.getElementById("action_target_area"+c),flags:document.getElementById("action_flags"+c),vacation:document.getElementById("action_vacation"+c),set:document.getElementById("action_set"+c),notify:document.getElementById("action_notify"+c)};"fileinto"==d||"fileinto_copy"==d?a.mailbox=1:"redirect"==d||"redirect_copy"==d?a.target=1:d.match(/^reject|ereject$/)?a.target_area=1:d.match(/^(add|set|remove)flag$/)?a.flags=1:"vacation"==d?a.vacation=1:"set"==d?a.set=1:"notify"==d&&(a.notify=1);for(var b in c){c[b].style.display=a[b]?"inline":"none"}}function vacation_action_select(){var a=$("#vacation_action").val();$("#action_target_span")["discard"==a||"keep"==a?"hide":"show"]()}function smart_field_init(c){var d=c.id+"_list",a=$('<span class="listarea"></span>'),b=c.value?c.value.split("\n"):[""];$("#"+d).length||($.each(b,function(e,f){a.append(smart_field_row(f,c.name,e,$(c).data("size")))}),a.attr("id",d),c=$(c),c.attr("disabled")?a.hide():c.prop("disabled",!0),c.after(a),c.hasClass("error")&&(a.addClass("error"),rcmail.managesieve_tip_register([[d,c.data("tip")]])))}function smart_field_row(c,d,a,b){a=$('<span class="listelement"><span class="reset"></span><input type="text"></span>');c={value:c,name:d+"[]"};b&&(c.size=b);$("input",a).attr(c).keydown(function(f){var g=$(this);if(13==f.which){f=g.attr("name").replace(/\[\]$/,"");var e=(new Date).getTime();f=smart_field_row("",f,e,b);g.parent().after(f);$("input",f).focus()}else{if((8==f.which||46==f.which)&&""==g.val()&&(g=g.parent(),1<g.parent().children().length)){return g.prev().length?g.prev().children("input").focus():g.next().children("input").focus(),g.remove(),!1}}});$('span[class="reset"]',a).click(function(){var e=$(this.parentNode);1<e.parent().children().length?e.remove():$("input",e).val("").focus()});return a}function smart_field_reset(a,b){b=b.length?b:[""];area=$("#"+(a.id+"_list"));area.empty();$.each(b,function(c,d){area.append(smart_field_row(d,a.name,c,$(a).data("size")))})}rcube_webmail.prototype.managesieve_tip_register=function(c){var d,a=parent.rcmail,b=a?parent.rcmail.env.ms_tip_layer:rcmail.env.ms_tip_layer;for(d in c){$("#"+c[d][0]).data("tip",c[d][1]).mouseleave(function(e){b.hide()}).mouseenter(function(f){f=$(this);var g=f.offset(),k=g.left,e=g.top-12,i=f.width();a&&(g=$("mail"==rcmail.env.task?"#sievefilterform > iframe":"#filter-box",parent.document).offset(),e+=g.top,k+=g.left);b.html(f.data("tip"));e-=b.height();b.css({left:k,top:e,minWidth:i-2+"px"}).show()})}};function sieve_formattime(e,g){var a,b="",c=rcmail.env.time_format||"H:i";for(a=0;a<c.length;a++){var d=c.charAt(a);switch(d){case"a":b+=12<=e?"pm":"am";break;case"A":b+=12<=e?"PM":"AM";break;case"g":case"h":b+=("h"==d&&10>e?"0":"")+e;break;case"G":b+=e;break;case"H":b+=(10>e?"0":"")+e;break;case"i":b+=(10>g?"0":"")+g;break;case"s":b+="00";default:b+=d}}return b}function sieve_form_init(){var a=rcmail.gui_objects.sieveform;"plugin.managesieve"==rcmail.env.action&&"mail"==rcmail.env.task&&parent.rcmail.managesieve_dialog_resize(a);$('input[type="text"]:first',a).focus();$('textarea[data-type="list"]',a).each(function(){smart_field_init(this)});$('[name="_header[]"]',a).each(function(){/([0-9]+)$/.test(this.id)&&rule_header_select(RegExp.$1)});$.datepicker&&rcmail.env.date_format&&($.datepicker.setDefaults({dateFormat:rcmail.env.date_format,changeMonth:!0,showOtherMonths:!0,selectOtherMonths:!0,onSelect:function(b){$(this).focus().val(b)}}),$("input.datepicker").datepicker());$("#vacation_timefrom, #vacation_timeto").attr("autocomplete","off").autocomplete({delay:100,minLength:1,source:function(c,b){var g=[];for(c=0;24>c;c++){g.push(sieve_formattime(c,0))}g.push(sieve_formattime(23,59));return b(g)},open:function(e,b){e=$(this);var j=e.val();b=e.autocomplete("widget").css("width","10em");var c=e.data("ui-autocomplete").menu;j&&j.length&&b.children().each(function(){var d=$(this);0==d.text().indexOf(j)&&c._scrollIntoView(d)})},select:function(c,b){$(this).val(b.item.value);return !1}}).click(function(){$(this).autocomplete("search",$(this).val()||" ")});$("input.error").each(function(){String(this.id).match(/([0-9]+)$/)&&$("#ruleadv"+RegExp.$1+".show").click()})}var cmeditor;function cmCreateErrorElem(a){var b=document.createElement("div");b.style.color="#822";b.innerHTML="\u25cf";b.title=a;return b}function cmScrollToError(){var a=$(".CodeMirror-lines .line-error"),b=$(".CodeMirror-scroll");a.parent();b.scrollTop(a.offset().top-b.offset().top-Math.round(b.height()/2))}function sieve_raw_editor_init(){var a=document.getElementById("rawfiltersettxt");a&&!cmeditor&&(cmeditor=CodeMirror.fromTextArea(a,{mode:"sieve",lineNumbers:!0,gutters:["CodeMirror-linenumbers","errorGutter"],styleActiveLine:!0}),$.each(rcmail.env.sieve_errors||[],function(c,b){var g=Number(b.line)-1;cmeditor.addLineClass(g,"background","line-error");cmeditor.setGutterMarker(g,"errorGutter",cmCreateErrorElem(b.msg));c||cmScrollToError()}))}rcube_webmail.prototype.managesieve_create=function(c){if(!c&&"show"!=this.env.action){var d=this.message_list.get_single_selection();c=this.set_busy(!0,"loading");this.http_post("plugin.managesieve-action",{_uid:d},c)}else{if(this.env.sieve_headers&&this.env.sieve_headers.length){var a={},b=$("#sievefilterform");b.length||(b=$('<div id="sievefilterform"></div>'),$("body").append(b));c="<fieldset><legend>"+this.get_label("managesieve.usedata")+"</legend><ul>";for(d in this.env.sieve_headers){c+='<li><input type="checkbox" name="headers[]" id="sievehdr'+d+'" value="'+d+'" checked="checked" /><label for="sievehdr'+d+'">'+this.env.sieve_headers[d][0]+":</label> "+this.env.sieve_headers[d][1]+"</li>"}b.html(c+"</ul></fieldset>");a[this.get_label("managesieve.nextstep")]=function(){var e=$('input[name="headers[]"]:checked',b);if(e.length){var f=rcmail.get_task_url("mail");f=rcmail.add_url(f,"_action","plugin.managesieve");f=rcmail.add_url(f,"_framed",1);e.map(function(){var g=rcmail.env.sieve_headers[this.value];f=rcmail.add_url(f,"r["+this.value+"]",g[0]+":"+g[1])});e=$("<iframe>").attr({src:f,frameborder:0});b.empty().append(e).dialog("widget").resize();a={};a[rcmail.get_label("save")]=function(){$("iframe",b).get(0).contentWindow.rcmail.managesieve_save()};b.dialog("option","buttons",a)}else{alert(rcmail.get_label("managesieve.nodata"))}};b.dialog({modal:!1,resizable:!0,closeOnEscape:!0,title:this.get_label("managesieve.newfilter"),close:function(){rcmail.managesieve_dialog_close()},buttons:a,minWidth:600,minHeight:300,height:250}).show();this.env.managesieve_dialog=b}}};rcube_webmail.prototype.managesieve_dialog_close=function(){var a=this.env.managesieve_dialog;a.html("");a.dialog("destroy").hide()};rcube_webmail.prototype.managesieve_dialog_resize=function(c){var d=this.env.managesieve_dialog,a=$(window),b=$(c);width=$("fieldset:first",c).width();height=b.height();w=a.width();h=a.height();d.dialog("option",{height:Math.min(h-20,height+120),width:Math.min(w-20,width+65)})};