window.rcmail&&rcmail.addEventListener("init",function(b){"mail"==rcmail.env.task&&("show"!=rcmail.env.action?rcmail.env.message_commands.push("managesieve-create"):rcmail.enable_command("managesieve-create",!0));"mail"!=rcmail.env.task&&!rcmail.env.action.startsWith("plugin.managesieve")||rcmail.env.framed||(rcmail.env.ms_tip_layer=$('<div id="managesieve-tip" class="popupmenu"></div>'),rcmail.env.ms_tip_layer.appendTo(document.body));rcmail.register_command("plugin.managesieve-save",function(){rcmail.managesieve_save()});rcmail.register_command("plugin.managesieve-act",function(){rcmail.managesieve_act()});rcmail.register_command("plugin.managesieve-add",function(){rcmail.managesieve_add()});rcmail.register_command("plugin.managesieve-del",function(){rcmail.managesieve_del()});rcmail.register_command("plugin.managesieve-move",function(){rcmail.managesieve_move()});rcmail.register_command("plugin.managesieve-setadd",function(){rcmail.managesieve_setadd()});rcmail.register_command("plugin.managesieve-setdel",function(){rcmail.managesieve_setdel()});rcmail.register_command("plugin.managesieve-setact",function(){rcmail.managesieve_setact()});rcmail.register_command("plugin.managesieve-setget",function(){rcmail.managesieve_setget()});rcmail.register_command("plugin.managesieve-seteditraw",function(){rcmail.managesieve_seteditraw()});rcmail.env.action.startsWith("plugin.managesieve")&&(rcmail.gui_objects.sieveform?(rcmail.enable_command("plugin.managesieve-save",!0),sieve_form_init()):rcmail.gui_objects.sievesetrawform?(rcmail.enable_command("plugin.managesieve-save",!0),sieve_raw_editor_init()):rcmail.enable_command("plugin.managesieve-add","plugin.managesieve-setadd",!rcmail.env.sieveconnerror),b=rcmail.env.currentset,rcmail.gui_objects.filterslist&&(rcmail.filters_list=new rcube_list_widget(rcmail.gui_objects.filterslist,{multiselect:!1,draggable:!0,keyboard:!0}),rcmail.filters_list.addEventListener("select",function(c){rcmail.managesieve_select(c)}).addEventListener("dragstart",function(c){rcmail.managesieve_dragstart(c)}).addEventListener("dragend",function(c){rcmail.managesieve_dragend(c)}).addEventListener("initrow",function(c){c.obj.onmouseover=function(){rcmail.managesieve_focus_filter(c)};c.obj.onmouseout=function(){rcmail.managesieve_unfocus_filter(c)}}).init()),rcmail.gui_objects.filtersetslist&&(rcmail.filtersets_list=new rcube_list_widget(rcmail.gui_objects.filtersetslist,{multiselect:!1,draggable:!1,keyboard:!0}),rcmail.filtersets_list.init().focus(),null!=b&&(b=rcmail.managesieve_setid(b),rcmail.filtersets_list.select(b)),rcmail.filtersets_list.addEventListener("select",function(c){rcmail.managesieve_setselect(c)}),b=rcmail.filtersets_list.rowcount,rcmail.enable_command("plugin.managesieve-set",!0),rcmail.enable_command("plugin.managesieve-setact","plugin.managesieve-setget",0<b),rcmail.enable_command("plugin.managesieve-setdel",1<b),rcmail.enable_command("plugin.managesieve-seteditraw",0<b&&rcmail.env.raw_sieve_editor),$("tr",rcmail.gui_objects.filtersetslist).each(function(d,e){rcmail.managesieve_fixdragend(e)})));rcmail.gui_objects.sieveform&&rcmail.env.rule_disabled&&$("#disabled").attr("checked",!0)});rcube_webmail.prototype.managesieve_add=function(){this.load_managesieveframe("",!0)};rcube_webmail.prototype.managesieve_del=function(){var d=this.filters_list.get_single_selection();if(confirm(this.get_label("managesieve.filterdeleteconfirm"))){var c=this.set_busy(!0,"loading");this.http_post("plugin.managesieve-action","_act=delete&_fid="+this.filters_list.rows[d].uid,c)}};rcube_webmail.prototype.managesieve_act=function(){var d=this.filters_list.get_single_selection(),c=this.set_busy(!0,"loading");this.http_post("plugin.managesieve-action","_act=act&_fid="+this.filters_list.rows[d].uid,c)};rcube_webmail.prototype.managesieve_select=function(d){var c=d.get_single_selection();null!=c&&(c=d.rows[c].uid,this.load_managesieveframe("_fid="+c));this.enable_command("plugin.managesieve-act","plugin.managesieve-del","undefined"!=typeof c&&null!=c)};rcube_webmail.prototype.managesieve_setselect=function(b){this.show_contentframe(!1);this.filters_list.clear(!0);this.enable_command("plugin.managesieve-setdel",1<b.rowcount);this.enable_command("plugin.managesieve-setact","plugin.managesieve-setget",0<b.rowcount);this.enable_command("plugin.managesieve-seteditraw",0<b.rowcount&&this.env.raw_sieve_editor);b=b.get_single_selection();null!=b&&this.managesieve_list(this.env.filtersets[b])};rcube_webmail.prototype.managesieve_rowid=function(e){var d,f=this.filters_list.rows;for(d in f){if(null!=f[d]&&f[d].uid==e){return d}}};rcube_webmail.prototype.managesieve_setid=function(d){for(var c in this.env.filtersets){if(this.env.filtersets[c]==d){return c}}};rcube_webmail.prototype.managesieve_list=function(d){var c=this.set_busy(!0,"loading");this.http_post("plugin.managesieve-action","_act=list&_set="+urlencode(d),c)};rcube_webmail.prototype.managesieve_setget=function(){var b=this.filtersets_list.get_single_selection();this.goto_url("plugin.managesieve-action",{_act:"setget",_set:this.env.filtersets[b]},!1,!0)};rcube_webmail.prototype.managesieve_setact=function(){var e=this.filtersets_list.get_single_selection(),d=this.set_busy(!0,"loading"),f=this.env.filtersets[e];e=$("#rcmrow"+e).hasClass("disabled")?"setact":"deact";this.http_post("plugin.managesieve-action","_act="+e+"&_set="+urlencode(f),d)};rcube_webmail.prototype.managesieve_setdel=function(){if(!confirm(this.get_label("managesieve.setdeleteconfirm"))){return !1}var d=this.filtersets_list.get_single_selection(),c=this.set_busy(!0,"loading");this.http_post("plugin.managesieve-action","_act=setdel&_set="+urlencode(this.env.filtersets[d]),c)};rcube_webmail.prototype.managesieve_seteditraw=function(){var b=this.filtersets_list.get_single_selection();this.load_managesieveframe("_seteditraw=1&_set="+urlencode(this.env.filtersets[b]),!0)};rcube_webmail.prototype.managesieve_setadd=function(){this.load_managesieveframe("_newset=1",!0)};rcube_webmail.prototype.managesieve_updatelist=function(j,f){this.set_busy(!0);switch(j){case"del":var o=f.id;j=this.filters_list;j.remove_row(this.managesieve_rowid(f.id));this.show_contentframe(!1);this.reset_filters_list();$("tr",this.filters_list.list).each(function(){if("none"==this.style.display){$(this).detach()}else{var b=this.id.substr(6);$(this).off();b>o&&(this.uid=b-1,$(this).attr("id","rcmrow"+this.uid))}});j.init();break;case"update":var n=$("#rcmrow"+this.managesieve_rowid(f.id));f.name&&$("td",n).text(f.name);f.disabled?n.addClass("disabled"):n.removeClass("disabled");$("#disabled",$("iframe").contents()).prop("checked",f.disabled);break;case"add":j=this.filters_list;n=$('<tr><td class="name"></td></tr>');$("td",n).text(f.name);n.attr("id","rcmrow"+f.id);f.disabled&&n.addClass("disabled");j.insert_row(n.get(0));j.highlight_row(f.id);this.enable_command("plugin.managesieve-del","plugin.managesieve-act",!0);break;case"list":j=this.filters_list;f.clear&&j.clear();for(n in f.list){var m=f.list[n];var k=document.createElement("TR");var i=document.createElement("TD");$(i).text(m.name);i.className="name";k.id="rcmrow"+m.id;m["class"]&&(k.className=m["class"]);k.appendChild(i);j.insert_row(k)}f.set?j.highlight_row(f.set):this.enable_command("plugin.managesieve-del","plugin.managesieve-act",!1);break;case"setact":o=this.managesieve_setid(f.name);n=$("#rcmrow"+o);f.active?(f.all&&$("tr",this.gui_objects.filtersetslist).addClass("disabled"),n.removeClass("disabled")):n.addClass("disabled");break;case"setdel":o=this.managesieve_setid(f.name);this.filtersets_list.remove_row(o);this.filters_list.clear();this.show_contentframe(!1);this.enable_command("plugin.managesieve-setdel","plugin.managesieve-setact","plugin.managesieve-setget",!1);delete this.env.filtersets[o];break;case"setadd":o="S"+(new Date).getTime();j=this.filtersets_list;n=$('<tr class="disabled"><td class="name"></td></tr>');$("td",n).text(f.name);n.attr("id","rcmrow"+o);this.env.filtersets[o]=f.name;j.insert_row(n.get(0));f.index!=j.rowcount-1&&(n.detach(),f=$("tr:visible",j.list).get(f.index),n.insertBefore(f));j.select(o);this.managesieve_fixdragend(n);break;case"refresh":this.reset_filters_list(!0)}this.set_busy(!1)};rcube_webmail.prototype.reset_filters_list=function(b){this.filters_list.clear_selection();this.enable_command("plugin.managesieve-act","plugin.managesieve-del",!1);b&&(b=this.filtersets_list.get_single_selection(),this.filters_list.clear(!0),this.managesieve_list(this.env.filtersets[b]))};rcube_webmail.prototype.load_managesieveframe=function(d,c){c&&this.reset_filters_list();this.env.contentframe&&window.frames&&window.frames[this.env.contentframe]&&(c=this.set_busy(!0,"loading"),target=window.frames[this.env.contentframe],target.location.href=this.env.comm_path+"&_action=plugin.managesieve-action&_framed=1&_unlock="+c+(d?"&"+d:""))};rcube_webmail.prototype.managesieve_dragstart=function(b){b=this.filters_list.get_single_selection();this.drag_active=!0;this.drag_filter=b};rcube_webmail.prototype.managesieve_dragend=function(b){this.drag_active&&(this.drag_filter_target&&(b=this.set_busy(!0,"loading"),this.show_contentframe(!1),this.http_post("plugin.managesieve-action","_act=move&_fid="+this.drag_filter+"&_to="+this.drag_filter_target,b)),this.drag_active=!1)};rcube_webmail.prototype.managesieve_fixdragend=function(d){var c=this;$(d).on("mouseup"+(bw.iphone||bw.ipad?" touchend":""),function(b){c.drag_active&&c.filters_list.drag_mouse_up(b)})};rcube_webmail.prototype.managesieve_focus_filter=function(d){var c=d.id.replace(/^rcmrow/,"");this.drag_active&&c!=this.drag_filter&&(this.drag_filter_target=c,$(d.obj).addClass(c<this.drag_filter?"filtermoveup":"filtermovedown"))};rcube_webmail.prototype.managesieve_unfocus_filter=function(b){this.drag_active&&($(b.obj).removeClass("filtermoveup filtermovedown"),this.drag_filter_target=null)};rcube_webmail.prototype.managesieve_save=function(){if("plugin.managesieve-vacation"==this.env.action){var b=$(this.gui_objects.sieveform).serialize();this.http_post("plugin.managesieve-vacation",b,this.display_message(this.get_label("managesieve.vacation.saving"),"loading"))}else{this.gui_objects.sieveform?(parent.rcmail&&parent.rcmail.filters_list&&"filtersetform"!=this.gui_objects.sieveform.name&&(b=parent.rcmail.filters_list.get_single_selection(),null!=b&&(this.gui_objects.sieveform.elements._fid.value=parent.rcmail.filters_list.rows[b].uid)),this.gui_objects.sieveform.submit()):this.gui_objects.sievesetrawform&&this.gui_objects.sievesetrawform.submit()}};rcube_webmail.prototype.managesieve_ruleadd=function(b){this.http_post("plugin.managesieve-action","_act=ruleadd&_rid="+b)};rcube_webmail.prototype.managesieve_rulefill=function(g,f,k){if(""!=g){var j=document.getElementById("rules"),i=document.createElement("div");this.managesieve_insertrow(j,i,k);i.setAttribute("id","rulerow"+f);i.className="rulerow";i.innerHTML=g;$('textarea[data-type="list"]',i).each(function(){smart_field_init(this)});this.managesieve_formbuttons(j)}};rcube_webmail.prototype.managesieve_ruledel=function(b){!$("#ruledel"+b).hasClass("disabled")&&confirm(this.get_label("managesieve.ruledeleteconfirm"))&&(b=document.getElementById("rulerow"+b),b.parentNode.removeChild(b),this.managesieve_formbuttons(document.getElementById("rules")))};rcube_webmail.prototype.managesieve_actionadd=function(b){this.http_post("plugin.managesieve-action","_act=actionadd&_aid="+b)};rcube_webmail.prototype.managesieve_actionfill=function(g,f,k){if(""!=g){var j=document.getElementById("actions"),i=document.createElement("div");this.managesieve_insertrow(j,i,k);i.className="actionrow";i.setAttribute("id","actionrow"+f);i.innerHTML=g;$('textarea[data-type="list"]',i).each(function(){smart_field_init(this)});this.managesieve_formbuttons(j)}};rcube_webmail.prototype.managesieve_actiondel=function(b){!$("#actiondel"+b).hasClass("disabled")&&confirm(this.get_label("managesieve.actiondeleteconfirm"))&&(b=document.getElementById("actionrow"+b),b.parentNode.removeChild(b),this.managesieve_formbuttons(document.getElementById("actions")))};rcube_webmail.prototype.managesieve_insertrow=function(f,e,i){for(var g=0;g<f.childNodes.length&&f.childNodes[g].id!=("rules"==f.id?"rulerow":"actionrow")+i;g++){}f.childNodes[g+1]?f.insertBefore(e,f.childNodes[g+1]):f.appendChild(e)};rcube_webmail.prototype.managesieve_formbuttons=function(e){var d,f=[];for(d=0;d<e.childNodes.length;d++){"rules"==e.id&&e.childNodes[d].id?/rulerow/.test(e.childNodes[d].id)&&f.push("ruledel"+e.childNodes[d].id.replace(/rulerow/,"")):e.childNodes[d].id&&/actionrow/.test(e.childNodes[d].id)&&f.push("actiondel"+e.childNodes[d].id.replace(/actionrow/,""))}for(d=0;d<f.length;d++){e=document.getElementById(f[d]),0<d||1<f.length?$(e).removeClass("disabled"):$(e).addClass("disabled")}};rcube_webmail.prototype.managesieve_vacation_addresses=function(d){var c=this.set_busy(!0,"loading");this.http_post("plugin.managesieve-action",{_act:"addresses",_aid:d},c)};rcube_webmail.prototype.managesieve_vacation_addresses_update=function(d,c){d=$("#vacation_addresses,#action_addresses"+(d||""));smart_field_reset(d.get(0),c)};function rule_header_select(E){var D=document.getElementById("header"+E),C=document.getElementById("rule_size"+E),B=document.getElementById("rule_message"+E),A=document.getElementById("rule_op"+E),y=document.getElementById("custom_header"+E+"_list"),v=document.getElementById("custom_var"+E+"_list"),x=document.getElementById("rule_mod"+E),u=document.getElementById("rule_trans"+E),j=document.getElementById("rule_comp"+E),i=document.getElementById("rule_date_part"+E),F=document.getElementById("rule_date_header_div"+E),s=$("#rule_op"+E),z=D.value,o=[A,y,v,x,u,j,C];"size"==z?(B&&o.push(B),$.each(o,function(){this.style.display="none"}),C.style.display="inline"):"message"==z&&B?($.each(o,function(){this.style.display="none"}),B.style.display="inline"):(y.style.display="..."!=z?"none":"inline-block",v.style.display="string"!=z?"none":"inline-block",C.style.display="none",A.style.display="inline",j.style.display="",x.style.display="body"==z||"currentdate"==z||"date"==z||"string"==z?"none":"block",u.style.display="body"==z?"block":"none",B&&(B.style.display="message"==z?"block":"none"));i&&(i.style.display="currentdate"==z||"date"==z?"inline":"none");F&&(F.style.display="date"==z?"":"none");$('[value="exists"],[value="notexists"]',s).prop("disabled","string"==z);s.val()||s.val("contains");rule_op_select(A,E,z);rule_mod_select(E,z);D.style.width="..."==z?"40px":""}function rule_op_select(f,e,i){var g=document.getElementById("rule_target"+e+"_list");i||(i=document.getElementById("header"+e).value);g.style.display=f.value.match(/^(exists|notexists)$/)||i.match(/^(size|message)$/)?"none":"inline-block"}function rule_trans_select(d){var c=document.getElementById("rule_trans_op"+d);document.getElementById("rule_trans_type"+d).style.display="content"!=c.value?"none":"inline"}function rule_mod_select(i,f){var m=document.getElementById("rule_mod_op"+i),l=document.getElementById("rule_mod_type"+i),k=document.getElementById("rule_duplicate_div"+i),j=document.getElementById("rule_index_div"+i);f||(f=document.getElementById("header"+i).value);l.style.display="address"!=m.value&&"envelope"!=m.value?"none":"inline";j&&(j.style.display=f.match(/^(body|currentdate|size|message|string)$/)||"envelope"==m.value?"none":"");k&&(k.style.display="message"==f?"":"none")}function rule_join_radio(b){$("#rules").css("display","any"==b?"none":"block")}function rule_adv_switch(e,d){d=$(d);var f=d.hasClass("hide");e=$("#rule_advanced"+e);f?(e.hide(),d.removeClass("hide").addClass("show")):(e.show(),d.removeClass("show").addClass("hide"))}function action_type_select(f){var e=document.getElementById("action_type"+f).value,i={};f={mailbox:document.getElementById("action_mailbox"+f),target:document.getElementById("redirect_target"+f),target_area:document.getElementById("action_target_area"+f),flags:document.getElementById("action_flags"+f),vacation:document.getElementById("action_vacation"+f),set:document.getElementById("action_set"+f),notify:document.getElementById("action_notify"+f)};"fileinto"==e||"fileinto_copy"==e?i.mailbox=1:"redirect"==e||"redirect_copy"==e?i.target=1:e.match(/^reject|ereject$/)?i.target_area=1:e.match(/^(add|set|remove)flag$/)?i.flags=1:"vacation"==e?i.vacation=1:"set"==e?i.set=1:"notify"==e&&(i.notify=1);for(var g in f){f[g].style.display=i[g]?"inline":"none"}}function vacation_action_select(){var b=$("#vacation_action").val();$("#action_target_span")["discard"==b||"keep"==b?"hide":"show"]()}function smart_field_init(f){var e=f.id+"_list",i=$('<span class="listarea"></span>'),g=f.value?f.value.split("\n"):[""];$("#"+e).length||($.each(g,function(a,c){i.append(smart_field_row(c,f.name,a,$(f).data("size")))}),i.attr("id",e),f=$(f),f.attr("disabled")?i.hide():f.prop("disabled",!0),f.after(i),f.hasClass("error")&&(i.addClass("error"),rcmail.managesieve_tip_register([[e,f.data("tip")]])))}function smart_field_row(f,e,i,g){i=$('<span class="listelement"><span class="reset"></span><input type="text"></span>');f={value:f,name:e+"[]"};g&&(f.size=g);$("input",i).attr(f).keydown(function(j){var d=$(this);if(13==j.which){j=d.attr("name").replace(/\[\]$/,"");var k=(new Date).getTime();j=smart_field_row("",j,k,g);d.parent().after(j);$("input",j).focus()}else{if((8==j.which||46==j.which)&&""==d.val()&&(d=d.parent(),1<d.parent().children().length)){return d.prev().length?d.prev().children("input").focus():d.next().children("input").focus(),d.remove(),!1}}});$('span[class="reset"]',i).click(function(){var b=$(this.parentNode);1<b.parent().children().length?b.remove():$("input",b).val("").focus()});return i}function smart_field_reset(d,c){c=c.length?c:[""];area=$("#"+(d.id+"_list"));area.empty();$.each(c,function(a,e){area.append(smart_field_row(e,d.name,a,$(d).data("size")))})}rcube_webmail.prototype.managesieve_tip_register=function(f){var e,i=parent.rcmail,g=i?parent.rcmail.env.ms_tip_layer:rcmail.env.ms_tip_layer;for(e in f){$("#"+f[e][0]).data("tip",f[e][1]).mouseleave(function(b){g.hide()}).mouseenter(function(j){j=$(this);var d=j.offset(),n=d.left,l=d.top-12,c=j.width();i&&(d=$("mail"==rcmail.env.task?"#sievefilterform > iframe":"#filter-box",parent.document).offset(),l+=d.top,n+=d.left);g.html(j.data("tip"));l-=g.height();g.css({left:n,top:l,minWidth:c-2+"px"}).show()})}};function sieve_formattime(i,f){var m,l="",k=rcmail.env.time_format||"H:i";for(m=0;m<k.length;m++){var j=k.charAt(m);switch(j){case"a":l+=12<=i?"pm":"am";break;case"A":l+=12<=i?"PM":"AM";break;case"g":case"h":l+=("h"==j&&10>i?"0":"")+i;break;case"G":l+=i;break;case"H":l+=(10>i?"0":"")+i;break;case"i":l+=(10>f?"0":"")+f;break;case"s":l+="00";default:l+=j}}return l}function sieve_form_init(){var b=rcmail.gui_objects.sieveform;"plugin.managesieve"==rcmail.env.action&&"mail"==rcmail.env.task&&parent.rcmail.managesieve_dialog_resize(b);$('input[type="text"]:first',b).focus();$('textarea[data-type="list"]',b).each(function(){smart_field_init(this)});$('[name="_header[]"]',b).each(function(){/([0-9]+)$/.test(this.id)&&rule_header_select(RegExp.$1)});$.datepicker&&rcmail.env.date_format&&($.datepicker.setDefaults({dateFormat:rcmail.env.date_format,changeMonth:!0,showOtherMonths:!0,selectOtherMonths:!0,onSelect:function(c){$(this).focus().val(c)}}),$("input.datepicker").datepicker());$("#vacation_timefrom, #vacation_timeto").attr("autocomplete","off").autocomplete({delay:100,minLength:1,source:function(e,f){var d=[];for(e=0;24>e;e++){d.push(sieve_formattime(e,0))}d.push(sieve_formattime(23,59));return f(d)},open:function(f,i){f=$(this);var d=f.val();i=f.autocomplete("widget").css("width","10em");var g=f.data("ui-autocomplete").menu;d&&d.length&&i.children().each(function(){var c=$(this);0==c.text().indexOf(d)&&g._scrollIntoView(c)})},select:function(d,e){$(this).val(e.item.value);return !1}}).click(function(){$(this).autocomplete("search",$(this).val()||" ")});$("input.error").each(function(){String(this.id).match(/([0-9]+)$/)&&$("#ruleadv"+RegExp.$1+".show").click()})}var cmeditor;function cmCreateErrorElem(d){var c=document.createElement("div");c.style.color="#822";c.innerHTML="\u25cf";c.title=d;return c}function cmScrollToError(){var d=$(".CodeMirror-lines .line-error"),c=$(".CodeMirror-scroll");d.parent();c.scrollTop(d.offset().top-c.offset().top-Math.round(c.height()/2))}function sieve_raw_editor_init(){var b=document.getElementById("rawfiltersettxt");b&&!cmeditor&&(cmeditor=CodeMirror.fromTextArea(b,{mode:"sieve",lineNumbers:!0,gutters:["CodeMirror-linenumbers","errorGutter"],styleActiveLine:!0}),$.each(rcmail.env.sieve_errors||[],function(e,f){var d=Number(f.line)-1;cmeditor.addLineClass(d,"background","line-error");cmeditor.setGutterMarker(d,"errorGutter",cmCreateErrorElem(f.msg));e||cmScrollToError()}))}rcube_webmail.prototype.managesieve_create=function(f){if(!f&&"show"!=this.env.action){var e=this.message_list.get_single_selection();f=this.set_busy(!0,"loading");this.http_post("plugin.managesieve-action",{_uid:e},f)}else{if(this.env.sieve_headers&&this.env.sieve_headers.length){var i={},g=$("#sievefilterform");g.length||(g=$('<div id="sievefilterform"></div>'),$("body").append(g));f="<fieldset><legend>"+this.get_label("managesieve.usedata")+"</legend><ul>";for(e in this.env.sieve_headers){f+='<li><input type="checkbox" name="headers[]" id="sievehdr'+e+'" value="'+e+'" checked="checked" /><label for="sievehdr'+e+'">'+this.env.sieve_headers[e][0]+":</label> "+this.env.sieve_headers[e][1]+"</li>"}g.html(f+"</ul></fieldset>");i[this.get_label("managesieve.nextstep")]=function(){var d=$('input[name="headers[]"]:checked',g);if(d.length){var c=rcmail.get_task_url("mail");c=rcmail.add_url(c,"_action","plugin.managesieve");c=rcmail.add_url(c,"_framed",1);d.map(function(){var b=rcmail.env.sieve_headers[this.value];c=rcmail.add_url(c,"r["+this.value+"]",b[0]+":"+b[1])});d=$("<iframe>").attr({src:c,frameborder:0});g.empty().append(d).dialog("widget").resize();i={};i[rcmail.get_label("save")]=function(){$("iframe",g).get(0).contentWindow.rcmail.managesieve_save()};g.dialog("option","buttons",i)}else{alert(rcmail.get_label("managesieve.nodata"))}};g.dialog({modal:!1,resizable:!0,closeOnEscape:!0,title:this.get_label("managesieve.newfilter"),close:function(){rcmail.managesieve_dialog_close()},buttons:i,minWidth:600,minHeight:300,height:250}).show();this.env.managesieve_dialog=g}}};rcube_webmail.prototype.managesieve_dialog_close=function(){var b=this.env.managesieve_dialog;b.html("");b.dialog("destroy").hide()};rcube_webmail.prototype.managesieve_dialog_resize=function(f){var e=this.env.managesieve_dialog,i=$(window),g=$(f);width=$("fieldset:first",f).width();height=g.height();w=i.width();h=i.height();e.dialog("option",{height:Math.min(h-20,height+120),width:Math.min(w-20,width+65)})};