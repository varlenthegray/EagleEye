window.rcmail&&rcmail.addEventListener("init",function(b){rcmail.register_command("download-eml",function(){rcmail_zipdownload("eml")});rcmail.register_command("download-mbox",function(){rcmail_zipdownload("mbox")});rcmail.register_command("download-maildir",function(){rcmail_zipdownload("maildir")});rcmail.message_list&&rcmail.message_list.addEventListener("select",function(d){var a=d.get_selection().length;rcmail.enable_command("download",a>0);rcmail.enable_command("download-eml",a==1);rcmail.enable_command("download-mbox","download-maildir",a>1)});rcmail.addEventListener("beforedownload",rcmail_zipdownload_menu);$.each(rcmail.buttons.download||[],function(){var d=$("#"+this.id),a=$("span",d);if(!a.length){a=$("<span>");d.html("").append(a)}a.text(rcmail.get_label("zipdownload.download"));rcmail.env.download_link=d})});function rcmail_zipdownload(h){if(h=="eml"){var j=rcmail.get_single_uid();rcmail.goto_url("viewsource",rcmail.params_from_uid(j,{_save:1}),false,true);return}if(rcmail.message_list&&rcmail.message_list.get_selection().length>1){var g=[],i=$("#zipdownload-form"),f=rcmail.selection_post_data();f._mode=h;f._token=rcmail.env.request_token;$.each(f,function(b,c){if(typeof c=="object"&&c.length>1){for(var a=0;a<c.length;a++){g.push($("<input>").attr({type:"hidden",name:b+"[]",value:c[a]}))}}else{g.push($("<input>").attr({type:"hidden",name:b,value:c}))}});if(!i.length){i=$("<form>").attr({style:"display: none",method:"POST",action:"?_task=mail&_action=plugin.zipdownload.messages"}).appendTo("body")}i.html("").append(g).submit()}}function rcmail_zipdownload_menu(b){rcmail.command("menu-open","zipdownload-menu",b&&b.target?b.target:rcmail.env.download_link,b);return false};