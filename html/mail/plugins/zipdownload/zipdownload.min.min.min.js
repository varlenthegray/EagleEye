window.rcmail&&rcmail.addEventListener("init",function(a){rcmail.register_command("download-eml",function(){rcmail_zipdownload("eml")});rcmail.register_command("download-mbox",function(){rcmail_zipdownload("mbox")});rcmail.register_command("download-maildir",function(){rcmail_zipdownload("maildir")});rcmail.message_list&&rcmail.message_list.addEventListener("select",function(c){var b=c.get_selection().length;rcmail.enable_command("download",b>0);rcmail.enable_command("download-eml",b==1);rcmail.enable_command("download-mbox","download-maildir",b>1)});rcmail.addEventListener("beforedownload",rcmail_zipdownload_menu);$.each(rcmail.buttons.download||[],function(){var c=$("#"+this.id),b=$("span",c);if(!b.length){b=$("<span>");c.html("").append(b)}b.text(rcmail.get_label("zipdownload.download"));rcmail.env.download_link=c})});function rcmail_zipdownload(c){if(c=="eml"){var a=rcmail.get_single_uid();rcmail.goto_url("viewsource",rcmail.params_from_uid(a,{_save:1}),false,true);return}if(rcmail.message_list&&rcmail.message_list.get_selection().length>1){var d=[],b=$("#zipdownload-form"),e=rcmail.selection_post_data();e._mode=c;e._token=rcmail.env.request_token;$.each(e,function(f,h){if(typeof h=="object"&&h.length>1){for(var g=0;g<h.length;g++){d.push($("<input>").attr({type:"hidden",name:f+"[]",value:h[g]}))}}else{d.push($("<input>").attr({type:"hidden",name:f,value:h}))}});if(!b.length){b=$("<form>").attr({style:"display: none",method:"POST",action:"?_task=mail&_action=plugin.zipdownload.messages"}).appendTo("body")}b.html("").append(d).submit()}}function rcmail_zipdownload_menu(a){rcmail.command("menu-open","zipdownload-menu",a&&a.target?a.target:rcmail.env.download_link,a);return false};