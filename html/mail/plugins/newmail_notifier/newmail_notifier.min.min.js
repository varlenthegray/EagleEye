if(window.rcmail&&rcmail.env.task=="mail"){rcmail.addEventListener("plugin.newmail_notifier",newmail_notifier_run).addEventListener("actionbefore",newmail_notifier_stop).addEventListener("init",function(){if(rcmail.message_list){rcmail.message_list.addEventListener("select",newmail_notifier_stop)}})}function newmail_notifier_run(b){if(b.basic){newmail_notifier_basic()}if(b.sound){newmail_notifier_sound()}if(b.desktop){newmail_notifier_desktop(rcmail.get_label("body","newmail_notifier"))}}function newmail_notifier_stop(c){if(rcmail.env.favicon_href&&rcmail.env.favicon_changed&&(!c||c.action!="check-recent")){$('<link rel="shortcut icon" href="'+rcmail.env.favicon_href+'"/>').replaceAll('link[rel="shortcut icon"]');rcmail.env.favicon_changed=0}try{if(window.external.msIsSiteMode()){window.external.msSiteModeClearIconOverlay()}}catch(d){}}function newmail_notifier_basic(){var e=rcmail.is_framed()?window.parent:window,h=rcmail.assets_path("plugins/newmail_notifier");e.focus();var j=$('<link rel="shortcut icon">').attr("href",h+"/favicon.ico"),g=$('link[rel="shortcut icon"]',e.document);if(!rcmail.env.favicon_href){rcmail.env.favicon_href=g.attr("href")}rcmail.env.favicon_changed=1;j.replaceAll(g);try{if(window.external.msIsSiteMode()){window.external.msSiteModeSetIconOverlay(h+"/overlay.ico",rcmail.get_label("title","newmail_notifier"))}}catch(i){}}function newmail_notifier_sound(){var e,g=rcmail.assets_path("plugins/newmail_notifier/sound"),f=navigator.mimeTypes?navigator.mimeTypes["audio/mp3"]:{};g+=bw.ie||(f&&f.enabledPlugin)?".mp3":".wav";try{e=$("<audio>").attr("src",g);e.get(0).play()}catch(h){e=$('<embed id="sound" src="'+g+'" hidden=true autostart=true loop=false />');e.appendTo($("body"));window.setTimeout("$('#sound').remove()",5000)}}function newmail_notifier_desktop(h,j){var l=rcmail.env.newmail_notifier_timeout||10,e=rcmail.assets_path("plugins/newmail_notifier/mail.png"),i=function(){var a=new window.Notification(rcmail.get_label("title","newmail_notifier"),{dir:"auto",lang:"",body:h,tag:"newmail_notifier",icon:e});a.onclick=function(){this.close()};setTimeout(function(){a.close()},l*1000)};try{window.Notification.requestPermission(function(a){if(a=="granted"){i()}else{if(a=="denied"&&j){j()}}});return true}catch(k){return false}}function newmail_notifier_test_desktop(){var b=newmail_notifier_desktop(rcmail.get_label("testbody","newmail_notifier"),function(){rcmail.display_message(rcmail.get_label("desktopdisabled","newmail_notifier"),"error")});if(!b){rcmail.display_message(rcmail.get_label("desktopunsupported","newmail_notifier"),"error")}}function newmail_notifier_test_basic(){newmail_notifier_basic()}function newmail_notifier_test_sound(){newmail_notifier_sound()};