window.rcmail&&"mail"==rcmail.env.task&&rcmail.addEventListener("plugin.newmail_notifier",newmail_notifier_run).addEventListener("actionbefore",newmail_notifier_stop).addEventListener("init",function(){rcmail.message_list&&rcmail.message_list.addEventListener("select",newmail_notifier_stop)});function newmail_notifier_run(b){b.basic&&newmail_notifier_basic();b.sound&&newmail_notifier_sound();b.desktop&&newmail_notifier_desktop(rcmail.get_label("body","newmail_notifier"))}function newmail_notifier_stop(d){!rcmail.env.favicon_href||!rcmail.env.favicon_changed||d&&"check-recent"==d.action||($('<link rel="shortcut icon" href="'+rcmail.env.favicon_href+'"/>').replaceAll('link[rel="shortcut icon"]'),rcmail.env.favicon_changed=0);try{window.external.msIsSiteMode()&&window.external.msSiteModeClearIconOverlay()}catch(c){}}function newmail_notifier_basic(){var f=rcmail.is_framed()?window.parent:window,e=rcmail.assets_path("plugins/newmail_notifier");f.focus();var h=$('<link rel="shortcut icon">').attr("href",e+"/favicon.ico");f=$('link[rel="shortcut icon"]',f.document);rcmail.env.favicon_href||(rcmail.env.favicon_href=f.attr("href"));rcmail.env.favicon_changed=1;h.replaceAll(f);try{window.external.msIsSiteMode()&&window.external.msSiteModeSetIconOverlay(e+"/overlay.ico",rcmail.get_label("title","newmail_notifier"))}catch(g){}}function newmail_notifier_sound(){var f=rcmail.assets_path("plugins/newmail_notifier/sound"),e=navigator.mimeTypes?navigator.mimeTypes["audio/mp3"]:{};f+=bw.ie||e&&e.enabledPlugin?".mp3":".wav";try{var h=$("<audio>").attr("src",f);h.get(0).play()}catch(g){h=$('<embed id="sound" src="'+f+'" hidden=true autostart=true loop=false />'),h.appendTo($("body")),window.setTimeout("$('#sound').remove()",5000)}}function newmail_notifier_desktop(h,g){var l=rcmail.env.newmail_notifier_timeout||10,k=rcmail.assets_path("plugins/newmail_notifier/mail.png"),j=function(){var a=new window.Notification(rcmail.get_label("title","newmail_notifier"),{dir:"auto",lang:"",body:h,tag:"newmail_notifier",icon:k});a.onclick=function(){this.close()};setTimeout(function(){a.close()},1000*l)};try{return window.Notification.requestPermission(function(b){"granted"==b?j():"denied"==b&&g&&g()}),!0}catch(i){return !1}}function newmail_notifier_test_desktop(){newmail_notifier_desktop(rcmail.get_label("testbody","newmail_notifier"),function(){rcmail.display_message(rcmail.get_label("desktopdisabled","newmail_notifier"),"error")})||rcmail.display_message(rcmail.get_label("desktopunsupported","newmail_notifier"),"error")}function newmail_notifier_test_basic(){newmail_notifier_basic()}function newmail_notifier_test_sound(){newmail_notifier_sound()};