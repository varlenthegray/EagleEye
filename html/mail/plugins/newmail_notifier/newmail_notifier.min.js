if(window.rcmail&&rcmail.env.task=="mail"){rcmail.addEventListener("plugin.newmail_notifier",newmail_notifier_run).addEventListener("actionbefore",newmail_notifier_stop).addEventListener("init",function(){if(rcmail.message_list){rcmail.message_list.addEventListener("select",newmail_notifier_stop)}})}function newmail_notifier_run(a){if(a.basic){newmail_notifier_basic()}if(a.sound){newmail_notifier_sound()}if(a.desktop){newmail_notifier_desktop(rcmail.get_label("body","newmail_notifier"))}}function newmail_notifier_stop(b){if(rcmail.env.favicon_href&&rcmail.env.favicon_changed&&(!b||b.action!="check-recent")){$('<link rel="shortcut icon" href="'+rcmail.env.favicon_href+'"/>').replaceAll('link[rel="shortcut icon"]');rcmail.env.favicon_changed=0}try{if(window.external.msIsSiteMode()){window.external.msSiteModeClearIconOverlay()}}catch(a){}}function newmail_notifier_basic(){var b=rcmail.is_framed()?window.parent:window,f=rcmail.assets_path("plugins/newmail_notifier");b.focus();var c=$('<link rel="shortcut icon">').attr("href",f+"/favicon.ico"),a=$('link[rel="shortcut icon"]',b.document);if(!rcmail.env.favicon_href){rcmail.env.favicon_href=a.attr("href")}rcmail.env.favicon_changed=1;c.replaceAll(a);try{if(window.external.msIsSiteMode()){window.external.msSiteModeSetIconOverlay(f+"/overlay.ico",rcmail.get_label("title","newmail_notifier"))}}catch(d){}}function newmail_notifier_sound(){var b,d=rcmail.assets_path("plugins/newmail_notifier/sound"),a=navigator.mimeTypes?navigator.mimeTypes["audio/mp3"]:{};d+=bw.ie||(a&&a.enabledPlugin)?".mp3":".wav";try{b=$("<audio>").attr("src",d);b.get(0).play()}catch(c){b=$('<embed id="sound" src="'+d+'" hidden=true autostart=true loop=false />');b.appendTo($("body"));window.setTimeout("$('#sound').remove()",5000)}}function newmail_notifier_desktop(a,f){var c=rcmail.env.newmail_notifier_timeout||10,b=rcmail.assets_path("plugins/newmail_notifier/mail.png"),g=function(){var e=new window.Notification(rcmail.get_label("title","newmail_notifier"),{dir:"auto",lang:"",body:a,tag:"newmail_notifier",icon:b});e.onclick=function(){this.close()};setTimeout(function(){e.close()},c*1000)};try{window.Notification.requestPermission(function(e){if(e=="granted"){g()}else{if(e=="denied"&&f){f()}}});return true}catch(d){return false}}function newmail_notifier_test_desktop(){var a=newmail_notifier_desktop(rcmail.get_label("testbody","newmail_notifier"),function(){rcmail.display_message(rcmail.get_label("desktopdisabled","newmail_notifier"),"error")});if(!a){rcmail.display_message(rcmail.get_label("desktopunsupported","newmail_notifier"),"error")}}function newmail_notifier_test_basic(){newmail_notifier_basic()}function newmail_notifier_test_sound(){newmail_notifier_sound()};