window.rcmail&&"mail"==rcmail.env.task&&rcmail.addEventListener("plugin.newmail_notifier",newmail_notifier_run).addEventListener("actionbefore",newmail_notifier_stop).addEventListener("init",function(){rcmail.message_list&&rcmail.message_list.addEventListener("select",newmail_notifier_stop)});function newmail_notifier_run(a){a.basic&&newmail_notifier_basic();a.sound&&newmail_notifier_sound();a.desktop&&newmail_notifier_desktop(rcmail.get_label("body","newmail_notifier"))}function newmail_notifier_stop(a){!rcmail.env.favicon_href||!rcmail.env.favicon_changed||a&&"check-recent"==a.action||($('<link rel="shortcut icon" href="'+rcmail.env.favicon_href+'"/>').replaceAll('link[rel="shortcut icon"]'),rcmail.env.favicon_changed=0);try{window.external.msIsSiteMode()&&window.external.msSiteModeClearIconOverlay()}catch(b){}}function newmail_notifier_basic(){var c=rcmail.is_framed()?window.parent:window,d=rcmail.assets_path("plugins/newmail_notifier");c.focus();var a=$('<link rel="shortcut icon">').attr("href",d+"/favicon.ico");c=$('link[rel="shortcut icon"]',c.document);rcmail.env.favicon_href||(rcmail.env.favicon_href=c.attr("href"));rcmail.env.favicon_changed=1;a.replaceAll(c);try{window.external.msIsSiteMode()&&window.external.msSiteModeSetIconOverlay(d+"/overlay.ico",rcmail.get_label("title","newmail_notifier"))}catch(b){}}function newmail_notifier_sound(){var c=rcmail.assets_path("plugins/newmail_notifier/sound"),d=navigator.mimeTypes?navigator.mimeTypes["audio/mp3"]:{};c+=bw.ie||d&&d.enabledPlugin?".mp3":".wav";try{var a=$("<audio>").attr("src",c);a.get(0).play()}catch(b){a=$('<embed id="sound" src="'+c+'" hidden=true autostart=true loop=false />'),a.appendTo($("body")),window.setTimeout("$('#sound').remove()",5000)}}function newmail_notifier_desktop(e,f){var a=rcmail.env.newmail_notifier_timeout||10,b=rcmail.assets_path("plugins/newmail_notifier/mail.png"),c=function(){var g=new window.Notification(rcmail.get_label("title","newmail_notifier"),{dir:"auto",lang:"",body:e,tag:"newmail_notifier",icon:b});g.onclick=function(){this.close()};setTimeout(function(){g.close()},1000*a)};try{return window.Notification.requestPermission(function(g){"granted"==g?c():"denied"==g&&f&&f()}),!0}catch(d){return !1}}function newmail_notifier_test_desktop(){newmail_notifier_desktop(rcmail.get_label("testbody","newmail_notifier"),function(){rcmail.display_message(rcmail.get_label("desktopdisabled","newmail_notifier"),"error")})||rcmail.display_message(rcmail.get_label("desktopunsupported","newmail_notifier"),"error")}function newmail_notifier_test_basic(){newmail_notifier_basic()}function newmail_notifier_test_sound(){newmail_notifier_sound()};