function plugin_vcard_save_contact(b){var a=rcmail.set_busy(true,"loading");rcmail.http_post("plugin.savevcard",{_uid:rcmail.env.uid,_mbox:rcmail.env.mailbox,_part:b},a);return false}function plugin_vcard_insertrow(b){var a=b.row.ctype;if(a=="text/vcard"||a=="text/x-vcard"||a=="text/directory"){$("#rcmrow"+rcmail.html_identifier(b.uid,true)+" > td.attachment").html('<img src="'+rcmail.env.vcard_icon+'" alt="" />')}}function plugin_vcard_attach(){var e,d,c=[],b=new Date().getTime(),a={_uploadid:b,_id:rcmail.env.compose_id};for(d=0;d<rcmail.contact_list.selection.length;d++){e=rcmail.contact_list.selection[d];if(e&&e.charAt(0)!="E"&&rcmail.env.contactdata[e]){c.push(e)}}if(!c.length){return false}a._uri="vcard://"+c.join(",");if(!rcmail.add2attachment_list(b,{name:"",html:rcmail.get_label("attaching"),classname:"uploading",complete:false})){rcmail.file_upload_id=rcmail.set_busy(true,"attaching")}rcmail.http_post("upload",a)}window.rcmail&&rcmail.addEventListener("init",function(a){if(rcmail.gui_objects.messagelist){rcmail.addEventListener("insertrow",function(c,b){plugin_vcard_insertrow(c)})}if(rcmail.env.action=="compose"&&rcmail.gui_objects.contactslist){rcmail.env.compose_commands.push("attach-vcard");rcmail.register_command("attach-vcard",function(){plugin_vcard_attach()});rcmail.contact_list.addEventListener("select",function(b){rcmail.enable_command("attach-vcard",b.selection.length==1&&rcmail.contact_list.selection[0].charAt(0)!="E")})}});