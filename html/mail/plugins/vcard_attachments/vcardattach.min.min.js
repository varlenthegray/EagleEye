function plugin_vcard_save_contact(c){var d=rcmail.set_busy(true,"loading");rcmail.http_post("plugin.savevcard",{_uid:rcmail.env.uid,_mbox:rcmail.env.mailbox,_part:c},d);return false}function plugin_vcard_insertrow(c){var d=c.row.ctype;if(d=="text/vcard"||d=="text/x-vcard"||d=="text/directory"){$("#rcmrow"+rcmail.html_identifier(c.uid,true)+" > td.attachment").html('<img src="'+rcmail.env.vcard_icon+'" alt="" />')}}function plugin_vcard_attach(){var h,i,j=[],f=new Date().getTime(),g={_uploadid:f,_id:rcmail.env.compose_id};for(i=0;i<rcmail.contact_list.selection.length;i++){h=rcmail.contact_list.selection[i];if(h&&h.charAt(0)!="E"&&rcmail.env.contactdata[h]){j.push(h)}}if(!j.length){return false}g._uri="vcard://"+j.join(",");if(!rcmail.add2attachment_list(f,{name:"",html:rcmail.get_label("attaching"),classname:"uploading",complete:false})){rcmail.file_upload_id=rcmail.set_busy(true,"attaching")}rcmail.http_post("upload",g)}window.rcmail&&rcmail.addEventListener("init",function(b){if(rcmail.gui_objects.messagelist){rcmail.addEventListener("insertrow",function(d,a){plugin_vcard_insertrow(d)})}if(rcmail.env.action=="compose"&&rcmail.gui_objects.contactslist){rcmail.env.compose_commands.push("attach-vcard");rcmail.register_command("attach-vcard",function(){plugin_vcard_attach()});rcmail.contact_list.addEventListener("select",function(a){rcmail.enable_command("attach-vcard",a.selection.length==1&&rcmail.contact_list.selection[0].charAt(0)!="E")})}});