function plugin_vcard_save_contact(b){var a=rcmail.set_busy(true,"loading");rcmail.http_post("plugin.savevcard",{_uid:rcmail.env.uid,_mbox:rcmail.env.mailbox,_part:b},a);return false}function plugin_vcard_insertrow(b){var a=b.row.ctype;if(a=="text/vcard"||a=="text/x-vcard"||a=="text/directory"){$("#rcmrow"+rcmail.html_identifier(b.uid,true)+" > td.attachment").html('<img src="'+rcmail.env.vcard_icon+'" alt="" />')}}function plugin_vcard_attach(){var c,b,a=[],e=new Date().getTime(),d={_uploadid:e,_id:rcmail.env.compose_id};for(b=0;b<rcmail.contact_list.selection.length;b++){c=rcmail.contact_list.selection[b];if(c&&c.charAt(0)!="E"&&rcmail.env.contactdata[c]){a.push(c)}}if(!a.length){return false}d._uri="vcard://"+a.join(",");if(!rcmail.add2attachment_list(e,{name:"",html:rcmail.get_label("attaching"),classname:"uploading",complete:false})){rcmail.file_upload_id=rcmail.set_busy(true,"attaching")}rcmail.http_post("upload",d)}window.rcmail&&rcmail.addEventListener("init",function(a){if(rcmail.gui_objects.messagelist){rcmail.addEventListener("insertrow",function(c,b){plugin_vcard_insertrow(c)})}if(rcmail.env.action=="compose"&&rcmail.gui_objects.contactslist){rcmail.env.compose_commands.push("attach-vcard");rcmail.register_command("attach-vcard",function(){plugin_vcard_attach()});rcmail.contact_list.addEventListener("select",function(b){rcmail.enable_command("attach-vcard",b.selection.length==1&&rcmail.contact_list.selection[0].charAt(0)!="E")})}});