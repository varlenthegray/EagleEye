var crmNav={tree:$("#searchResultTree"),getTree:null,search:null,initTree:function(){this.tree.fancytree({extensions:["filter"],filter:{counter:false,mode:"hide",highlight:false,autoExpand:false},source:{url:"/html/crm/ajax/cached_result_tree.json?v=2"},renderNode:function(a,b){let node=b.node,$span=$(node.span);switch(node.data.orderStatus){case"N":$span.addClass("crmSearchLead");break;case"#":$span.addClass("crmSearchQuote");break;case"$":$span.addClass("crmSearchProd");break;case"-":$span.addClass("crmSearchLost");break;case"+":$span.addClass("crmSearchCompleted");break;case"P":$span.addClass("crmSearchPending");break}},activate:function(a,b){let node=b.node;if(node.isFolder()){crmNav.tree.fancytree("getTree").filterBranches(node.title)}else{crmNav.tree.fancytree("getTree").filterBranches(node.getParentList()[0].title)}crmCompany.getCompany($(this).attr("data-id"));let activateType=node.data.keyType;let typeID=node.key;$.post("/html/crm/templates/crm_view.php",{type:activateType,id:typeID},function(c){crmMain.body.html(c)})},expand:function(){crmNav.checkFilters()}});crmNav.getTree=crmNav.tree.fancytree("getTree")},clearMain:function(){crmMain.body.html("")},clearAll:function(){crmNav.clearMain();$("#crm_search").val("");crmNav.getTree.clearFilter();crmNav.tree.fancytree("getRootNode").visit(function(a){a.setExpanded(false)});$(".crm_search_results").hide()},checkFilters:function(){function a(c,b){if($("#"+c).is(":checked")){$(b).show()}else{$(b).hide()}}a("search_lead",".crmSearchLead");a("search_quote",".crmSearchQuote");a("search_prod",".crmSearchProd");a("search_lost",".crmSearchLost");a("search_completed",".crmSearchCompleted");a("search_pending",".crmSearchPending")},startListening:function(){$("body").on("keyup","#crm_search",function(){if($(this).val().length>0){$(".crm_search_results").show();let cSearch=new RegExp($(this).val(),"i");crmNav.getTree.filterNodes(function(a){return cSearch.test(a.data.altData)})}else{$(".crm_search_results").hide();crmNav.search=null;crmNav.getTree.clearFilter()}crmNav.clearMain()}).on("click","#display_widgets",function(){$("#widget_box").toggle()}).on("change","#searchFilter",function(){crmNav.checkFilters()})}};