var https=require("https");var http=require("http");var fs=require("fs");var sconn=require("socket.io");var mysql=require("mysql");var scriptArgs=process.argv;var sqlLoc;var server;var port;if(scriptArgs[2]==="dev"){sqlLoc={host:"dev.3erp.us",user:"remote.3erp",password:"o4J4G91@uvw%&ptkMOwZ",database:"3erp_dev"};server=https.createServer({key:fs.readFileSync("/home/threeerp/domains/dev.3erp.us/ssl.key"),cert:fs.readFileSync("/home/threeerp/domains/dev.3erp.us/ssl.cert"),ca:fs.readFileSync("/home/threeerp/domains/dev.3erp.us/ssl.ca"),requestCert:false,rejectUnauthorized:false},sconn);port=4000}else{if(scriptArgs[2]==="localhost"){sqlLoc={host:"localhost",user:"threeerp",password:"8h294et9hVaLvp0K*s!&",database:"3erp_dev"};server=http.createServer(sconn);port=4000}else{sqlLoc={host:"3erp.us",user:"remote.3erp",password:"Gl^1k6LyteGpAJ0SoOcU",database:"3erp"};server=https.createServer({key:fs.readFileSync("/home/threeerp/ssl.key"),cert:fs.readFileSync("/home/threeerp/ssl.cert"),ca:fs.readFileSync("/home/threeerp/ssl.ca"),requestCert:false,rejectUnauthorized:false},sconn);port=4100}}var db=mysql.createConnection(sqlLoc);server.listen(port);var socket=require("socket.io").listen(server);var conn={};var oplEditing=null;function reportErr(a,b){socket.to(a.id).emit("err",b)}socket.on("connect",function(a){if(conn[a.id]===undefined){conn[a.id]={}}a.on("disconnect",function(){try{delete conn[a.id]}catch(b){console.log("Disconnect error: "+b)}});a.on("setUK",function(b){try{conn[a.id].uk=b;console.log(conn[a.id].uk)}catch(c){console.log("setUK Error: "+c)}});a.on("updateQueue",function(){try{socket.emit("catchQueueUpdate")}catch(b){console.log("updateQueue Error: "+b)}});a.on("updateSO",function(){try{socket.emit("catchSOUpdate")}catch(b){console.log("updateSO Error: "+b)}});a.on("refreshAll",function(){try{socket.emit("catchRefresh")}catch(b){console.log("refreshAll Error: "+b)}});a.on("oplEditing",function(b){try{if(oplEditing===null){oplEditing=b;socket.emit("refreshOPLEditStatus")}}catch(c){console.log("oplEditing Error: "+c)}});a.on("oplSaved",function(){try{oplEditing=null;socket.emit("refreshOPLEditStatus")}catch(b){console.log("oplSaved Error: "+b)}});a.on("getOPLEditingStatus",function(){try{a.emit("OPLEditStatusUpdate",oplEditing)}catch(b){console.log("getOPLEditingStatus Error: "+b)}});a.on("commitOPLChanges",function(b){socket.emit("pullOPLChanges",b)})});console.log("3erp active and listening on Port "+port+".");